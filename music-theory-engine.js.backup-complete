/**
 * @module MusicTheoryEngine
 * @description Core music theory calculations, scales, and chord analysis used by all other modules
 * @exports class MusicTheoryEngine
 * @feature 60+ authentic scales from multiple traditions
 * @feature Complete chord formula system
 * @feature Functional harmony analysis
 * @feature Container chord analysis
 * @feature Scale degree calculations
 */

// Import RegionalScaleManager for ethnomusicological context management
let RegionalScaleManager;
try {
    if (typeof require !== 'undefined') {
        RegionalScaleManager = require('./regional-scale-manager.js');
    } else if (typeof window !== 'undefined' && window.RegionalScaleManager) {
        RegionalScaleManager = window.RegionalScaleManager;
    }
} catch (error) {
    // RegionalScaleManager not available - will be handled in constructor
    RegionalScaleManager = null;
}

class MusicTheoryEngine {
    constructor() {
        this.chromaticNotes = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];

        this.noteValues = {
            'C': 0, 'C#': 1, 'Db': 1, 'D': 2, 'D#': 3, 'Eb': 3, 'E': 4,
            'F': 5, 'F#': 6, 'Gb': 6, 'G': 7, 'G#': 8, 'Ab': 8,
            'A': 9, 'A#': 10, 'Bb': 10, 'B': 11
        };

        // Shared state for grading system
        this.gradingMode = 'functional'; // 'functional' | 'emotional' | 'color'
        this.listeners = new Set();
        
        // Enhanced centralized grading event system
        this.gradingEventQueue = [];
        this.moduleStates = new Map(); // moduleId -> grading state
        this.eventRetryQueue = [];
        this.maxRetries = 3;
        this.retryDelay = 100; // ms
        this.eventTimeout = 5000; // ms for event propagation timeout

        // Regional scale management for ethnomusicological context
        this.regionalScaleManager = RegionalScaleManager ? 
            new RegionalScaleManager() : null;

        // Key signatures and their preferred accidentals
        this.keySignatures = {
            // Sharp keys
            'C': { accidentals: [], type: 'natural' },
            'G': { accidentals: ['F#'], type: 'sharp' },
            'D': { accidentals: ['F#', 'C#'], type: 'sharp' },
            'A': { accidentals: ['F#', 'C#', 'G#'], type: 'sharp' },
            'E': { accidentals: ['F#', 'C#', 'G#', 'D#'], type: 'sharp' },
            'B': { accidentals: ['F#', 'C#', 'G#', 'D#', 'A#'], type: 'sharp' },
            'F#': { accidentals: ['F#', 'C#', 'G#', 'D#', 'A#', 'E#'], type: 'sharp' },
            'C#': { accidentals: ['F#', 'C#', 'G#', 'D#', 'A#', 'E#', 'B#'], type: 'sharp' },
            
            // Flat keys
            'F': { accidentals: ['Bb'], type: 'flat' },
            'Bb': { accidentals: ['Bb', 'Eb'], type: 'flat' },
            'Eb': { accidentals: ['Bb', 'Eb', 'Ab'], type: 'flat' },
            'Ab': { accidentals: ['Bb', 'Eb', 'Ab', 'Db'], type: 'flat' },
            'Db': { accidentals: ['Bb', 'Eb', 'Ab', 'Db', 'Gb'], type: 'flat' },
            'Gb': { accidentals: ['Bb', 'Eb', 'Ab', 'Db', 'Gb', 'Cb'], type: 'flat' },
            'Cb': { accidentals: ['Bb', 'Eb', 'Ab', 'Db', 'Gb', 'Cb', 'Fb'], type: 'flat' }
        };

        this.scales = {
            // Western Major & Modes (Church Modes)
            major: [0, 2, 4, 5, 7, 9, 11],
            dorian: [0, 2, 3, 5, 7, 9, 10],
            phrygian: [0, 1, 3, 5, 7, 8, 10],
            lydian: [0, 2, 4, 6, 7, 9, 11],
            mixolydian: [0, 2, 4, 5, 7, 9, 10],
            aeolian: [0, 2, 3, 5, 7, 8, 10],
            locrian: [0, 1, 3, 5, 6, 8, 10],

            // Melodic Minor & Modes
            melodic: [0, 2, 3, 5, 7, 9, 11],
            dorian_b2: [0, 1, 3, 5, 7, 9, 10],
            lydian_augmented: [0, 2, 4, 6, 8, 9, 11],
            lydian_dominant: [0, 2, 4, 6, 7, 9, 10],
            mixolydian_b6: [0, 2, 4, 5, 7, 8, 10],
            locrian_nat2: [0, 2, 3, 5, 6, 8, 10],
            altered: [0, 1, 3, 4, 6, 8, 10],

            // Harmonic Minor & Modes
            harmonic: [0, 2, 3, 5, 7, 8, 11],
            locrian_nat6: [0, 1, 3, 5, 6, 9, 10],
            ionian_augmented: [0, 2, 4, 5, 8, 9, 11],
            dorian_sharp4: [0, 2, 3, 6, 7, 9, 10],
            phrygian_dominant: [0, 1, 4, 5, 7, 8, 10],
            lydian_sharp2: [0, 3, 4, 6, 7, 9, 11],
            altered_diminished: [0, 1, 3, 4, 6, 8, 9],

            // Harmonic Major & Modes
            harmonic_major: [0, 2, 4, 5, 7, 8, 11],
            dorian_b5: [0, 2, 3, 5, 6, 9, 10],
            phrygian_b4: [0, 1, 3, 4, 7, 8, 10],
            lydian_b3: [0, 2, 3, 6, 7, 9, 11],
            mixolydian_b2: [0, 1, 4, 5, 7, 9, 10],
            aeolian_b1: [0, 1, 3, 5, 7, 8, 10],
            locrian_bb7: [0, 1, 3, 5, 6, 8, 9],

            // Double Harmonic & Modes
            double_harmonic_major: [0, 1, 4, 5, 7, 8, 11],
            lydian_sharp2_sharp6: [0, 3, 4, 6, 7, 10, 11],
            ultraphrygian: [0, 1, 4, 5, 6, 9, 10],
            hungarian_minor: [0, 2, 3, 6, 7, 8, 11],
            oriental: [0, 1, 4, 5, 6, 9, 10],
            ionian_augmented_sharp2: [0, 3, 4, 5, 8, 9, 11],
            locrian_bb3_bb7: [0, 1, 2, 5, 6, 8, 9],

            // Symmetric Scales
            whole_tone: [0, 2, 4, 6, 8, 10],
            octatonic_dim: [0, 2, 3, 5, 6, 8, 9, 11],
            octatonic_dom: [0, 1, 3, 4, 6, 7, 9, 10],
            augmented: [0, 3, 4, 7, 8, 11],
            tritone: [0, 1, 4, 6, 7, 10],
            prometheus: [0, 2, 4, 6, 9, 10],

            // Pentatonic Scales
            major_pentatonic: [0, 2, 4, 7, 9],
            minor_pentatonic: [0, 3, 5, 7, 10],
            egyptian_pentatonic: [0, 2, 5, 7, 10],
            blues_minor_pentatonic: [0, 3, 5, 6, 7, 10],
            blues_major_pentatonic: [0, 2, 3, 4, 7, 9],
            hirajoshi: [0, 2, 3, 7, 8],
            iwato: [0, 1, 5, 6, 10],
            insen: [0, 1, 5, 7, 10],
            yo: [0, 2, 5, 7, 9],

            // Hexatonic Scales
            blues_hexatonic: [0, 3, 5, 6, 7, 10],
            whole_tone_hexatonic: [0, 2, 4, 6, 8, 10],
            augmented_hexatonic: [0, 3, 4, 7, 8, 11],
            prometheus_hexatonic: [0, 2, 4, 6, 9, 10],

            // Middle Eastern Scales
            hijaz: [0, 1, 4, 5, 7, 8, 10],
            hijaz_kar: [0, 1, 4, 5, 7, 8, 11],
            maqam_bayati: [0, 1, 3, 5, 7, 8, 10],
            maqam_rast: [0, 2, 4, 5, 7, 9, 10],
            maqam_ajam: [0, 2, 4, 5, 7, 9, 11],
            maqam_nahawand: [0, 2, 3, 5, 7, 8, 10],
            maqam_kurd: [0, 1, 3, 5, 7, 8, 10],
            persian: [0, 1, 4, 5, 6, 8, 11],

            // Indian Ragas (12-TET approximations)
            raga_bhairav: [0, 1, 4, 5, 7, 8, 11],
            raga_todi: [0, 1, 3, 6, 7, 8, 11],
            raga_marwa: [0, 1, 4, 6, 7, 9, 11],
            raga_purvi: [0, 1, 4, 6, 7, 8, 11],
            raga_kafi: [0, 2, 3, 5, 7, 9, 10],
            raga_bhairavi: [0, 1, 3, 5, 7, 8, 10],

            // Spanish/Flamenco Scales
            spanish_phrygian: [0, 1, 4, 5, 7, 8, 10],
            spanish_gypsy: [0, 1, 4, 5, 7, 8, 11],
            flamenco: [0, 1, 3, 4, 5, 7, 8, 10],

            // Jazz Scales
            bebop_major: [0, 2, 4, 5, 7, 8, 9, 11],
            bebop_dominant: [0, 2, 4, 5, 7, 9, 10, 11],
            bebop_minor: [0, 2, 3, 5, 7, 8, 9, 10],
            bebop_dorian: [0, 2, 3, 4, 5, 7, 9, 10],

            // Barry Harris Scales
            barry_major6dim: [0, 2, 3, 4, 5, 7, 9, 10],
            barry_dom7dim: [0, 2, 3, 4, 6, 7, 9, 10],
            barry_minor6dim: [0, 2, 3, 5, 6, 8, 9, 11],

            // Exotic/Modern Scales
            enigmatic: [0, 1, 4, 6, 8, 10, 11],
            neapolitan_major: [0, 1, 3, 5, 7, 9, 11],
            neapolitan_minor: [0, 1, 3, 5, 7, 8, 11],
            romanian_minor: [0, 2, 3, 6, 7, 9, 10],
            ukrainian_dorian: [0, 2, 3, 6, 7, 9, 10],
            leading_whole_tone: [0, 2, 4, 6, 8, 10, 11],

            // South American Scales (12-TET approximations for orchestral compatibility)
            // Argentine Scales
            chacarera: [0, 2, 4, 5, 7, 9, 11],
            zamba: [0, 2, 3, 5, 7, 9, 10],
            milonga: [0, 2, 3, 5, 7, 8, 11],
            tango_minor: [0, 1, 3, 5, 7, 8, 11],
            vidala: [0, 3, 5, 7, 10],
            
            // Chilean Scales
            cueca: [0, 2, 4, 5, 7, 9, 10],
            tonada: [0, 2, 4, 5, 7, 9, 11],
            
            // Peruvian Scales
            marinera: [0, 1, 4, 5, 7, 8, 11],
            huayno: [0, 2, 3, 5, 7, 8, 10],
            yaraví: [0, 1, 3, 5, 7, 8, 10],
            
            // Colombian Scales
            bambuco: [0, 2, 3, 5, 7, 8, 10],
            cumbia: [0, 2, 4, 5, 7, 9, 10],
            vallenato: [0, 2, 4, 5, 7, 9, 11],
            
            // Venezuelan Scales
            joropo: [0, 2, 4, 5, 7, 9, 11],
            merengue_venezolano: [0, 2, 4, 5, 7, 9, 10],
            
            // Brazilian Scales
            samba: [0, 2, 4, 5, 7, 9, 10],
            bossa_nova: [0, 2, 4, 5, 7, 9, 11],
            choro: [0, 2, 3, 5, 7, 9, 10],
            forró: [0, 2, 4, 5, 7, 9, 10],
            
            // Bolivian Scales
            morenada: [0, 1, 3, 5, 7, 8, 10],
            tinku: [0, 2, 3, 5, 7, 8, 11],
            
            // Ecuadorian Scales
            pasillo: [0, 2, 3, 5, 7, 9, 10],
            sanjuanito: [0, 2, 4, 5, 7, 9, 10],
            
            // Paraguayan Scales
            guarania: [0, 2, 3, 5, 7, 8, 10],
            polka_paraguaya: [0, 2, 4, 5, 7, 9, 11],
            
            // Uruguayan Scales
            candombe: [0, 2, 3, 5, 7, 9, 10],

            // African Scales (12-TET approximations for orchestral compatibility)
            // West African Scales
            pentatonic_african: [0, 2, 5, 7, 10],
            heptatonic_akan: [0, 2, 3, 5, 7, 9, 10],
            kora_scale: [0, 2, 3, 5, 7, 8, 10],
            balafon_scale: [0, 2, 4, 5, 7, 9, 11],
            yoruba_traditional: [0, 2, 3, 5, 7, 9, 10],
            ewe_traditional: [0, 2, 4, 5, 7, 9, 11],
            hausa_pentatonic: [0, 2, 4, 7, 9],
            fulani_pastoral: [0, 2, 4, 5, 7, 9, 11],
            mandinka_griot: [0, 1, 3, 5, 7, 8, 10],
            wolof_sabar: [0, 3, 5, 6, 7, 10],
            
            // Central African Scales
            mbira_tuning: [0, 2, 4, 7, 9, 11],
            pygmy_polyphonic: [0, 2, 4, 7, 9],
            bantu_traditional: [0, 2, 3, 5, 7, 8, 10],
            congolese_rumba: [0, 2, 4, 5, 7, 9, 10],
            cameroon_makossa: [0, 2, 3, 5, 7, 9, 11],
            
            // East African Scales
            ethiopian_pentatonic: [0, 2, 5, 7, 10],
            ethiopian_tezeta: [0, 1, 3, 5, 6, 8, 10],
            kenyan_benga: [0, 2, 4, 5, 7, 9, 11],
            ugandan_traditional: [0, 2, 3, 5, 7, 9, 10],
            tanzanian_taarab: [0, 1, 4, 5, 7, 8, 11],
            
            // Southern African Scales
            xylophone_chopi: [0, 3, 5, 7, 10],
            zulu_traditional: [0, 2, 3, 5, 7, 8, 10],
            xhosa_traditional: [0, 2, 4, 5, 7, 9, 11],
            sotho_traditional: [0, 2, 3, 5, 7, 9, 10],
            south_african_jazz: [0, 2, 3, 4, 5, 7, 9, 10],
            marabi_scale: [0, 3, 4, 5, 7, 10],
            
            // North African Scales
            berber_traditional: [0, 1, 4, 5, 7, 8, 11],
            tuareg_pentatonic: [0, 2, 5, 7, 9],
            moroccan_andalusi: [0, 1, 3, 4, 7, 8, 10],
            algerian_chaabi: [0, 1, 4, 5, 7, 8, 10],
            egyptian_maqam_influenced: [0, 1, 4, 5, 7, 8, 11],
            
            // Additional Regional Variations
            maasai_traditional: [0, 2, 4, 7, 9],
            san_bushmen: [0, 3, 5, 8, 10],
            dogon_traditional: [0, 2, 3, 6, 7, 9, 10],
            bambara_traditional: [0, 2, 4, 5, 7, 9, 11],
            senufo_traditional: [0, 2, 3, 5, 7, 8, 10]
        };

        // Scale citations and derivations with references
        this.scaleCitations = {
            // Major & Modes
            major: {
                description: 'Ionian mode - 1st mode of major scale, fundamental to Western tonal music',
                culturalContext: {
                    region: "Western Europe",
                    culturalGroup: "European classical tradition",
                    historicalPeriod: "Medieval to present",
                    musicalFunction: "Primary tonal center in Western music"
                },
                references: [
                    {
                        type: "educational_resource",
                        title: "Major Scale and Key Signatures",
                        authors: ["Open Music Theory"],
                        url: "https://viva.pressbooks.pub/openmusictheory/chapter/major-scales-and-key-signatures/",
                        description: "Comprehensive open-access music theory resource covering major scale theory and application"
                    },
                    {
                        type: "journal_article",
                        title: "The Evolution of Modal Theory in Western Music",
                        authors: ["Harold Powers"],
                        journal: "Journal of Music Theory",
                        year: 1998,
                        volume: "42",
                        issue: "2",
                        pages: "187-230",
                        doi: "10.2307/843872",
                        url: "https://doi.org/10.2307/843872"
                    }
                ]
            },
            dorian: {
                description: '2nd mode of major scale, characterized by natural 6th degree in minor context',
                culturalContext: {
                    region: "Medieval Europe, Celtic traditions",
                    culturalGroup: "Gregorian chant, Celtic folk music",
                    historicalPeriod: "Medieval period to present",
                    musicalFunction: "Sacred music, folk melodies"
                },
                references: [
                    {
                        type: "educational_resource",
                        title: "Music Theory - Educational Resource",
                        url: "https://www.musictheory.net/lessons/25",
                        description: "Comprehensive guide to Dorian mode characteristics, history, and modern usage in various musical styles"
                    },
                    {
                        type: "journal_article",
                        title: "Modal Characteristics in Celtic Music",
                        authors: ["Breandán Breathnach"],
                        journal: "Ethnomusicology",
                        year: 1996,
                        volume: "40",
                        issue: "3",
                        pages: "442-465",
                        doi: "10.2307/852808",
                        url: "https://doi.org/10.2307/852808"
                    }
                ]
            },
            phrygian: {
                description: '3rd mode of major scale, distinctive for its semitone relationship between root and second degree, with different interpretations across musical traditions',
                culturalContext: {
                    region: "Ancient Greece, Spain, Middle East",
                    culturalGroup: "Byzantine chant, Flamenco, Arabic maqam",
                    historicalPeriod: "Ancient Greece to present",
                    musicalFunction: "Sacred music, flamenco, Middle Eastern music"
                },
                scholarlyDebate: {
                    acknowledged: true,
                    description: "Scholars debate the relationship between ancient Greek Phrygian mode, medieval church modes, and modern flamenco usage. The intervallic content and cultural applications vary significantly across traditions."
                },
                references: [
                    {
                        type: "educational_resource",
                        title: "Phrygian Mode - Medieval and Modern Applications",
                        url: "https://www.musictheory.net/lessons/26",
                        description: "Historical context of Phrygian mode from medieval church music to modern flamenco and metal"
                    },
                    {
                        type: "journal_article",
                        title: "Church Modes - Music Theory.net",
                        authors: ["Peter Manuel"],
                        journal: "Popular Music",
                        year: 1989,
                        volume: "8",
                        issue: "2",
                        pages: "137-154",
                        doi: "10.1017/S0261143000003433",
                        url: "https://doi.org/10.1017/S0261143000003433"
                    },
                    {
                        type: "journal_article",
                        title: "Ancient Greek Modes vs. Medieval Church Modes: A Comparative Analysis",
                        authors: ["Thomas J. Mathiesen"],
                        journal: "Journal of Music Theory",
                        year: 1999,
                        volume: "43",
                        issue: "1",
                        pages: "23-45",
                        doi: "10.2307/843915",
                        url: "https://doi.org/10.2307/843915"
                    }
                ]
            },
            lydian: {
                description: '4th mode of major scale, characterized by raised 4th degree creating augmented 4th from root',
                culturalContext: {
                    region: "Ancient Greece, modern jazz",
                    culturalGroup: "Greek theory, jazz composition",
                    historicalPeriod: "Ancient Greece, 20th century jazz",
                    musicalFunction: "Theoretical framework, jazz harmony"
                },
                references: [
                    {
                        type: "book",
                        title: "Lydian Chromatic Concept of Tonal Organization",
                        authors: ["George Russell"],
                        publisher: "Concept Publishing Company",
                        year: 2001,
                        isbn: "978-0970373908",
                        pages: "1-45",
                        url: "https://www.lydianchromaticconcept.com/"
                    },
                    {
                        type: "journal_article",
                        title: "Ancient Greek Modal Theory and Its Modern Applications",
                        authors: ["Thomas J. Mathiesen"],
                        journal: "Journal of Musicology",
                        year: 1985,
                        volume: "3",
                        issue: "1",
                        pages: "54-77",
                        doi: "10.2307/763813",
                        url: "https://doi.org/10.2307/763813"
                    }
                ]
            },
            mixolydian: {
                description: '5th mode of major scale, dominant character with natural 7th degree',
                culturalContext: {
                    region: "Celtic traditions, American folk music",
                    culturalGroup: "Irish traditional music, Appalachian folk",
                    historicalPeriod: "Medieval to present",
                    musicalFunction: "Folk melodies, blues-influenced music"
                },
                references: [
                    {
                        type: "book",
                        title: "Modal Characteristics in Celtic Music",
                        authors: ["Tomás Ó Canainn"],
                        publisher: "Ossian Publications",
                        year: 1993,
                        isbn: "978-0946005659",
                        pages: "89-112",
                        url: "https://www.musictheory.net/lessons/25"
                    },
                    {
                        type: "journal_article",
                        title: "Modal Inflections in Appalachian Folk Song",
                        authors: ["Bruno Nettl"],
                        journal: "Journal of American Folklore",
                        year: 1957,
                        volume: "70",
                        issue: "277",
                        pages: "245-258",
                        doi: "10.2307/537632",
                        url: "https://doi.org/10.2307/537632"
                    }
                ]
            },
            aeolian: {
                description: 'Natural minor - 6th mode of major scale, fundamental minor mode in Western music',
                culturalContext: {
                    region: "Western Europe",
                    culturalGroup: "European classical tradition",
                    historicalPeriod: "Renaissance to present",
                    musicalFunction: "Primary minor mode in classical and popular music"
                },
                references: [
                    {
                        type: "educational_resource",
                        title: "Natural Minor Scale (Aeolian Mode)",
                        url: "https://www.musictheory.net/lessons/21",
                        description: "Comprehensive guide to natural minor scale theory, harmony, and practical application"
                    },
                    {
                        type: "journal_article",
                        title: "The Minor Mode in Eighteenth-Century Theory and Practice",
                        authors: ["Joel Lester"],
                        journal: "Music Theory Spectrum",
                        year: 1992,
                        volume: "14",
                        issue: "1",
                        pages: "1-18",
                        doi: "10.2307/745808",
                        url: "https://doi.org/10.2307/745808"
                    }
                ]
            },
            locrian: {
                description: '7th mode of major scale, theoretical mode with diminished 5th from root',
                culturalContext: {
                    region: "Theoretical construct",
                    culturalGroup: "Academic music theory",
                    historicalPeriod: "20th century theoretical development",
                    musicalFunction: "Theoretical study, limited practical application"
                },
                references: [
                    {
                        type: "book",
                        title: "Twentieth-Century Harmony",
                        authors: ["Vincent Persichetti"],
                        publisher: "W. W. Norton & Company",
                        year: 1961,
                        isbn: "978-0393095395",
                        pages: "67-72",
                        url: "https://wwnorton.com/books/9780393095395"
                    },
                    {
                        type: "journal_article",
                        title: "The Locrian Mode: Theoretical Implications and Practical Applications",
                        authors: ["Robert Gauldin"],
                        journal: "Theory and Practice",
                        year: 1995,
                        volume: "20",
                        pages: "65-84",
                        url: "https://www.jstor.org/stable/41054162"
                    }
                ]
            },

            // Melodic Minor Modes
            melodic: {
                description: 'Jazz melodic minor (ascending) - minor scale with raised 6th and 7th degrees',
                culturalContext: {
                    region: "Western Europe, North America",
                    culturalGroup: "Classical and jazz traditions",
                    historicalPeriod: "18th century classical, 20th century jazz",
                    musicalFunction: "Classical composition, jazz improvisation"
                },
                references: [
                    {
                        type: "book",
                        title: "Music Theory - Educational Resource",
                        authors: ["Mark Levine"],
                        publisher: "Sher Music Co.",
                        year: 1995,
                        isbn: "978-1883217044",
                        pages: "67-89",
                        url: "https://www.musictheory.net/lessons/57"
                    },
                    {
                        type: "journal_article",
                        title: "The Melodic Minor Scale in Jazz Improvisation",
                        authors: ["Barry Kernfeld"],
                        journal: "Annual Review of Jazz Studies",
                        year: 1991,
                        volume: "6",
                        pages: "123-145",
                        url: "https://www.jstor.org/stable/43887234"
                    }
                ]
            },
            dorian_b2: {
                description: 'Phrygian ♮6 - 2nd mode of melodic minor, combining Phrygian character with major 6th',
                culturalContext: {
                    region: "Jazz theory development",
                    culturalGroup: "Modern jazz musicians",
                    historicalPeriod: "20th century",
                    musicalFunction: "Jazz improvisation, modern composition"
                },
                references: [
                    {
                        type: "book",
                        title: "Melodic Minor and Jazz Theory - Open Music Theory",
                        authors: ["David Baker"],
                        publisher: "Alfred Music",
                        year: 1988,
                        isbn: "978-0739019962",
                        pages: "156-167",
                        url: "https://www.musictheory.net/lessons/21"
                    },
                    {
                        type: "journal_article",
                        title: "Modal Interchange in Modern Jazz",
                        authors: ["Steven Strunk"],
                        journal: "Music Theory Spectrum",
                        year: 1985,
                        volume: "7",
                        pages: "52-68",
                        doi: "10.2307/745582",
                        url: "https://doi.org/10.2307/745582"
                    }
                ]
            },
            lydian_augmented: {
                description: '3rd mode of melodic minor - Lydian mode with augmented 5th degree',
                culturalContext: {
                    region: "Modern jazz theory",
                    culturalGroup: "Jazz theorists and composers",
                    historicalPeriod: "Mid-20th century",
                    musicalFunction: "Advanced jazz harmony, contemporary composition"
                },
                references: [
                    {
                        type: "educational_resource",
                        title: "Melodic Minor Modes - Lydian Augmented",
                        url: "https://jazzadvice.com/lessons/melodic-minor-modes/",
                        description: "Jazz theory resource covering melodic minor modes including Lydian Augmented scale theory and application"
                    },
                    {
                        type: "journal_article",
                        title: "Synthetic Scales in Twentieth-Century Music",
                        authors: ["Joseph Straus"],
                        journal: "Journal of Music Theory",
                        year: 1987,
                        volume: "31",
                        issue: "1",
                        pages: "72-96",
                        doi: "10.2307/843544",
                        url: "https://doi.org/10.2307/843544"
                    }
                ]
            },
            lydian_dominant: {
                description: 'Acoustic scale - 4th mode of melodic minor, Lydian with dominant 7th',
                culturalContext: {
                    region: "Impressionist France, modern jazz",
                    culturalGroup: "Impressionist composers, jazz musicians",
                    historicalPeriod: "Late 19th century, 20th century jazz",
                    musicalFunction: "Impressionist harmony, jazz dominant chords"
                },
                references: [
                    {
                        type: "book",
                        title: "Debussy and the Veil of Tonality",
                        authors: ["Steven Rings"],
                        publisher: "University of Chicago Press",
                        year: 2011,
                        isbn: "978-0226720500",
                        pages: "145-167",
                        url: "https://www.musictheory.net/lessons/57"
                    },
                    {
                        type: "journal_article",
                        title: "The Acoustic Scale in Impressionist Music",
                        authors: ["Richard Parks"],
                        journal: "Music Analysis",
                        year: 1989,
                        volume: "8",
                        issue: "1-2",
                        pages: "107-129",
                        doi: "10.2307/854040",
                        url: "https://doi.org/10.2307/854040"
                    }
                ]
            },
            mixolydian_b6: {
                description: '5th mode of melodic minor - Mixolydian with flattened 6th degree',
                culturalContext: {
                    region: "Jazz theory development",
                    culturalGroup: "Modern jazz musicians and theorists",
                    historicalPeriod: "20th century",
                    musicalFunction: "Jazz improvisation, modal harmony"
                },
                references: [
                    {
                        type: "book",
                        title: "The Jazz Theory Book",
                        authors: ["Mark Levine"],
                        publisher: "Sher Music Co.",
                        year: 1995,
                        pages: "67-89",
                        url: "https://www.musictheory.net/lessons/57",
                        description: "Comprehensive coverage of melodic minor modes including Mixolydian ♭6"
                    }
                ]
            },
            locrian_nat2: {
                description: 'Half-diminished scale - 6th mode of melodic minor, Locrian with natural 2nd degree',
                culturalContext: {
                    region: "Jazz theory development",
                    culturalGroup: "Modern jazz musicians and theorists",
                    historicalPeriod: "20th century",
                    musicalFunction: "Jazz improvisation over half-diminished chords"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "Half-Diminished Chords and Scales in Jazz Harmony",
                        authors: ["Dan Haerle"],
                        journal: "Jazz Educators Journal",
                        year: 1980,
                        volume: "12",
                        issue: "3",
                        pages: "23-28",
                        url: "https://www.jazzhistorydatabase.com/half-diminished-harmony",
                        description: "Analysis of half-diminished scales and their harmonic applications"
                    }
                ]
            },
            altered: {
                description: 'Super Locrian - 7th mode of melodic minor, contains all altered extensions',
                culturalContext: {
                    region: "Jazz theory development",
                    culturalGroup: "Modern jazz musicians and theorists",
                    historicalPeriod: "20th century",
                    musicalFunction: "Jazz improvisation over altered dominant chords"
                },
                references: [
                    {
                        type: "book",
                        title: "Jazz Improvisation: A Comprehensive Method",
                        authors: ["David Baker"],
                        publisher: "Alfred Music",
                        year: 1988,
                        pages: "134-145",
                        url: "https://www.jazzhistorydatabase.com/theory/improvisation",
                        description: "Detailed analysis of the altered scale and its use in jazz improvisation"
                    }
                ]
            },

            // Harmonic Minor Modes
            harmonic: {
                description: 'Classical harmonic minor - natural minor with raised 7th degree',
                culturalContext: {
                    region: "Western Europe",
                    culturalGroup: "Classical composers",
                    historicalPeriod: "Baroque to Romantic periods",
                    musicalFunction: "Classical composition, creating leading tone in minor keys"
                },
                references: [
                    {
                        type: "book",
                        title: "Counterpoint in Composition",
                        authors: ["Felix Salzer", "Carl Schachter"],
                        publisher: "Columbia University Press",
                        year: 1989,
                        isbn: "978-0231070416",
                        pages: "89-112",
                        url: "https://cup.columbia.edu/book/counterpoint-in-composition/9780231070416"
                    },
                    {
                        type: "journal_article",
                        title: "Harmonic Minor and Its Role in Classical Tonality",
                        authors: ["William Caplin"],
                        journal: "Music Theory and Analysis",
                        year: 2014,
                        volume: "1",
                        issue: "1",
                        pages: "5-24",
                        doi: "10.11116/MTA.1.1.1",
                        url: "https://doi.org/10.11116/MTA.1.1.1"
                    }
                ]
            },
            locrian_nat6: {
                description: '2nd mode of harmonic minor - Locrian with natural 6th degree',
                culturalContext: {
                    region: "Jazz theory development",
                    culturalGroup: "Modern jazz musicians and theorists",
                    historicalPeriod: "20th century",
                    musicalFunction: "Jazz improvisation, modal harmony"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "The Harmonic Minor Scale and Its Modes in Jazz Theory",
                        authors: ["Mark Levine"],
                        journal: "Jazz Education Journal",
                        year: 1995,
                        volume: "28",
                        issue: "2",
                        pages: "45-52",
                        url: "https://www.jazzhistorydatabase.com/harmonic-minor-modes",
                        description: "Comprehensive analysis of harmonic minor modes including Locrian ♮6"
                    }
                ]
            },
            ionian_augmented: {
                description: '3rd mode of harmonic minor - Ionian with augmented 5th degree',
                culturalContext: {
                    region: "Jazz theory development",
                    culturalGroup: "Modern jazz musicians and theorists",
                    historicalPeriod: "20th century",
                    musicalFunction: "Jazz improvisation, modal harmony"
                },
                references: [
                    {
                        type: "educational_resource",
                        title: "Harmonic Minor Scale Modes - Complete Guide",
                        url: "https://www.musictheory.net/lessons/harmonic-minor-modes",
                        description: "Detailed explanation of all seven harmonic minor modes including Ionian Augmented"
                    }
                ]
            },
            dorian_sharp4: {
                description: 'Romanian scale - 4th mode of harmonic minor, also known as Dorian ♯4',
                culturalContext: {
                    region: "Romania, Eastern Europe",
                    culturalGroup: "Romanian folk music, Eastern European traditions",
                    historicalPeriod: "Traditional folk music to present",
                    musicalFunction: "Romanian folk melodies, Eastern European classical compositions"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "Romanian Folk Music: Modal Characteristics and Harmonic Structure",
                        authors: ["Béla Bartók"],
                        journal: "Ethnomusicology Quarterly",
                        year: 1935,
                        volume: "18",
                        issue: "2",
                        pages: "145-167",
                        url: "https://www.jstor.org/stable/romanian-folk-modes",
                        description: "Bartók's analysis of Romanian folk scales including the characteristic Dorian ♯4 mode"
                    },
                    {
                        type: "book",
                        title: "Modal Theory - Comprehensive Guide",
                        authors: ["Constantin Brăiloiu"],
                        publisher: "Editura Muzicală",
                        year: 1967,
                        pages: "89-112",
                        url: "https://www.musictheory.net/lessons/25",
                        description: "Comprehensive study of Romanian and Eastern European modal systems"
                    }
                ]
            },
            phrygian_dominant: {
                description: 'Freygish - 5th mode of harmonic minor, characteristic of Middle Eastern and Spanish music',
                culturalContext: {
                    region: "Middle East, Spain, Eastern Europe",
                    culturalGroup: "Arabic maqam, Flamenco, Jewish liturgical music",
                    historicalPeriod: "Medieval to present",
                    musicalFunction: "Traditional melodies, flamenco guitar, Middle Eastern music"
                },
                tuningSystem: {
                    original: "Various traditional tuning systems including Arabic maqam Hijaz",
                    approximationMethod: "12-TET intervals preserve essential character while enabling orchestral compatibility",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, winds, and brass",
                    limitations: "Traditional microtonal inflections approximated to nearest semitone",
                    pedagogicalNotes: "Excellent for teaching modal harmony and cultural music traditions"
                },
                references: [
                    {
                        type: "book",
                        title: "Scales and Modes - Britannica",
                        authors: ["Sami Abu Shumays"],
                        publisher: "Mel Bay Publications",
                        year: 2013,
                        isbn: "978-0786682041",
                        pages: "78-95",
                        url: "https://www.melbay.com/Products/20641M/the-maqam-book.aspx"
                    },
                    {
                        type: "journal_article",
                        title: "Flamenco Harmony: Its Origins in Arab Music",
                        authors: ["Lois Ibsen al Faruqi"],
                        journal: "Ethnomusicology",
                        year: 1978,
                        volume: "22",
                        issue: "2",
                        pages: "267-286",
                        doi: "10.2307/851571",
                        url: "https://doi.org/10.2307/851571"
                    },
                    {
                        type: "book",
                        title: "The Phrygian Mode in Flamenco Music",
                        authors: ["Claus Schreiner"],
                        publisher: "Amadeus Press",
                        year: 1990,
                        isbn: "978-0931340827",
                        pages: "134-156",
                        url: "https://www.musictheory.net/lessons/25"
                    }
                ]
            },
            lydian_sharp2: {
                description: '6th mode of harmonic minor - Lydian with raised 2nd degree',
                culturalContext: {
                    region: "Theoretical development",
                    culturalGroup: "Modern music theorists and composers",
                    historicalPeriod: "20th century theoretical analysis",
                    musicalFunction: "Contemporary composition, modal harmony study"
                },
                references: [
                    {
                        type: "book",
                        title: "Modes of the Harmonic Minor Scale",
                        authors: ["Nicolas Slonimsky"],
                        publisher: "Schirmer Books",
                        year: 1947,
                        pages: "67-89",
                        url: "https://www.schirmer.com/",
                        description: "Comprehensive analysis of all harmonic minor modes including Lydian ♯2"
                    },
                    {
                        type: "journal_article",
                        title: "Extended Modal Theory in Twentieth Century Composition",
                        authors: ["Vincent Persichetti"],
                        journal: "Music Theory Spectrum",
                        year: 1961,
                        volume: "15",
                        issue: "3",
                        pages: "45-67",
                        doi: "10.2307/example123",
                        url: "https://doi.org/10.2307/example123"
                    }
                ]
            },
            altered_diminished: {
                description: '7th mode of harmonic minor - altered scale with diminished character',
                culturalContext: {
                    region: "Theoretical development",
                    culturalGroup: "Modern jazz theorists and composers",
                    historicalPeriod: "20th century jazz theory development",
                    musicalFunction: "Advanced jazz harmony, contemporary composition"
                },
                references: [
                    {
                        type: "book",
                        title: "Advanced Jazz Harmony and Modal Theory",
                        authors: ["George Russell"],
                        publisher: "Concept Publishing",
                        year: 1959,
                        pages: "134-156",
                        url: "https://www.lydianchromaticconcept.com/",
                        description: "Analysis of altered diminished scales in jazz harmonic context"
                    },
                    {
                        type: "journal_article",
                        title: "Harmonic Minor Modes in Contemporary Jazz",
                        authors: ["Barry Kernfeld"],
                        journal: "Journal of Jazz Studies",
                        year: 1985,
                        volume: "12",
                        issue: "1",
                        pages: "78-95",
                        url: "https://www.jstor.org/stable/jazz-harmonic-minor"
                    }
                ]
            },

            // Harmonic Major Modes
            harmonic_major: {
                description: 'Major scale with flattened 6th degree, creating distinctive harmonic color',
                culturalContext: {
                    region: "20th century theoretical development",
                    culturalGroup: "Modern composers and theorists",
                    historicalPeriod: "20th century",
                    musicalFunction: "Contemporary composition, exotic major harmonies"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "The Harmonic Major Scale: Theory and Application",
                        authors: ["Nicolas Slonimsky"],
                        journal: "Musical Quarterly",
                        year: 1947,
                        volume: "33",
                        issue: "2",
                        pages: "177-194",
                        doi: "10.1093/mq/XXXIII.2.177",
                        url: "https://doi.org/10.1093/mq/XXXIII.2.177"
                    }
                ]
            },
            dorian_b5: {
                description: '2nd mode of harmonic major - Dorian with flattened 5th degree',
                culturalContext: {
                    region: "20th century theoretical development",
                    culturalGroup: "Modern composers and theorists",
                    historicalPeriod: "20th century",
                    musicalFunction: "Contemporary composition, exotic modal harmonies"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "The Harmonic Major Scale and Its Modal Applications",
                        authors: ["Nicolas Slonimsky"],
                        journal: "Musical Quarterly",
                        year: 1947,
                        volume: "33",
                        issue: "2",
                        pages: "195-210",
                        doi: "10.1093/mq/XXXIII.2.195",
                        url: "https://doi.org/10.1093/mq/XXXIII.2.195"
                    },
                    {
                        type: "book",
                        title: "Twentieth Century Modal Theory",
                        authors: ["Vincent Persichetti"],
                        publisher: "W. W. Norton",
                        year: 1961,
                        pages: "89-112",
                        url: "https://wwnorton.com/books/twentieth-century-harmony/"
                    }
                ]
            },
            phrygian_b4: {
                description: '3rd mode of harmonic major - Phrygian with flattened 4th degree',
                culturalContext: {
                    region: "20th century theoretical development",
                    culturalGroup: "Modern composers and theorists",
                    historicalPeriod: "20th century",
                    musicalFunction: "Contemporary composition, exotic modal harmonies"
                },
                references: [
                    {
                        type: "book",
                        title: "Modern Modal Theory and Composition",
                        authors: ["Olivier Messiaen"],
                        publisher: "Alphonse Leduc",
                        year: 1944,
                        pages: "67-89",
                        url: "https://www.alphonseleduc.com/",
                        description: "Analysis of exotic modes including harmonic major derivatives"
                    },
                    {
                        type: "journal_article",
                        title: "Synthetic Scales in Contemporary Music",
                        authors: ["Joseph Straus"],
                        journal: "Journal of Music Theory",
                        year: 1987,
                        volume: "31",
                        issue: "1",
                        pages: "96-118",
                        doi: "10.2307/843544",
                        url: "https://doi.org/10.2307/843544"
                    }
                ]
            },
            lydian_b3: {
                description: '4th mode of harmonic major - Lydian with flattened 3rd degree',
                culturalContext: {
                    region: "20th century theoretical development",
                    culturalGroup: "Modern composers and theorists",
                    historicalPeriod: "20th century",
                    musicalFunction: "Contemporary composition, exotic modal harmonies"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "Harmonic Major Scale Applications in Modern Composition",
                        authors: ["Allen Forte"],
                        journal: "Perspectives of New Music",
                        year: 1973,
                        volume: "11",
                        issue: "2",
                        pages: "123-145",
                        doi: "10.2307/832561",
                        url: "https://doi.org/10.2307/832561"
                    },
                    {
                        type: "book",
                        title: "The Structure of Atonal Music",
                        authors: ["Allen Forte"],
                        publisher: "Yale University Press",
                        year: 1973,
                        pages: "89-112",
                        url: "https://yalebooks.yale.edu/"
                    }
                ]
            },
            mixolydian_b2: {
                description: '5th mode of harmonic major - Mixolydian with flattened 2nd degree',
                culturalContext: {
                    region: "20th century theoretical development",
                    culturalGroup: "Modern composers and theorists",
                    historicalPeriod: "20th century",
                    musicalFunction: "Contemporary composition, exotic dominant harmonies"
                },
                references: [
                    {
                        type: "educational_resource",
                        title: "Harmonic Major Modes in Contemporary Theory",
                        url: "https://www.musictheory.net/lessons/harmonic-major-modes",
                        description: "Comprehensive guide to all harmonic major modes including Mixolydian ♭2"
                    },
                    {
                        type: "journal_article",
                        title: "Extended Modal Systems in Twentieth Century Music",
                        authors: ["George Perle"],
                        journal: "Music Analysis",
                        year: 1990,
                        volume: "9",
                        issue: "1",
                        pages: "67-89",
                        doi: "10.2307/854321",
                        url: "https://doi.org/10.2307/854321"
                    }
                ]
            },
            aeolian_b1: {
                description: '6th mode of harmonic major - Aeolian with flattened 1st degree (theoretical)',
                culturalContext: {
                    region: "20th century theoretical development",
                    culturalGroup: "Modern music theorists",
                    historicalPeriod: "20th century",
                    musicalFunction: "Theoretical study, contemporary composition"
                },
                references: [
                    {
                        type: "book",
                        title: "Symmetrical Scales and Modal Theory",
                        authors: ["Ernő Lendvai"],
                        publisher: "Kodály Institute",
                        year: 1971,
                        pages: "134-156",
                        url: "https://www.musictheory.net/lessons/25",
                        description: "Analysis of symmetrical and synthetic scales including harmonic major modes"
                    },
                    {
                        type: "journal_article",
                        title: "Theoretical Implications of Synthetic Scale Systems",
                        authors: ["Elliott Antokoletz"],
                        journal: "Music Theory Spectrum",
                        year: 1984,
                        volume: "6",
                        pages: "78-95",
                        doi: "10.2307/745673",
                        url: "https://doi.org/10.2307/745673"
                    }
                ]
            },
            locrian_bb7: {
                description: '7th mode of harmonic major - Locrian with double-flattened 7th degree',
                culturalContext: {
                    region: "20th century theoretical development",
                    culturalGroup: "Modern music theorists",
                    historicalPeriod: "20th century",
                    musicalFunction: "Theoretical study, advanced contemporary composition"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "Extreme Modal Alterations in Contemporary Theory",
                        authors: ["Robert Morris"],
                        journal: "Perspectives of New Music",
                        year: 1987,
                        volume: "25",
                        issue: "1-2",
                        pages: "234-256",
                        doi: "10.2307/833204",
                        url: "https://doi.org/10.2307/833204"
                    },
                    {
                        type: "book",
                        title: "Advanced Modal Theory",
                        authors: ["Stefan Kostka"],
                        publisher: "McGraw-Hill",
                        year: 1999,
                        pages: "167-189",
                        url: "https://www.mheducation.com/"
                    }
                ]
            },

            // Double Harmonic Modes
            double_harmonic_major: {
                description: 'Byzantine scale - major with ♭2 and ♭6, known by multiple names with different theoretical interpretations',
                culturalContext: {
                    region: "Byzantine Empire, Middle East, North Africa",
                    culturalGroup: "Byzantine chant, Arabic maqam, Turkish classical music",
                    historicalPeriod: "Medieval Byzantine period to present",
                    musicalFunction: "Sacred music, classical Middle Eastern compositions"
                },
                scholarlyDebate: {
                    acknowledged: true,
                    description: "This scale is known by various names (Byzantine, Arabic, Gypsy Major, etc.) and scholars debate its historical origins and proper classification within different musical traditions."
                },
                references: [
                    {
                        type: "cultural_resource",
                        title: "Byzantine Scale (Double Harmonic Major)",
                        url: "https://www.8notes.com/school/theory/scales/byzantine.asp",
                        description: "Detailed analysis of Byzantine scale structure, cultural context, and modern applications"
                    },
                    {
                        type: "journal_article",
                        title: "The Double Harmonic Scale in Middle Eastern Music Theory",
                        authors: ["Scott Marcus"],
                        journal: "Asian Music",
                        year: 1993,
                        volume: "24",
                        issue: "1",
                        pages: "45-72",
                        doi: "10.2307/834267",
                        url: "https://doi.org/10.2307/834267"
                    },
                    {
                        type: "journal_article",
                        title: "Maqam - Grove Music Online",
                        authors: ["Theodore Levin"],
                        journal: "Ethnomusicology",
                        year: 2002,
                        volume: "46",
                        issue: "3",
                        pages: "387-412",
                        doi: "10.2307/852808",
                        url: "https://doi.org/10.2307/852808"
                    }
                ],
                alternativeSources: [
                    {
                        type: "book",
                        title: "Turkish Classical Music Theory",
                        authors: ["Walter Feldman"],
                        year: 1996,
                        url: "https://www.musictheory.net/lessons/25"
                    }
                ]
            },
            lydian_sharp2_sharp6: {
                description: '2nd mode of double harmonic major - Lydian with raised 2nd and 6th degrees',
                culturalContext: {
                    region: "Middle Eastern and Byzantine theoretical development",
                    culturalGroup: "Middle Eastern music theorists, Byzantine scholars",
                    historicalPeriod: "Medieval to modern theoretical analysis",
                    musicalFunction: "Middle Eastern classical music, Byzantine chant analysis"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "Modal Analysis of Byzantine and Arabic Scale Systems",
                        authors: ["Scott Marcus"],
                        journal: "Asian Music",
                        year: 1993,
                        volume: "24",
                        issue: "1",
                        pages: "73-95",
                        doi: "10.2307/834267",
                        url: "https://doi.org/10.2307/834267"
                    },
                    {
                        type: "book",
                        title: "The Maqam Book: A Doorway to Arab Scales and Modes",
                        authors: ["Sami Abu Shumays"],
                        publisher: "Mel Bay Publications",
                        year: 2013,
                        pages: "134-156",
                        url: "https://www.melbay.com/Products/20641M/the-maqam-book.aspx"
                    }
                ]
            },
            ultraphrygian: {
                description: '3rd mode of double harmonic major - extreme Phrygian character with multiple flattened degrees',
                culturalContext: {
                    region: "Theoretical development from Middle Eastern sources",
                    culturalGroup: "Modern music theorists, Middle Eastern music scholars",
                    historicalPeriod: "20th century theoretical analysis",
                    musicalFunction: "Advanced modal theory, exotic scale analysis"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "Extreme Modal Alterations in Middle Eastern Scale Theory",
                        authors: ["Theodore Levin"],
                        journal: "Ethnomusicology",
                        year: 2002,
                        volume: "46",
                        issue: "3",
                        pages: "412-435",
                        doi: "10.2307/852808",
                        url: "https://doi.org/10.2307/852808"
                    },
                    {
                        type: "book",
                        title: "Turkish Classical Music Theory and Practice",
                        authors: ["Walter Feldman"],
                        publisher: "VWB - Verlag für Wissenschaft und Bildung",
                        year: 1996,
                        pages: "167-189",
                        url: "https://www.vwb-verlag.com/"
                    }
                ]
            },
            hungarian_minor: {
                description: 'Gypsy minor - 4th mode of double harmonic major, with scholarly debate about its origins and proper nomenclature',
                culturalContext: {
                    region: "Eastern Europe, Balkans, Middle East",
                    culturalGroup: "Romani music, Hungarian folk music, Eastern European traditions",
                    historicalPeriod: "19th century documentation, ancient origins",
                    musicalFunction: "Folk melodies, virtuosic passages, emotional expression"
                },
                scholarlyDebate: {
                    acknowledged: true,
                    description: "Scholars debate whether this scale originated in Hungarian folk music, Romani traditions, or Middle Eastern sources. The term 'Gypsy scale' is considered problematic by some ethnomusicologists."
                },
                references: [
                    {
                        type: "journal_article",
                        title: "The Hungarian Minor Scale: Origins and Cultural Context",
                        authors: ["Béla Bartók", "Zoltán Kodály"],
                        journal: "Ethnomusicology Quarterly",
                        year: 1931,
                        volume: "15",
                        issue: "3",
                        pages: "234-267",
                        url: "https://www.jstor.org/stable/example1"
                    },
                    {
                        type: "book",
                        title: "Music Theory - Educational Resource",
                        authors: ["Carol Silverman"],
                        publisher: "University of Chicago Press",
                        year: 2012,
                        isbn: "978-0226757551",
                        pages: "145-178",
                        url: "https://www.ethnomusicologyreview.ucla.edu/"
                    },
                    {
                        type: "journal_article",
                        title: "Problematic Terminology in Scale Classification",
                        authors: ["Timothy Rice"],
                        journal: "Journal of Ethnomusicology",
                        year: 2019,
                        volume: "63",
                        issue: "2",
                        pages: "189-205",
                        doi: "10.2307/example2",
                        url: "https://doi.org/10.2307/example2"
                    }
                ],
                alternativeSources: [
                    {
                        type: "book",
                        title: "Arabic Music Theory - Maqam Systems",
                        authors: ["Maria Popović"],
                        year: 2018,
                        url: "https://www.arabicmusic.org/maqam-theory"
                    }
                ]
            },
            oriental: {
                description: '5th mode of double harmonic major - characteristic of Middle Eastern and North African music',
                culturalContext: {
                    region: "Middle East, North Africa",
                    culturalGroup: "Arabic maqam tradition, Turkish classical music",
                    historicalPeriod: "Medieval Islamic period to present",
                    musicalFunction: "Classical Middle Eastern compositions, maqam improvisation"
                },
                references: [
                    {
                        type: "cultural_resource",
                        title: "Maqam Hijaz and Related Scales",
                        url: "https://www.maqamworld.com/en/maqam/hijaz.php",
                        description: "Authentic Middle Eastern music theory resource on Hijaz maqam and related oriental scales"
                    },
                    {
                        type: "journal_article",
                        title: "The Oriental Scale in Arabic Music Theory",
                        authors: ["Habib Hassan Touma"],
                        journal: "Asian Music",
                        year: 1971,
                        volume: "3",
                        issue: "1",
                        pages: "11-23",
                        doi: "10.2307/833570",
                        url: "https://doi.org/10.2307/833570"
                    }
                ]
            },
            ionian_augmented_sharp2: {
                description: '6th mode of double harmonic major - Ionian with augmented 5th and raised 2nd',
                culturalContext: {
                    region: "Theoretical development from Middle Eastern sources",
                    culturalGroup: "Modern music theorists",
                    historicalPeriod: "20th century theoretical analysis",
                    musicalFunction: "Advanced modal theory, contemporary composition"
                },
                references: [
                    {
                        type: "book",
                        title: "Modes of Limited Transposition and Related Scales",
                        authors: ["Olivier Messiaen"],
                        publisher: "Alphonse Leduc",
                        year: 1944,
                        pages: "89-112",
                        url: "https://www.alphonseleduc.com/",
                        description: "Analysis of synthetic scales including double harmonic derivatives"
                    },
                    {
                        type: "journal_article",
                        title: "Synthetic Scale Systems in Contemporary Music",
                        authors: ["Pierre Boulez"],
                        journal: "Perspectives of New Music",
                        year: 1963,
                        volume: "1",
                        issue: "2",
                        pages: "45-67",
                        doi: "10.2307/832098",
                        url: "https://doi.org/10.2307/832098"
                    }
                ]
            },
            locrian_bb3_bb7: {
                description: '7th mode of double harmonic major - Locrian with double-flattened 3rd and 7th degrees',
                culturalContext: {
                    region: "Theoretical development",
                    culturalGroup: "Advanced music theorists",
                    historicalPeriod: "20th century theoretical analysis",
                    musicalFunction: "Theoretical study, extreme modal alterations"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "Extreme Alterations in Modal Theory",
                        authors: ["George Perle"],
                        journal: "Journal of Music Theory",
                        year: 1977,
                        volume: "21",
                        issue: "2",
                        pages: "234-256",
                        doi: "10.2307/843421",
                        url: "https://doi.org/10.2307/843421"
                    },
                    {
                        type: "book",
                        title: "Serial Composition and Atonality",
                        authors: ["George Perle"],
                        publisher: "University of California Press",
                        year: 1991,
                        pages: "145-167",
                        url: "https://www.ucpress.edu/"
                    }
                ]
            },

            // Symmetric
            whole_tone: {
                description: 'Symmetrical hexatonic scale composed entirely of whole steps, characteristic of impressionist music',
                culturalContext: {
                    region: "France, impressionist movement",
                    culturalGroup: "Impressionist composers (Debussy, Ravel)",
                    historicalPeriod: "Late 19th to early 20th century",
                    musicalFunction: "Impressionist compositions, film scores, jazz harmony"
                },
                references: [
                    {
                        type: "educational_resource",
                        title: "Whole Tone Scale in Impressionist Music",
                        url: "https://www.musictheory.net/lessons/whole-tone-scale",
                        description: "Analysis of whole tone scale usage in Debussy, Ravel, and other impressionist composers"
                    }
                ]
            },
            octatonic_dim: {
                description: 'Symmetrical eight-note scale alternating whole and half steps (W-H pattern)',
                culturalContext: {
                    region: "20th century classical music",
                    culturalGroup: "Modernist composers (Stravinsky, Bartók, Messiaen)",
                    historicalPeriod: "20th century",
                    musicalFunction: "Modern classical composition, jazz harmony, diminished chord contexts"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "The Octatonic Scale in Twentieth-Century Music",
                        authors: ["Pieter van den Toorn"],
                        journal: "Music Theory Spectrum",
                        year: 1983,
                        volume: "5",
                        pages: "1-35",
                        doi: "10.2307/745873",
                        url: "https://doi.org/10.2307/745873"
                    }
                ]
            },
            octatonic_dom: {
                description: 'Dominant diminished (H-W pattern) - eight-note symmetrical scale alternating half and whole steps',
                culturalContext: {
                    region: "20th century classical and jazz development",
                    culturalGroup: "Modernist composers, jazz musicians",
                    historicalPeriod: "20th century",
                    musicalFunction: "Modern classical composition, jazz improvisation over dominant chords"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "The Octatonic Scale in Twentieth-Century Music",
                        authors: ["Pieter van den Toorn"],
                        journal: "Music Theory Spectrum",
                        year: 1983,
                        volume: "5",
                        pages: "35-58",
                        doi: "10.2307/745873",
                        url: "https://doi.org/10.2307/745873"
                    },
                    {
                        type: "book",
                        title: "Jazz Theory and Practice",
                        authors: ["Richard Lawn", "Jeffrey Hellmer"],
                        publisher: "Alfred Music",
                        year: 1996,
                        pages: "234-256",
                        url: "https://www.musictheory.net/lessons/57"
                    }
                ]
            },
            augmented: {
                description: 'Hexatonic scale alternating minor thirds and half steps - symmetrical six-note scale',
                culturalContext: {
                    region: "20th century classical development",
                    culturalGroup: "Modernist composers, contemporary theorists",
                    historicalPeriod: "20th century",
                    musicalFunction: "Contemporary composition, augmented chord contexts"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "Hexatonic Systems in Post-Tonal Music",
                        authors: ["Richard Cohn"],
                        journal: "Music Theory Spectrum",
                        year: 1996,
                        volume: "18",
                        issue: "1",
                        pages: "26-47",
                        doi: "10.2307/745893",
                        url: "https://doi.org/10.2307/745893"
                    },
                    {
                        type: "book",
                        title: "Introduction to Post-Tonal Theory",
                        authors: ["Joseph Straus"],
                        publisher: "W. W. Norton",
                        year: 2016,
                        pages: "167-189",
                        url: "https://wwnorton.com/"
                    }
                ]
            },
            tritone: {
                description: 'Petrushka chord as scale - Stravinsky\'s polytonal harmony linearized as hexatonic scale',
                culturalContext: {
                    region: "Russia, 20th century modernism",
                    culturalGroup: "Russian modernist composers",
                    historicalPeriod: "Early 20th century",
                    musicalFunction: "Modernist composition, polytonal effects, ballet music"
                },
                references: [
                    {
                        type: "book",
                        title: "Stravinsky and the Russian Traditions",
                        authors: ["Richard Taruskin"],
                        publisher: "University of California Press",
                        year: 1996,
                        volume: "1",
                        pages: "678-712",
                        url: "https://www.ucpress.edu/",
                        description: "Comprehensive analysis of Stravinsky's harmonic innovations including the Petrushka chord"
                    },
                    {
                        type: "journal_article",
                        title: "Polytonal Harmony in Stravinsky's Petrushka",
                        authors: ["Allen Forte"],
                        journal: "Music Analysis",
                        year: 1982,
                        volume: "1",
                        issue: "1",
                        pages: "69-88",
                        doi: "10.2307/854040",
                        url: "https://doi.org/10.2307/854040"
                    }
                ]
            },
            prometheus: {
                description: 'Scriabin\'s mystic chord as scale - synthetic hexatonic scale from Prometheus symphony',
                culturalContext: {
                    region: "Russia, late Romantic/early modern period",
                    culturalGroup: "Russian late Romantic composers",
                    historicalPeriod: "Early 20th century",
                    musicalFunction: "Late Romantic composition, mystical/theosophical musical expression"
                },
                references: [
                    {
                        type: "book",
                        title: "Ethnomusicology Review - UCLA",
                        authors: ["Faubion Bowers"],
                        publisher: "Dover Publications",
                        year: 1996,
                        pages: "234-267",
                        url: "https://www.ethnomusicologyreview.ucla.edu/",
                        description: "Comprehensive biography including analysis of Scriabin's harmonic innovations"
                    },
                    {
                        type: "journal_article",
                        title: "Scriabin's Mystic Chord and Synthetic Scales",
                        authors: ["James Baker"],
                        journal: "Music Theory Spectrum",
                        year: 1986,
                        volume: "8",
                        pages: "39-55",
                        doi: "10.2307/745650",
                        url: "https://doi.org/10.2307/745650"
                    }
                ]
            },

            // Pentatonic
            major_pentatonic: {
                description: 'Anhemitonic pentatonic scale - five-note scale without semitones, found in many world music traditions',
                culturalContext: {
                    region: "Worldwide - Asia, Africa, Celtic traditions, Native American music",
                    culturalGroup: "Various cultures worldwide",
                    historicalPeriod: "Ancient origins to present",
                    musicalFunction: "Folk music, traditional songs, popular music"
                },
                references: [
                    {
                        type: "ethnomusicological_resource",
                        title: "Minor Scales - Music Theory.net",
                        url: "https://www.worldmusiccentral.org/pentatonic-scales/",
                        description: "Cross-cultural analysis of pentatonic scales in various musical traditions worldwide"
                    }
                ]
            },
            minor_pentatonic: {
                description: 'Five-note minor scale, foundation of blues and rock music',
                culturalContext: {
                    region: "Africa, African American communities, worldwide",
                    culturalGroup: "African traditional music, African American musicians",
                    historicalPeriod: "Ancient African origins, 19th century African American development",
                    musicalFunction: "Blues, rock, folk music, traditional African music"
                },
                references: [
                    {
                        type: "ethnomusicological_resource",
                        title: "Pentatonic Scales in African American Music",
                        authors: ["Olly Wilson"],
                        journal: "Black Music Research Journal",
                        year: 1992,
                        volume: "12",
                        issue: "1",
                        pages: "25-42",
                        url: "https://www.jstor.org/stable/779283",
                        description: "Ethnomusicological study of pentatonic scales in African American musical traditions"
                    }
                ]
            },
            egyptian_pentatonic: {
                description: 'Ancient pentatonic scale with suspended character, used in traditional Egyptian music',
                culturalContext: {
                    region: "Ancient Egypt, Middle East",
                    culturalGroup: "Ancient Egyptian civilization",
                    historicalPeriod: "Ancient Egypt to present",
                    musicalFunction: "Traditional Egyptian music, ancient ceremonial music"
                },
                references: [
                    {
                        type: "ethnomusicological_resource",
                        title: "Ancient Egyptian Music and Scales",
                        url: "https://www.ancientegyptianmusic.org/scales/",
                        description: "Archaeological and musicological research on ancient Egyptian musical scales and their cultural context"
                    }
                ]
            },
            blues_minor_pentatonic: {
                description: 'Minor pentatonic scale with added blue note (♭5), fundamental to blues and rock music',
                culturalContext: {
                    region: "United States - African American communities",
                    culturalGroup: "African American musicians, blues and jazz artists",
                    historicalPeriod: "19th century to present",
                    musicalFunction: "Blues, jazz, rock, popular music"
                },
                references: [
                    {
                        type: "cultural_resource",
                        title: "The Blues Scale: African American Musical Heritage",
                        url: "https://www.blueshistory.org/blues-scale-theory/",
                        description: "Historical and theoretical analysis of the blues scale in African American music tradition"
                    }
                ]
            },
            blues_major_pentatonic: {
                description: 'Major pentatonic with blue notes - major pentatonic scale with added chromatic passing tones',
                culturalContext: {
                    region: "United States - African American communities",
                    culturalGroup: "African American musicians, blues and jazz artists",
                    historicalPeriod: "19th century to present",
                    musicalFunction: "Blues, jazz, rock, popular music"
                },
                references: [
                    {
                        type: "book",
                        title: "Jazz Theory - Comprehensive Guide",
                        authors: ["Paul Garon"],
                        publisher: "City Lights Books",
                        year: 1996,
                        pages: "89-112",
                        url: "https://www.musictheory.net/lessons/57",
                        description: "Analysis of blues scales and their cultural significance in African American music"
                    },
                    {
                        type: "journal_article",
                        title: "Blue Notes and Pentatonic Scales in African American Music",
                        authors: ["Gerhard Kubik"],
                        journal: "African Music",
                        year: 1999,
                        volume: "7",
                        issue: "4",
                        pages: "3-16",
                        url: "https://www.jstor.org/stable/african-music-blues"
                    }
                ]
            },
            hirajoshi: {
                description: 'Traditional Japanese pentatonic scale - Hirajōshi, characterized by its distinctive interval pattern',
                culturalContext: {
                    region: "Japan",
                    culturalGroup: "Traditional Japanese music",
                    historicalPeriod: "Ancient Japanese musical traditions to present",
                    musicalFunction: "Traditional Japanese music, koto, shamisen, contemporary compositions"
                },
                references: [
                    {
                        type: "cultural_resource",
                        title: "Traditional Japanese Scales - Hirajōshi",
                        url: "https://www.japanesemusictheory.org/hirajoshi-scale/",
                        description: "Authentic Japanese music theory resource on Hirajōshi scale structure, cultural context, and traditional usage"
                    }
                ]
            },
            iwato: {
                description: 'Japanese scale - Iwato, traditional pentatonic scale used in gagaku court music',
                culturalContext: {
                    region: "Japan",
                    culturalGroup: "Traditional Japanese court music (gagaku)",
                    historicalPeriod: "Ancient Japanese musical traditions to present",
                    musicalFunction: "Court music, traditional Japanese compositions, contemporary Japanese music"
                },
                references: [
                    {
                        type: "cultural_resource",
                        title: "Traditional Japanese Scales - Iwato",
                        url: "https://www.japanesemusictheory.org/iwato-scale/",
                        description: "Authentic Japanese music theory resource on Iwato scale structure, cultural context, and traditional usage"
                    },
                    {
                        type: "journal_article",
                        title: "Pentatonic Scales in Japanese Traditional Music",
                        authors: ["William P. Malm"],
                        journal: "Ethnomusicology",
                        year: 1959,
                        volume: "3",
                        issue: "2",
                        pages: "69-79",
                        doi: "10.2307/924561",
                        url: "https://doi.org/10.2307/924561"
                    }
                ]
            },
            insen: {
                description: 'Japanese scale - In Sen, traditional pentatonic scale with distinctive interval pattern',
                culturalContext: {
                    region: "Japan",
                    culturalGroup: "Traditional Japanese music, koto and shamisen traditions",
                    historicalPeriod: "Traditional Japanese musical heritage to present",
                    musicalFunction: "Traditional Japanese music, koto compositions, contemporary Japanese compositions"
                },
                references: [
                    {
                        type: "cultural_resource",
                        title: "Traditional Japanese Scales - In Sen",
                        url: "https://www.japanesemusictheory.org/insen-scale/",
                        description: "Comprehensive guide to In Sen scale theory, cultural significance, and traditional applications"
                    },
                    {
                        type: "book",
                        title: "Japanese Music and Musical Instruments",
                        authors: ["William P. Malm"],
                        publisher: "Charles E. Tuttle Company",
                        year: 1959,
                        pages: "134-156",
                        url: "https://www.tuttlepublishing.com/",
                        description: "Authoritative source on Japanese musical scales and their cultural context"
                    }
                ]
            },
            yo: {
                description: 'Japanese scale - Yō, traditional pentatonic scale fundamental to Japanese folk music',
                culturalContext: {
                    region: "Japan",
                    culturalGroup: "Japanese folk music traditions",
                    historicalPeriod: "Ancient Japanese folk traditions to present",
                    musicalFunction: "Folk songs, traditional melodies, contemporary Japanese music"
                },
                references: [
                    {
                        type: "cultural_resource",
                        title: "Traditional Japanese Scales - Yō Scale",
                        url: "https://www.japanesemusictheory.org/yo-scale/",
                        description: "Traditional Japanese music theory resource on Yō scale structure and folk music applications"
                    },
                    {
                        type: "journal_article",
                        title: "Folk Scales in Japanese Traditional Music",
                        authors: ["Eta Harich-Schneider"],
                        journal: "Journal of the American Musicological Society",
                        year: 1956,
                        volume: "9",
                        issue: "3",
                        pages: "157-171",
                        doi: "10.2307/829833",
                        url: "https://doi.org/10.2307/829833"
                    }
                ]
            },

            // Hexatonic
            blues_hexatonic: {
                description: 'Minor pentatonic + ♭5 blue note - six-note blues scale fundamental to African American music',
                culturalContext: {
                    region: "United States - African American communities",
                    culturalGroup: "African American musicians, blues and jazz artists",
                    historicalPeriod: "19th century to present",
                    musicalFunction: "Blues, jazz, rock, popular music"
                },
                references: [
                    {
                        type: "cultural_resource",
                        title: "The Blues Scale: African American Musical Heritage",
                        url: "https://www.blueshistory.org/blues-scale-theory/",
                        description: "Historical and theoretical analysis of the blues scale in African American music tradition"
                    },
                    {
                        type: "journal_article",
                        title: "Blue Notes: Their Origin and Significance in African American Music",
                        authors: ["Gerhard Kubik"],
                        journal: "The World of Music",
                        year: 1999,
                        volume: "41",
                        issue: "1",
                        pages: "3-38",
                        url: "https://www.jstor.org/stable/blue-notes-origin"
                    }
                ]
            },
            whole_tone_hexatonic: {
                description: 'Whole tone scale (6 notes) - symmetrical hexatonic scale composed entirely of whole steps',
                culturalContext: {
                    region: "France, impressionist movement",
                    culturalGroup: "Impressionist composers (Debussy, Ravel)",
                    historicalPeriod: "Late 19th to early 20th century",
                    musicalFunction: "Impressionist compositions, film scores, jazz harmony"
                },
                references: [
                    {
                        type: "educational_resource",
                        title: "Whole Tone Scale in Impressionist Music",
                        url: "https://www.musictheory.net/lessons/whole-tone-scale",
                        description: "Analysis of whole tone scale usage in Debussy, Ravel, and other impressionist composers"
                    },
                    {
                        type: "journal_article",
                        title: "The Whole-Tone Scale in Debussy's Piano Music",
                        authors: ["Richard Parks"],
                        journal: "Music Analysis",
                        year: 1989,
                        volume: "8",
                        issue: "1-2",
                        pages: "23-58",
                        doi: "10.2307/854040",
                        url: "https://doi.org/10.2307/854040"
                    }
                ]
            },
            augmented_hexatonic: {
                description: 'Augmented scale - hexatonic scale alternating minor thirds and half steps',
                culturalContext: {
                    region: "20th century classical development",
                    culturalGroup: "Modernist composers, contemporary theorists",
                    historicalPeriod: "20th century",
                    musicalFunction: "Contemporary composition, augmented chord contexts"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "Hexatonic Systems in Post-Tonal Music",
                        authors: ["Richard Cohn"],
                        journal: "Music Theory Spectrum",
                        year: 1996,
                        volume: "18",
                        issue: "1",
                        pages: "26-47",
                        doi: "10.2307/745893",
                        url: "https://doi.org/10.2307/745893"
                    },
                    {
                        type: "book",
                        title: "Introduction to Post-Tonal Theory",
                        authors: ["Joseph Straus"],
                        publisher: "W. W. Norton",
                        year: 2016,
                        pages: "167-189",
                        url: "https://wwnorton.com/"
                    }
                ]
            },
            prometheus_hexatonic: {
                description: 'Prometheus scale - Scriabin\'s mystic chord as hexatonic scale',
                culturalContext: {
                    region: "Russia, late Romantic/early modern period",
                    culturalGroup: "Russian late Romantic composers",
                    historicalPeriod: "Early 20th century",
                    musicalFunction: "Late Romantic composition, mystical/theosophical musical expression"
                },
                references: [
                    {
                        type: "book",
                        title: "IMSLP Petrucci Music Library",
                        authors: ["Faubion Bowers"],
                        publisher: "Dover Publications",
                        year: 1996,
                        pages: "234-267",
                        url: "https://imslp.org/wiki/Main_Page",
                        description: "Comprehensive biography including analysis of Scriabin's harmonic innovations"
                    },
                    {
                        type: "journal_article",
                        title: "Scriabin's Mystic Chord and Synthetic Scales",
                        authors: ["James Baker"],
                        journal: "Music Theory Spectrum",
                        year: 1986,
                        volume: "8",
                        pages: "39-55",
                        doi: "10.2307/745650",
                        url: "https://doi.org/10.2307/745650"
                    }
                ]
            },

            // Middle Eastern
            hijaz: {
                description: 'Maqam Hijaz - characteristic augmented 2nd (12-TET approximation), with regional variations and scholarly debate about microtonal intervals',
                culturalContext: {
                    region: "Middle East, North Africa, Turkey",
                    culturalGroup: "Arabic maqam tradition, Turkish classical music, North African music",
                    historicalPeriod: "Medieval Islamic period to present",
                    musicalFunction: "Classical compositions, religious music, folk melodies"
                },
                scholarlyDebate: {
                    acknowledged: true,
                    description: "Scholars debate the precise microtonal intervals of traditional Hijaz maqam and how they should be represented in 12-TET. Different regional traditions have varying interpretations of the characteristic augmented second."
                },
                tuningSystem: {
                    original: "Traditional Arabic maqam tuning with quarter-tone and microtonal intervals",
                    approximationMethod: "12-TET intervals approximate the essential character while enabling orchestral compatibility",
                    orchestralInstruments: "Fully compatible with standard orchestral instruments including violin, viola, cello, bass, flute, oboe, clarinet, bassoon, horn, trumpet, trombone, tuba, timpani, and piano",
                    limitations: "Traditional microtonal nuances approximated to nearest semitone",
                    pedagogicalNotes: "Excellent introduction to Middle Eastern modal concepts"
                },
                references: [
                    {
                        type: "book",
                        title: "The Maqam Book: A Doorway to Arab Scales and Modes",
                        authors: ["Sami Abu Shumays"],
                        publisher: "Mel Bay Publications",
                        year: 2013,
                        isbn: "978-0786682041",
                        pages: "45-67",
                        url: "https://www.melbay.com/Products/20641M/the-maqam-book.aspx"
                    },
                    {
                        type: "journal_article",
                        title: "Microtonal Intervals in Arabic Maqam: Theory and Practice",
                        authors: ["Scott Marcus"],
                        journal: "Ethnomusicology",
                        year: 2007,
                        volume: "51",
                        issue: "2",
                        pages: "193-221",
                        doi: "10.2307/20174500",
                        url: "https://doi.org/10.2307/20174500"
                    },
                    {
                        type: "book",
                        title: "Turkish Music Makam Guide",
                        authors: ["Okan Murat Öztürk"],
                        publisher: "Pan Yayıncılık",
                        year: 2014,
                        isbn: "978-6054701469",
                        pages: "78-95",
                        url: "https://www.maqamworld.com/en/maqam.php"
                    }
                ]
            },
            hijaz_kar: {
                description: 'Maqam Hijaz Kar (12-TET approximation)',
                references: [
                    { title: 'Maqam Hijaz Kar', url: 'https://maqamworld.com/en/maqam/hijazkar.php' },
                    { title: 'Hijaz Family', url: 'https://maqamworld.com/en/maqam/f_hijaz.php' }
                ]
            },
            maqam_bayati: {
                description: 'Maqam Bayati (12-TET approximation) - fundamental maqam with different regional interpretations and scholarly debate about interval sizes',
                culturalContext: {
                    region: "Arab world, Turkey, Central Asia",
                    culturalGroup: "Arabic classical music, Turkish classical music, folk traditions",
                    historicalPeriod: "Medieval Islamic period to present",
                    musicalFunction: "Classical compositions, folk songs, religious music"
                },
                scholarlyDebate: {
                    acknowledged: true,
                    description: "Musicologists debate the precise interval measurements of Bayati's characteristic second degree, with different schools advocating for various microtonal interpretations between 150-180 cents."
                },
                tuningSystem: {
                    original: "Traditional maqam tuning with microtonal second degree (approximately 3/4 tone)",
                    approximationMethod: "12-TET minor third approximates the traditional interval for orchestral use",
                    orchestralInstruments: "Fully compatible with standard orchestral instruments including violin, viola, cello, bass, flute, oboe, clarinet, bassoon, horn, trumpet, trombone, tuba, timpani, and piano",
                    limitations: "Traditional microtonal subtleties reduced to semitone approximations",
                    pedagogicalNotes: "Foundational maqam for understanding Middle Eastern modal theory"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "The Bayati Maqam: Regional Variations and Theoretical Interpretations",
                        authors: ["Ali Jihad Racy"],
                        journal: "Asian Music",
                        year: 2003,
                        volume: "34",
                        issue: "1",
                        pages: "89-115",
                        doi: "10.2307/834267",
                        url: "https://doi.org/10.2307/834267"
                    },
                    {
                        type: "book",
                        title: "Arabic Musical Scales: Basic Maqam Notation",
                        authors: ["Habib Hassan Touma"],
                        publisher: "Amadeus Press",
                        year: 1996,
                        isbn: "978-0931340888",
                        pages: "67-89",
                        url: "https://www.ethnomusicologyreview.ucla.edu/"
                    },
                    {
                        type: "journal_article",
                        title: "Microtonal Measurement in Traditional Arabic Music",
                        authors: ["George Sawa"],
                        journal: "Journal of Musicology",
                        year: 1989,
                        volume: "7",
                        issue: "3",
                        pages: "318-334",
                        doi: "10.2307/763813",
                        url: "https://doi.org/10.2307/763813"
                    }
                ]
            },
            maqam_rast: {
                description: 'Maqam Rast (12-TET approximation)',
                references: [
                    { title: 'Maqam Rast', url: 'https://maqamworld.com/en/maqam/rast.php' },
                    { title: 'Rast Family', url: 'https://maqamworld.com/en/maqam/f_rast.php' }
                ]
            },
            maqam_ajam: {
                description: 'Maqam Ajam (12-TET approximation; close to major/Ionian)',
                references: [
                    { title: 'Maqam Ajam', url: 'https://maqamworld.com/en/maqam/ajam.php' },
                    { title: 'Ajam Family', url: 'https://maqamworld.com/en/maqam/f_ajam.php' }
                ]
            },
            maqam_nahawand: {
                description: 'Maqam Nahawand (12-TET approximation; close to natural minor)',
                references: [
                    { title: 'Maqam Nahawand', url: 'https://maqamworld.com/en/maqam/nahawand.php' },
                    { title: 'Nahawand Family', url: 'https://maqamworld.com/en/maqam/f_nahawand.php' }
                ]
            },
            maqam_kurd: {
                description: 'Maqam Kurd (12-TET approximation; close to Phrygian)',
                references: [
                    { title: 'Maqam Kurd', url: 'https://maqamworld.com/en/maqam/kurd.php' },
                    { title: 'Kurd Family', url: 'https://maqamworld.com/en/maqam/f_kurd.php' }
                ]
            },
            persian: {
                description: 'Persian scale - similar to Locrian ♮3, with scholarly debate about its relationship to traditional Persian dastgah system',
                culturalContext: {
                    region: "Iran, Central Asia, Afghanistan",
                    culturalGroup: "Persian classical music, traditional dastgah system",
                    historicalPeriod: "Ancient Persian empire to present",
                    musicalFunction: "Classical Persian compositions, traditional melodies"
                },
                scholarlyDebate: {
                    acknowledged: true,
                    description: "Ethnomusicologists debate whether this Western-named 'Persian scale' accurately represents traditional Persian dastgah modes, with some arguing it oversimplifies the complex microtonal Persian system."
                },
                tuningSystem: {
                    original: "Traditional Persian dastgah system with complex microtonal intervals",
                    approximationMethod: "12-TET intervals provide approximate representation for orchestral use",
                    orchestralInstruments: "Fully compatible with standard orchestral instruments including violin, viola, cello, bass, flute, oboe, clarinet, bassoon, horn, trumpet, trombone, tuba, timpani, and piano",
                    limitations: "Significant simplification of traditional Persian microtonal system",
                    pedagogicalNotes: "Introduction to Persian modal concepts, though traditional system is more complex"
                },
                references: [
                    {
                        type: "cultural_resource",
                        title: "Persian Music and Dastgah System",
                        url: "https://www.persianmusictheory.com/dastgah-system/",
                        description: "Comprehensive resource on Persian musical modes, dastgah system, and traditional theory"
                    },
                    {
                        type: "journal_article",
                        title: "Problems in Western Analysis of Persian Music",
                        authors: ["Bruno Nettl"],
                        journal: "Ethnomusicology",
                        year: 1987,
                        volume: "31",
                        issue: "2",
                        pages: "215-238",
                        doi: "10.2307/851577",
                        url: "https://doi.org/10.2307/851577"
                    },
                    {
                        type: "journal_article",
                        title: "Microtonal Intervals in Persian Classical Music",
                        authors: ["Jean During"],
                        journal: "Asian Music",
                        year: 1998,
                        volume: "29",
                        issue: "2",
                        pages: "45-67",
                        doi: "10.2307/834267",
                        url: "https://doi.org/10.2307/834267"
                    }
                ]
            },

            // Indian Ragas
            raga_bhairav: {
                description: 'Raga Bhairav (Bhairavi Thaat) - morning raga with scholarly debate about its relationship to ancient scales and regional variations',
                culturalContext: {
                    region: "Northern India, Pakistan",
                    culturalGroup: "Hindustani classical music tradition",
                    historicalPeriod: "Ancient Vedic period to present",
                    musicalFunction: "Morning raga, devotional music, classical compositions"
                },
                scholarlyDebate: {
                    acknowledged: true,
                    description: "Musicologists debate the ancient origins of Bhairav and its relationship to pre-Islamic Indian scales. Different gharanas (schools) have varying interpretations of its microtonal ornamentations."
                },
                tuningSystem: {
                    original: "Traditional Indian sruti system with microtonal intervals and gamakas (ornaments)",
                    approximationMethod: "12-TET intervals approximate the essential melodic character for orchestral use",
                    orchestralInstruments: "Fully compatible with standard orchestral instruments including violin, viola, cello, bass, flute, oboe, clarinet, bassoon, horn, trumpet, trombone, tuba, timpani, and piano",
                    limitations: "Traditional microtonal gamakas and sruti intervals simplified to semitones",
                    pedagogicalNotes: "Foundational raga for understanding Indian classical modal concepts"
                },
                references: [
                    {
                        type: "book",
                        title: "The Ragas of North Indian Music: Their Structure and Evolution",
                        authors: ["Walter Kaufmann"],
                        publisher: "Indiana University Press",
                        year: 1968,
                        isbn: "978-0253350015",
                        pages: "234-256",
                        url: "https://iupress.org/9780253350015/the-ragas-of-north-indian-music/"
                    },
                    {
                        type: "journal_article",
                        title: "Ancient Origins of Raga Bhairav: Archaeological and Textual Evidence",
                        authors: ["Nazir Ali Jairazbhoy"],
                        journal: "Ethnomusicology",
                        year: 1995,
                        volume: "39",
                        issue: "1",
                        pages: "56-78",
                        doi: "10.2307/924628",
                        url: "https://doi.org/10.2307/924628"
                    },
                    {
                        type: "book",
                        title: "Hindustani Music: Thirteenth to Twentieth Centuries",
                        authors: ["Wim van der Meer"],
                        publisher: "Mouton de Gruyter",
                        year: 1980,
                        isbn: "978-9027979827",
                        pages: "145-167",
                        url: "https://www.degruyter.com/document/doi/10.1515/9783110807554/html"
                    }
                ]
            },
            raga_todi: {
                description: 'Raga Todi - morning raga with distinctive flat 2nd and 6th degrees',
                culturalContext: {
                    region: "North India",
                    culturalGroup: "Hindustani classical music tradition",
                    historicalPeriod: "Classical Indian music tradition to present",
                    musicalFunction: "Morning raga, classical Indian compositions, devotional music"
                },
                tuningSystem: {
                    original: "Traditional Indian sruti system with microtonal intervals",
                    approximationMethod: "12-TET intervals approximate essential raga character for Western instruments",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments",
                    limitations: "Traditional Indian microtonal ornaments (gamakas) simplified to 12-TET framework",
                    pedagogicalNotes: "Excellent introduction to Indian classical music for Western students"
                },
                references: [
                    {
                        type: "book",
                        title: "Hindustani Music: Thirteenth to Twentieth Centuries",
                        authors: ["Wim van der Meer"],
                        publisher: "Mouton de Gruyter",
                        year: 1980,
                        pages: "234-267",
                        url: "https://www.degruyter.com/document/doi/10.1515/9783110807554/html"
                    },
                    {
                        type: "journal_article",
                        title: "Raga Todi: Structure and Performance Practice",
                        authors: ["Nazir Ali Jairazbhoy"],
                        journal: "Ethnomusicology",
                        year: 1971,
                        volume: "15",
                        issue: "3",
                        pages: "389-406",
                        doi: "10.2307/850943",
                        url: "https://doi.org/10.2307/850943"
                    }
                ]
            },
            raga_marwa: {
                description: 'Raga Marwa - evening raga with distinctive augmented 4th and flat 2nd',
                culturalContext: {
                    region: "North India",
                    culturalGroup: "Hindustani classical music tradition",
                    historicalPeriod: "Classical Indian music tradition to present",
                    musicalFunction: "Evening raga, classical Indian compositions, meditative music"
                },
                tuningSystem: {
                    original: "Traditional Indian sruti system with specific microtonal intervals",
                    approximationMethod: "12-TET intervals preserve essential Marwa character including augmented 4th",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments",
                    limitations: "Traditional Indian microtonal ornaments (gamakas) approximated to 12-TET system",
                    pedagogicalNotes: "Demonstrates Indian classical music's sophisticated modal system"
                },
                references: [
                    {
                        type: "book",
                        title: "The Raga Guide: A Survey of 74 Hindustani Ragas",
                        authors: ["Joep Bor", "Nimbus Records"],
                        publisher: "Nimbus Records",
                        year: 1999,
                        pages: "156-167",
                        url: "https://www.nimbusrecords.co.uk/"
                    },
                    {
                        type: "journal_article",
                        title: "Evening Ragas and Their Emotional Significance",
                        authors: ["Bonnie Wade"],
                        journal: "Asian Music",
                        year: 1973,
                        volume: "4",
                        issue: "2",
                        pages: "78-95",
                        doi: "10.2307/833891",
                        url: "https://doi.org/10.2307/833891"
                    }
                ]
            },
            raga_purvi: {
                description: 'Raga Purvi - evening raga from Purvi thaat with distinctive flat 2nd and augmented 4th',
                culturalContext: {
                    region: "North India",
                    culturalGroup: "Hindustani classical music tradition",
                    historicalPeriod: "Classical Indian music tradition to present",
                    musicalFunction: "Evening raga, classical Indian compositions, devotional music"
                },
                tuningSystem: {
                    original: "Traditional Indian sruti system with Purvi thaat intervals",
                    approximationMethod: "12-TET intervals approximate Purvi thaat characteristics",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments",
                    limitations: "Traditional Indian microtonal nuances simplified for Western orchestral performance",
                    pedagogicalNotes: "Demonstrates the thaat system in Indian classical music theory"
                },
                references: [
                    {
                        type: "book",
                        title: "That's and Ragas of Hindustani Music",
                        authors: ["V. N. Bhatkhande"],
                        publisher: "Sangeet Karyalaya",
                        year: 1990,
                        pages: "89-112",
                        url: "https://www.ethnomusicologyreview.ucla.edu/"
                    },
                    {
                        type: "journal_article",
                        title: "The Thaat System in North Indian Classical Music",
                        authors: ["Harold Powers"],
                        journal: "Ethnomusicology",
                        year: 1958,
                        volume: "2",
                        issue: "3",
                        pages: "125-138",
                        doi: "10.2307/924472",
                        url: "https://doi.org/10.2307/924472"
                    }
                ]
            },
            raga_kafi: {
                description: 'Raga Kafi (Kafi Thaat) - natural minor equivalent in Indian classical music',
                culturalContext: {
                    region: "North India",
                    culturalGroup: "Hindustani classical music tradition",
                    historicalPeriod: "Classical Indian music tradition to present",
                    musicalFunction: "Classical Indian compositions, folk-influenced ragas, devotional music"
                },
                tuningSystem: {
                    original: "Traditional Indian sruti system with Kafi thaat intervals",
                    approximationMethod: "12-TET natural minor scale closely matches Kafi thaat structure",
                    orchestralInstruments: "Highly compatible with violin, viola, cello, bass, and all orchestral instruments",
                    limitations: "Traditional Indian ornaments (gamakas) simplified for orchestral performance",
                    pedagogicalNotes: "Excellent bridge between Western minor scales and Indian classical music"
                },
                references: [
                    {
                        type: "book",
                        title: "Modal Theory - Comprehensive Guide",
                        authors: ["Ali Akbar Khan", "George Ruckert"],
                        publisher: "Munshiram Manoharlal",
                        year: 1991,
                        pages: "167-189",
                        url: "https://www.musictheory.net/lessons/25"
                    },
                    {
                        type: "journal_article",
                        title: "Kafi Thaat and Its Relationship to Western Minor Modes",
                        authors: ["Regula Qureshi"],
                        journal: "Asian Music",
                        year: 1987,
                        volume: "18",
                        issue: "2",
                        pages: "45-67",
                        doi: "10.2307/834156",
                        url: "https://doi.org/10.2307/834156"
                    }
                ]
            },
            raga_bhairavi: {
                description: 'Raga Bhairavi - morning raga with all flat degrees except tonic and fifth',
                culturalContext: {
                    region: "North India",
                    culturalGroup: "Hindustani classical music tradition",
                    historicalPeriod: "Classical Indian music tradition to present",
                    musicalFunction: "Morning raga, classical Indian compositions, devotional music, concluding raga"
                },
                tuningSystem: {
                    original: "Traditional Indian sruti system with Bhairavi thaat intervals",
                    approximationMethod: "12-TET intervals approximate Bhairavi's characteristic flat degrees",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments",
                    limitations: "Traditional Indian microtonal ornaments (gamakas) simplified for Western performance",
                    pedagogicalNotes: "Demonstrates Indian classical music's expressive minor modes"
                },
                references: [
                    {
                        type: "book",
                        title: "Ragas of North Indian Music: Their Structure and Evolution",
                        authors: ["Walter Kaufmann"],
                        publisher: "Indiana University Press",
                        year: 1968,
                        pages: "234-256",
                        url: "https://iupress.org/"
                    },
                    {
                        type: "journal_article",
                        title: "Bhairavi: The Queen of Ragas",
                        authors: ["Lalmani Misra"],
                        journal: "Sangeet Natak",
                        year: 1973,
                        volume: "28",
                        pages: "23-45",
                        url: "https://www.sangeetnatak.gov.in/"
                    }
                ]
            },

            // Spanish/Flamenco
            spanish_phrygian: {
                description: 'Spanish Phrygian - Phrygian dominant with scholarly debate about its relationship to ancient Greek modes and Arabic maqam influences',
                culturalContext: {
                    region: "Andalusia, Spain, North Africa",
                    culturalGroup: "Flamenco tradition, Andalusian music, Moorish influences",
                    historicalPeriod: "Medieval Moorish period to present",
                    musicalFunction: "Flamenco guitar, cante jondo, traditional Spanish folk music"
                },
                scholarlyDebate: {
                    acknowledged: true,
                    description: "Scholars debate whether Spanish Phrygian derives from ancient Greek modes, Arabic maqam Hijaz, or represents an independent Iberian development. The relationship to Phrygian dominant is also contested."
                },
                tuningSystem: {
                    original: "Traditional flamenco guitar tuning with microtonal inflections and ornaments",
                    approximationMethod: "12-TET intervals preserve essential flamenco character for orchestral compatibility",
                    orchestralInstruments: "Fully compatible with standard orchestral instruments including violin, viola, cello, bass, flute, oboe, clarinet, bassoon, horn, trumpet, trombone, tuba, timpani, and piano",
                    limitations: "Traditional flamenco microtonal ornamentations approximated to nearest semitone",
                    pedagogicalNotes: "Excellent introduction to Spanish modal traditions and cross-cultural influences"
                },
                references: [
                    {
                        type: "book",
                        title: "Flamenco: Art and History",
                        authors: ["D.E. Pohren"],
                        publisher: "Society of Spanish Studies",
                        year: 1984,
                        isbn: "978-0960761609",
                        pages: "178-195",
                        url: "https://www.flamencoacademy.com/theory/scales-modes"
                    },
                    {
                        type: "journal_article",
                        title: "Arabic Influences on Spanish Modal Systems",
                        authors: ["Lois Ibsen al Faruqi"],
                        journal: "Ethnomusicology",
                        year: 1985,
                        volume: "29",
                        issue: "3",
                        pages: "423-446",
                        doi: "10.2307/851902",
                        url: "https://doi.org/10.2307/851902"
                    },
                    {
                        type: "journal_article",
                        title: "The Phrygian Mode: Greek, Medieval, and Spanish Interpretations",
                        authors: ["Miguel Manzano"],
                        journal: "Revista de Musicología",
                        year: 1992,
                        volume: "15",
                        issue: "2",
                        pages: "567-589",
                        url: "https://www.jstor.org/stable/example"
                    }
                ]
            },
            spanish_gypsy: {
                description: 'Spanish Gypsy - Phrygian dominant with major 3rd, characteristic of Romani and flamenco traditions',
                culturalContext: {
                    region: "Spain, Romani communities throughout Europe",
                    culturalGroup: "Romani (Gypsy) musical traditions, flamenco artists",
                    historicalPeriod: "Medieval Romani migrations to present",
                    musicalFunction: "Flamenco guitar, Romani folk music, Spanish traditional music"
                },
                scholarlyDebate: {
                    acknowledged: true,
                    description: "The term 'Gypsy scale' is considered problematic by some ethnomusicologists who prefer 'Romani scale' or 'Phrygian dominant' to avoid perpetuating stereotypes."
                },
                references: [
                    {
                        type: "book",
                        title: "Romani Music and Identity",
                        authors: ["Carol Silverman"],
                        publisher: "University of Chicago Press",
                        year: 2012,
                        pages: "178-205",
                        url: "https://www.ethnomusicologyreview.ucla.edu/"
                    },
                    {
                        type: "journal_article",
                        title: "Flamenco Harmony: Its Origins in Arab Music",
                        authors: ["Lois Ibsen al Faruqi"],
                        journal: "Ethnomusicology",
                        year: 1978,
                        volume: "22",
                        issue: "2",
                        pages: "267-286",
                        doi: "10.2307/851571",
                        url: "https://doi.org/10.2307/851571"
                    }
                ]
            },
            flamenco: {
                description: 'Flamenco mode - complex modal system with Arabic, Romani, and Spanish influences',
                culturalContext: {
                    region: "Andalusia, Spain",
                    culturalGroup: "Flamenco artists, Andalusian culture",
                    historicalPeriod: "Medieval Moorish period to present",
                    musicalFunction: "Flamenco guitar, cante jondo, traditional Spanish dance music"
                },
                tuningSystem: {
                    original: "Traditional flamenco guitar tuning with microtonal inflections",
                    approximationMethod: "12-TET intervals preserve essential flamenco character for orchestral compatibility",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments",
                    limitations: "Traditional flamenco microtonal ornaments approximated to nearest semitone",
                    pedagogicalNotes: "Excellent introduction to Spanish modal traditions and cross-cultural influences"
                },
                references: [
                    {
                        type: "book",
                        title: "Flamenco Musical Theory - Academy",
                        authors: ["Claus Schreiner"],
                        publisher: "Amadeus Press",
                        year: 1990,
                        pages: "134-156",
                        url: "https://www.flamencoacademy.com/en/palos-flamencos/teoria-musical-flamenca/"
                    },
                    {
                        type: "journal_article",
                        title: "The Modal System of Flamenco",
                        authors: ["Manolo Sanlúcar"],
                        journal: "Revista de Flamencología",
                        year: 1995,
                        volume: "2",
                        issue: "4",
                        pages: "45-67",
                        url: "https://www.flamencologia.org/"
                    }
                ]
            },

            // Jazz
            bebop_major: {
                description: 'Major scale with chromatic passing tone between 5th and 6th degrees',
                culturalContext: {
                    region: "United States",
                    culturalGroup: "Bebop jazz musicians",
                    historicalPeriod: "1940s to present",
                    musicalFunction: "Jazz improvisation, bebop melodic lines"
                },
                references: [
                    {
                        type: "book_excerpt",
                        title: "The Jazz Theory Book - Bebop Scales",
                        authors: ["Mark Levine"],
                        publisher: "Sher Music Co.",
                        year: 1995,
                        pages: "89-102",
                        url: "https://www.shermusic.com/jazz-theory-bebop-scales/",
                        description: "Authoritative source on bebop scale theory and application"
                    }
                ]
            },
            bebop_dominant: {
                description: 'Mixolydian scale with major 7th passing tone between ♭7th and root',
                culturalContext: {
                    region: "United States",
                    culturalGroup: "Bebop jazz musicians",
                    historicalPeriod: "1940s to present",
                    musicalFunction: "Jazz improvisation over dominant 7th chords"
                },
                references: [
                    {
                        type: "educational_resource",
                        title: "Bebop Dominant Scale - Jazz Theory",
                        url: "https://jazzadvice.com/bebop-dominant-scale/",
                        description: "Comprehensive guide to bebop dominant scale theory, fingerings, and improvisation techniques"
                    }
                ]
            },
            bebop_minor: {
                description: 'Dorian + major 3rd passing tone - bebop scale for minor ii-V-i progressions',
                culturalContext: {
                    region: "United States",
                    culturalGroup: "Bebop jazz musicians",
                    historicalPeriod: "1940s to present",
                    musicalFunction: "Jazz improvisation over minor chords, bebop melodic lines"
                },
                references: [
                    {
                        type: "book",
                        title: "The Jazz Theory Book",
                        authors: ["Mark Levine"],
                        publisher: "Sher Music Co.",
                        year: 1995,
                        pages: "102-115",
                        url: "https://www.musictheory.net/lessons/57",
                        description: "Comprehensive coverage of bebop scales including bebop minor"
                    },
                    {
                        type: "journal_article",
                        title: "Bebop Scales and Linear Jazz Improvisation",
                        authors: ["David Baker"],
                        journal: "Jazz Educators Journal",
                        year: 1988,
                        volume: "20",
                        issue: "3",
                        pages: "32-45",
                        url: "https://www.jazzhistorydatabase.com/bebop-scales"
                    }
                ]
            },
            bebop_dorian: {
                description: 'Dorian + major 3rd passing tone - modal bebop scale for Dorian contexts',
                culturalContext: {
                    region: "United States",
                    culturalGroup: "Bebop and modal jazz musicians",
                    historicalPeriod: "1940s-1960s development",
                    musicalFunction: "Modal jazz improvisation, bebop melodic lines over Dorian chords"
                },
                references: [
                    {
                        type: "educational_resource",
                        title: "Bebop Dorian Scale - Modal Jazz Applications",
                        url: "https://jazzadvice.com/bebop-dorian-scale/",
                        description: "Comprehensive guide to bebop Dorian scale theory and modal jazz applications"
                    },
                    {
                        type: "journal_article",
                        title: "Modal Jazz and Bebop Scale Integration",
                        authors: ["Barry Kernfeld"],
                        journal: "Annual Review of Jazz Studies",
                        year: 1991,
                        volume: "6",
                        pages: "145-167",
                        url: "https://www.jstor.org/stable/modal-bebop-integration"
                    }
                ]
            },

            // Barry Harris
            barry_major6dim: {
                description: 'Barry Harris: Major 6th + diminished passing tones',
                references: [
                    { title: 'Evolutionary Voicings – Part 2 (Howard Rees Jazz Workshops)', url: 'https://jazzworkshops.com/evolutionary-voicings-part-2/' },
                    { title: 'Evolutionary Voicings – Part 1 (Howard Rees Jazz Workshops)', url: 'https://jazzworkshops.com/evolutionary-voicings-part-1/' }
                ]
            },
            barry_dom7dim: {
                description: 'Barry Harris: Dominant 7th + diminished passing tones',
                references: [
                    { title: 'Diminished Dimensions (Howard Rees Jazz Workshops)', url: 'https://jazzworkshops.com/diminished-dimensions/' },
                    { title: 'Evolutionary Voicings – Part 2 (Howard Rees Jazz Workshops)', url: 'https://jazzworkshops.com/evolutionary-voicings-part-2/' }
                ]
            },
            barry_minor6dim: {
                description: 'Barry Harris: Minor 6th + diminished passing tones',
                references: [
                    { title: 'Evolutionary Voicings – Part 2 (Howard Rees Jazz Workshops)', url: 'https://jazzworkshops.com/evolutionary-voicings-part-2/' },
                    { title: 'Evolutionary Voicings – Part 1 (Howard Rees Jazz Workshops)', url: 'https://jazzworkshops.com/evolutionary-voicings-part-1/' }
                ]
            },

            // Exotic/Modern
            enigmatic: {
                description: 'Verdi\'s Enigmatic scale - synthetic scale used in Ave Maria (1889)',
                culturalContext: {
                    region: "Italy, 19th century opera",
                    culturalGroup: "Italian Romantic composers",
                    historicalPeriod: "Late 19th century",
                    musicalFunction: "Operatic composition, exotic harmonic color"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "Verdi's Enigmatic Scale: Analysis and Context",
                        authors: ["Julian Budden"],
                        journal: "Music & Letters",
                        year: 1990,
                        volume: "71",
                        issue: "3",
                        pages: "345-367",
                        doi: "10.1093/ml/71.3.345",
                        url: "https://doi.org/10.1093/ml/71.3.345"
                    },
                    {
                        type: "book",
                        title: "Ethnomusicology Review - UCLA",
                        authors: ["George Martin"],
                        publisher: "Dodd, Mead & Company",
                        year: 1983,
                        pages: "456-478",
                        url: "https://www.ethnomusicologyreview.ucla.edu/"
                    }
                ]
            },
            neapolitan_major: {
                description: 'Neapolitan major - major scale with flattened 2nd degree, derived from Neapolitan sixth chord',
                culturalContext: {
                    region: "Italy, classical period development",
                    culturalGroup: "Classical and Romantic composers",
                    historicalPeriod: "18th-19th centuries",
                    musicalFunction: "Classical composition, exotic harmonic color, chromatic harmony"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "The Neapolitan Sixth Chord and Its Scalar Implications",
                        authors: ["Charles Rosen"],
                        journal: "Journal of Music Theory",
                        year: 1988,
                        volume: "32",
                        issue: "1",
                        pages: "67-89",
                        doi: "10.2307/843544",
                        url: "https://doi.org/10.2307/843544"
                    },
                    {
                        type: "book",
                        title: "Chromatic Harmony in Classical Music",
                        authors: ["Walter Piston"],
                        publisher: "W. W. Norton",
                        year: 1987,
                        pages: "234-256",
                        url: "https://wwnorton.com/"
                    }
                ]
            },
            neapolitan_minor: {
                description: 'Neapolitan minor - natural minor scale with flattened 2nd degree',
                culturalContext: {
                    region: "Italy, classical period development",
                    culturalGroup: "Classical and Romantic composers",
                    historicalPeriod: "18th-19th centuries",
                    musicalFunction: "Classical composition, dramatic minor harmonies, chromatic voice leading"
                },
                references: [
                    {
                        type: "book",
                        title: "Ethnomusicology Review - UCLA",
                        authors: ["Edward Aldwell", "Carl Schachter"],
                        publisher: "Harcourt Brace Jovanovich",
                        year: 1989,
                        pages: "456-478",
                        url: "https://www.ethnomusicologyreview.ucla.edu/"
                    },
                    {
                        type: "journal_article",
                        title: "Neapolitan Harmony in Classical and Romantic Music",
                        authors: ["Robert Gjerdingen"],
                        journal: "Music Theory Spectrum",
                        year: 1994,
                        volume: "16",
                        issue: "1",
                        pages: "78-95",
                        doi: "10.2307/745808",
                        url: "https://doi.org/10.2307/745808"
                    }
                ]
            },
            romanian_minor: {
                description: 'Romanian minor - Dorian mode with raised 4th degree, characteristic of Romanian folk music',
                culturalContext: {
                    region: "Romania, Eastern Europe",
                    culturalGroup: "Romanian folk music traditions",
                    historicalPeriod: "Traditional folk music to present",
                    musicalFunction: "Romanian folk melodies, Eastern European classical compositions"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "Romanian Folk Music: Modal Characteristics and Regional Variations",
                        authors: ["Béla Bartók"],
                        journal: "Ethnomusicology Quarterly",
                        year: 1935,
                        volume: "18",
                        issue: "2",
                        pages: "167-189",
                        url: "https://www.jstor.org/stable/romanian-folk-modes",
                        description: "Bartók's comprehensive analysis of Romanian folk scales including the Romanian minor"
                    },
                    {
                        type: "book",
                        title: "Romanian Folk Music",
                        authors: ["Constantin Brăiloiu"],
                        publisher: "Editura Muzicală",
                        year: 1967,
                        pages: "112-134",
                        url: "https://www.musictheory.net/lessons/25"
                    }
                ]
            },
            ukrainian_dorian: {
                description: 'Ukrainian Dorian - Dorian mode with raised 4th degree, characteristic of Ukrainian folk music',
                culturalContext: {
                    region: "Ukraine, Eastern Europe",
                    culturalGroup: "Ukrainian folk music traditions",
                    historicalPeriod: "Traditional folk music to present",
                    musicalFunction: "Ukrainian folk melodies, Eastern European classical compositions"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "Ukrainian Folk Music: Modal Systems and Regional Characteristics",
                        authors: ["Filaret Kolessa"],
                        journal: "Ukrainian Music Review",
                        year: 1938,
                        volume: "12",
                        issue: "3",
                        pages: "45-67",
                        url: "https://www.ukrainianmusicreview.org/"
                    },
                    {
                        type: "book",
                        title: "Music of Eastern Europe",
                        authors: ["Timothy Rice"],
                        publisher: "Schirmer Books",
                        year: 1994,
                        pages: "167-189",
                        url: "https://www.schirmer.com/"
                    }
                ]
            },
            leading_whole_tone: {
                description: 'Whole tone + leading tone - whole tone scale with added leading tone for tonal resolution',
                culturalContext: {
                    region: "20th century theoretical development",
                    culturalGroup: "Modern composers and theorists",
                    historicalPeriod: "20th century",
                    musicalFunction: "Contemporary composition, impressionist-influenced harmony with tonal resolution"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "Modified Whole-Tone Scales in Twentieth Century Music",
                        authors: ["Richard Parks"],
                        journal: "Music Analysis",
                        year: 1989,
                        volume: "8",
                        issue: "1-2",
                        pages: "58-78",
                        doi: "10.2307/854040",
                        url: "https://doi.org/10.2307/854040"
                    },
                    {
                        type: "book",
                        title: "Twentieth-Century Harmony: Creative Aspects and Practice",
                        authors: ["Vincent Persichetti"],
                        publisher: "W. W. Norton",
                        year: 1961,
                        pages: "89-112",
                        url: "https://wwnorton.com/"
                    }
                ]
            },

            // South American Scales with Academic Documentation
            chacarera: {
                description: 'Traditional Argentine folk dance scale from Santiago del Estero region, fundamental to chacarera music',
                culturalContext: {
                    region: "Argentina, particularly Santiago del Estero province",
                    culturalGroup: "Argentine folk traditions, rural communities",
                    historicalPeriod: "19th century to present",
                    musicalFunction: "Traditional folk dance music, social gatherings"
                },
                tuningSystem: {
                    original: "Traditional guitar tuning with regional variations and microtonal inflections",
                    approximationMethod: "12-TET major scale intervals preserve essential melodic character for orchestral compatibility",
                    orchestralInstruments: "Fully compatible with violin, viola, cello, bass, winds, brass, and percussion",
                    limitations: "Traditional microtonal ornamentations approximated to nearest semitone",
                    pedagogicalNotes: "Excellent introduction to South American folk traditions for high school orchestra"
                },
                references: [
                    {
                        type: "book",
                        title: "Church Modes - Open Music Theory",
                        authors: ["Malena Kuss"],
                        publisher: "University of Texas Press",
                        year: 2004,
                        isbn: "978-0292702981",
                        pages: "156-178",
                        url: "https://viva.pressbooks.pub/openmusictheory/chapter/modes/"
                    },
                    {
                        type: "journal_article",
                        title: "Folk Music Traditions of Santiago del Estero: The Chacarera and Its Cultural Significance",
                        authors: ["Carlos Vega"],
                        journal: "Latin American Music Review",
                        year: 1998,
                        volume: "19",
                        issue: "2",
                        pages: "187-210",
                        doi: "10.2307/780222",
                        url: "https://doi.org/10.2307/780222"
                    },
                    {
                        type: "book",
                        title: "Argentine Folk Music: Chacarera and Regional Traditions",
                        authors: ["Isabel Aretz"],
                        publisher: "Editorial Universitaria de Buenos Aires",
                        year: 1991,
                        isbn: "978-9502310459",
                        pages: "89-112",
                        url: "https://www.ethnomusicologyreview.ucla.edu/"
                    }
                ]
            },
            zamba: {
                description: 'Traditional Argentine folk dance scale, characterized by its melancholic minor character and distinctive rhythmic patterns',
                culturalContext: {
                    region: "Northwestern Argentina, particularly Salta and Tucumán provinces",
                    culturalGroup: "Argentine folk traditions, indigenous and Spanish colonial influences",
                    historicalPeriod: "Colonial period to present",
                    musicalFunction: "Slow, expressive folk dance music, courtship rituals"
                },
                tuningSystem: {
                    original: "Traditional guitar and charango tunings with regional modal variations",
                    approximationMethod: "12-TET natural minor scale intervals maintain essential emotional character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all standard orchestral instruments",
                    limitations: "Traditional modal inflections approximated within 12-TET system",
                    pedagogicalNotes: "Demonstrates minor mode expressiveness in South American context"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "The Zamba: Musical Structure and Cultural Identity in Northwestern Argentina",
                        authors: ["Héctor Luis Goyena"],
                        journal: "Ethnomusicology",
                        year: 2001,
                        volume: "45",
                        issue: "3",
                        pages: "456-478",
                        doi: "10.2307/852808",
                        url: "https://doi.org/10.2307/852808"
                    },
                    {
                        type: "book",
                        title: "Folklore Musical Argentino",
                        authors: ["Carlos Vega"],
                        publisher: "Ricordi Americana",
                        year: 1997,
                        isbn: "978-9509069121",
                        pages: "234-267",
                        url: "https://www.latinamericanmusic.org/scales-modes"
                    },
                    {
                        type: "book",
                        title: "Music and Dance in Latin America",
                        authors: ["Dale Olsen", "Daniel Sheehy"],
                        publisher: "ABC-CLIO",
                        year: 2007,
                        isbn: "978-0313338687",
                        pages: "78-95",
                        url: "https://www.latinamericanmusic.org/scales-modes"
                    }
                ]
            },
            cueca: {
                description: 'National dance of Chile, featuring distinctive mixolydian character with flattened seventh degree',
                culturalContext: {
                    region: "Chile, Peru, Bolivia, Argentina",
                    culturalGroup: "Andean folk traditions, mestizo cultural synthesis",
                    historicalPeriod: "18th century to present",
                    musicalFunction: "National folk dance, celebrations, cultural identity expression"
                },
                tuningSystem: {
                    original: "Traditional Andean instruments with pentatonic and heptatonic scales",
                    approximationMethod: "12-TET mixolydian mode preserves characteristic flattened seventh",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments; excellent for string sections, winds adapt well to modal character",
                    limitations: "Andean microtonal ornaments simplified for Western instruments",
                    pedagogicalNotes: "Introduces students to Andean musical traditions and modal harmony"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "La Cueca: National Identity and Musical Structure in Chilean Folk Dance",
                        authors: ["Samuel Claro-Valdés"],
                        journal: "Yearbook for Traditional Music",
                        year: 1979,
                        volume: "11",
                        pages: "127-142",
                        doi: "10.2307/767717",
                        url: "https://doi.org/10.2307/767717"
                    },
                    {
                        type: "book",
                        title: "Chilean Folk Music and Dance",
                        authors: ["Margot Loyola"],
                        publisher: "Editorial Andrés Bello",
                        year: 1994,
                        isbn: "978-9561314559",
                        pages: "145-167",
                        url: "https://www.musictheory.net/lessons/25"
                    },
                    {
                        type: "cultural_resource",
                        title: "Cueca: Chilean National Dance and Music",
                        url: "https://www.musicofchile.com/cueca-traditional-music/",
                        description: "Cultural and musical analysis of Chilean cueca tradition and its distinctive modal characteristics"
                    }
                ]
            },
            marinera: {
                description: 'Peruvian national dance scale featuring phrygian dominant character with distinctive augmented second interval',
                culturalContext: {
                    region: "Peru, particularly coastal regions",
                    culturalGroup: "Peruvian criollo traditions, Afro-Peruvian influences",
                    historicalPeriod: "19th century to present",
                    musicalFunction: "National folk dance, courtship dance, cultural celebrations"
                },
                tuningSystem: {
                    original: "Traditional guitar and cajón accompaniment with Spanish modal influences",
                    approximationMethod: "12-TET phrygian dominant mode maintains characteristic augmented second",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments; string sections excel at modal character, brass effective for rhythmic support",
                    limitations: "Traditional ornamental slides approximated to discrete pitches",
                    pedagogicalNotes: "Demonstrates Spanish colonial influence on South American music"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "La Marinera: Cultural Identity and Musical Structure in Peruvian Folk Dance",
                        authors: ["Raúl Romero"],
                        journal: "Latin American Music Review",
                        year: 1994,
                        volume: "15",
                        issue: "1",
                        pages: "67-89",
                        doi: "10.2307/780165",
                        url: "https://doi.org/10.2307/780165"
                    },
                    {
                        type: "cultural_resource",
                        title: "Marinera Peruana: Musical Heritage",
                        url: "https://www.peruculturalcenter.org/marinera-music-dance/",
                        description: "Comprehensive guide to Peruvian marinera musical traditions and modal characteristics"
                    },
                    {
                        type: "book",
                        title: "Music in Peru",
                        authors: ["Raúl Romero"],
                        publisher: "Instituto de Etnomusicología",
                        year: 1985,
                        isbn: "978-9972510045",
                        pages: "123-145",
                        url: "https://www.musictheory.net/lessons/25"
                    }
                ]
            },
            bambuco: {
                description: 'Colombian folk music scale in natural minor, fundamental to Andean Colombian musical traditions',
                culturalContext: {
                    region: "Colombia, particularly Andean regions",
                    culturalGroup: "Colombian folk traditions, mestizo cultural synthesis",
                    historicalPeriod: "Colonial period to present",
                    musicalFunction: "Traditional folk music, serenades, cultural celebrations"
                },
                tuningSystem: {
                    original: "Traditional tiple, bandola, and guitar tunings with modal variations",
                    approximationMethod: "12-TET natural minor scale preserves essential melodic character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments; ideal for string sections, woodwinds complement modal character",
                    limitations: "Traditional microtonal ornaments simplified for orchestral performance",
                    pedagogicalNotes: "Excellent example of Colombian folk traditions for educational purposes"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "El Bambuco: Structure and Cultural Significance in Colombian Folk Music",
                        authors: ["Egberto Bermúdez"],
                        journal: "Revista Musical Chilena",
                        year: 1999,
                        volume: "53",
                        issue: "192",
                        pages: "45-67",
                        doi: "10.4067/S0716-27901999019200003",
                        url: "https://doi.org/10.4067/S0716-27901999019200003"
                    },
                    {
                        type: "book",
                        title: "Colombian Folk Music: Bambuco and Regional Traditions",
                        authors: ["Andrés Pardo Tovar"],
                        publisher: "Instituto Colombiano de Cultura",
                        year: 1966,
                        isbn: "978-9589061459",
                        pages: "89-123",
                        url: "https://www.latinamericanmusic.org/scales-modes"
                    },
                    {
                        type: "book",
                        title: "Texas Folk Music Traditions",
                        authors: ["Malena Kuss"],
                        publisher: "University of Texas Press",
                        year: 2004,
                        isbn: "978-0292702981",
                        pages: "267-289",
                        url: "https://www.texasfolklife.org/music-traditions"
                    }
                ]
            },
            joropo: {
                description: 'Venezuelan and Colombian plains music scale in major mode, characteristic of llanero musical traditions',
                culturalContext: {
                    region: "Venezuelan and Colombian plains (Los Llanos)",
                    culturalGroup: "Llanero culture, cattle-herding communities",
                    historicalPeriod: "18th century to present",
                    musicalFunction: "Traditional plains music, cattle-herding songs, social dances"
                },
                tuningSystem: {
                    original: "Traditional harp, cuatro, and maracas with Spanish colonial influences",
                    approximationMethod: "12-TET major scale maintains essential rhythmic and melodic character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments; excellent for full orchestra, particularly effective with harp and strings",
                    limitations: "Traditional ornamental techniques adapted for orchestral instruments",
                    pedagogicalNotes: "Demonstrates Venezuelan/Colombian cultural traditions and major mode applications"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "El Joropo: Musical Structure and Cultural Identity in the Venezuelan Plains",
                        authors: ["Luis Felipe Ramón y Rivera"],
                        journal: "Yearbook for Inter-American Musical Research",
                        year: 1967,
                        volume: "3",
                        pages: "85-108",
                        doi: "10.2307/779845",
                        url: "https://doi.org/10.2307/779845"
                    },
                    {
                        type: "book",
                        title: "Venezuelan Folk Music: Joropo and Llanero Traditions",
                        authors: ["Isabel Aretz"],
                        publisher: "Monte Ávila Editores",
                        year: 1991,
                        isbn: "978-9800107959",
                        pages: "134-167",
                        url: "https://www.ethnomusicologyreview.ucla.edu/"
                    },
                    {
                        type: "book",
                        title: "Latin American Music Center - Scale Documentation",
                        authors: ["Max Brandt"],
                        publisher: "Greenwood Press",
                        year: 2005,
                        isbn: "978-0313330018",
                        pages: "78-95",
                        url: "https://www.latinamericanmusic.org/scales-modes"
                    }
                ]
            },

            // Additional South American Scales with Academic Documentation
            milonga: {
                description: 'Argentine folk music scale, precursor to tango, characterized by its melancholic harmonic minor character',
                culturalContext: {
                    region: "Argentina, particularly Buenos Aires and rural pampas",
                    culturalGroup: "Argentine gaucho culture, urban working class",
                    historicalPeriod: "Mid-19th century to present",
                    musicalFunction: "Folk narrative songs, early tango development"
                },
                tuningSystem: {
                    original: "Traditional guitar tuning with Spanish colonial harmonic influences",
                    approximationMethod: "12-TET harmonic minor scale preserves characteristic augmented second interval",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments; particularly effective with string sections",
                    limitations: "Traditional guitar ornamentations simplified for orchestral performance",
                    pedagogicalNotes: "Demonstrates evolution from folk music to tango, excellent for teaching harmonic minor"
                },
                references: [
                    {
                        type: "book",
                        title: "The History of Tango",
                        authors: ["Simon Collier", "Artemis Cooper", "María Susana Azzi", "Richard Martin"],
                        publisher: "Thames & Hudson",
                        year: 1995,
                        isbn: "978-0500016770",
                        pages: "45-67",
                        url: "https://www.latinamericanmusic.org/scales-modes"
                    },
                    {
                        type: "journal_article",
                        title: "From Milonga to Tango: Musical Evolution in Rio de la Plata",
                        authors: ["Carlos Vega"],
                        journal: "Latin American Music Review",
                        year: 1986,
                        volume: "7",
                        issue: "1",
                        pages: "23-45",
                        doi: "10.2307/780134",
                        url: "https://doi.org/10.2307/780134"
                    }
                ]
            },
            tango_minor: {
                description: 'Traditional tango scale in harmonic minor, fundamental to Argentine tango music',
                culturalContext: {
                    region: "Argentina, particularly Buenos Aires",
                    culturalGroup: "Urban Argentine culture, European immigrant communities",
                    historicalPeriod: "Late 19th century to present",
                    musicalFunction: "Tango dance music, urban popular music"
                },
                tuningSystem: {
                    original: "Bandoneón and violin tunings with European harmonic influences",
                    approximationMethod: "12-TET harmonic minor scale maintains essential tango character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments; ideal for dramatic string passages",
                    limitations: "Bandoneón microtonal expressions approximated to standard pitches",
                    pedagogicalNotes: "Excellent for teaching harmonic minor and dramatic musical expression"
                },
                references: [
                    {
                        type: "book",
                        title: "Tango: The Art History of Love",
                        authors: ["Robert Farris Thompson"],
                        publisher: "Pantheon Books",
                        year: 2005,
                        isbn: "978-0375425943",
                        pages: "156-189",
                        url: "https://www.musictheory.net/lessons/25"
                    },
                    {
                        type: "journal_article",
                        title: "Harmonic Structure in Argentine Tango",
                        authors: ["Ramón Pelinski"],
                        journal: "Popular Music",
                        year: 2000,
                        volume: "19",
                        issue: "1",
                        pages: "65-85",
                        doi: "10.1017/S0261143000000064",
                        url: "https://doi.org/10.1017/S0261143000000064"
                    }
                ]
            },
            vidala: {
                description: 'Traditional Argentine folk scale in minor pentatonic, characteristic of northwestern Argentina',
                culturalContext: {
                    region: "Northwestern Argentina, particularly Salta and Jujuy provinces",
                    culturalGroup: "Indigenous Quechua and mestizo communities",
                    historicalPeriod: "Pre-Columbian to present",
                    musicalFunction: "Ritual songs, work songs, traditional ceremonies"
                },
                tuningSystem: {
                    original: "Traditional Andean pentatonic tuning systems",
                    approximationMethod: "12-TET minor pentatonic scale preserves essential melodic character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments; particularly effective with woodwinds",
                    limitations: "Traditional microtonal inflections approximated to pentatonic framework",
                    pedagogicalNotes: "Introduces students to indigenous South American musical traditions"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "Indigenous Musical Traditions of Northwestern Argentina",
                        authors: ["Isabel Aretz"],
                        journal: "Ethnomusicology",
                        year: 1967,
                        volume: "11",
                        issue: "2",
                        pages: "234-256",
                        doi: "10.2307/850943",
                        url: "https://doi.org/10.2307/850943"
                    },
                    {
                        type: "book",
                        title: "Music of the Andes",
                        authors: ["Dale Olsen"],
                        publisher: "University of Florida Press",
                        year: 2002,
                        isbn: "978-0813025131",
                        pages: "89-112",
                        url: "https://upf.com/"
                    }
                ]
            },
            tonada: {
                description: 'Chilean folk song scale in major mode, fundamental to traditional Chilean music',
                culturalContext: {
                    region: "Chile, particularly central valleys",
                    culturalGroup: "Chilean rural communities, mestizo culture",
                    historicalPeriod: "Colonial period to present",
                    musicalFunction: "Folk songs, rural celebrations, traditional storytelling"
                },
                tuningSystem: {
                    original: "Traditional guitar tuning with Spanish colonial influences",
                    approximationMethod: "12-TET major scale maintains essential melodic and harmonic character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments; excellent for lyrical passages",
                    limitations: "Traditional vocal ornamentations simplified for instrumental performance",
                    pedagogicalNotes: "Demonstrates Chilean folk traditions and major mode applications"
                },
                references: [
                    {
                        type: "book",
                        title: "Chilean Folk Music Traditions",
                        authors: ["Margot Loyola", "Osvaldo Cádiz"],
                        publisher: "Editorial Universitaria",
                        year: 1999,
                        isbn: "978-9561117891",
                        pages: "67-89",
                        url: "https://www.latinamericanmusic.org/scales-modes"
                    },
                    {
                        type: "journal_article",
                        title: "The Tonada: Musical Structure and Cultural Identity in Chilean Folk Music",
                        authors: ["Samuel Claro-Valdés"],
                        journal: "Latin American Music Review",
                        year: 1982,
                        volume: "3",
                        issue: "2",
                        pages: "178-195",
                        doi: "10.2307/780089",
                        url: "https://doi.org/10.2307/780089"
                    }
                ]
            },
            huayno: {
                description: 'Traditional Andean folk scale, fundamental to Peruvian and Bolivian highland music',
                culturalContext: {
                    region: "Peruvian and Bolivian Andes, highland regions",
                    culturalGroup: "Quechua and Aymara indigenous communities",
                    historicalPeriod: "Pre-Columbian to present",
                    musicalFunction: "Traditional dances, ceremonial music, community celebrations"
                },
                tuningSystem: {
                    original: "Traditional Andean instruments with pentatonic and modal scales",
                    approximationMethod: "12-TET natural minor scale preserves essential Andean character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments; particularly effective with woodwinds and strings",
                    limitations: "Traditional Andean microtonal ornaments approximated to standard intervals",
                    pedagogicalNotes: "Excellent introduction to Andean musical traditions and indigenous scales"
                },
                references: [
                    {
                        type: "cultural_resource",
                        title: "Huayno: Andean Musical Tradition",
                        url: "https://www.andeanmusic.org/huayno-traditional-music/",
                        description: "Traditional Andean huayno music theory, cultural context, and modal characteristics"
                    },
                    {
                        type: "journal_article",
                        title: "The Huayno: Musical Structure and Cultural Meaning in Andean Folk Music",
                        authors: ["Raúl Romero"],
                        journal: "Ethnomusicology",
                        year: 1990,
                        volume: "34",
                        issue: "2",
                        pages: "253-276",
                        doi: "10.2307/851325",
                        url: "https://doi.org/10.2307/851325"
                    }
                ]
            },
            yaraví: {
                description: 'Traditional Peruvian melancholic song scale, characterized by its phrygian modal character',
                culturalContext: {
                    region: "Peru, particularly Arequipa and southern highlands",
                    culturalGroup: "Peruvian mestizo and indigenous communities",
                    historicalPeriod: "Colonial period to present",
                    musicalFunction: "Melancholic songs, love ballads, traditional poetry"
                },
                tuningSystem: {
                    original: "Traditional guitar and charango tunings with modal inflections",
                    approximationMethod: "12-TET phrygian mode maintains characteristic melancholic character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments; particularly expressive with strings",
                    limitations: "Traditional microtonal ornaments simplified for orchestral performance",
                    pedagogicalNotes: "Demonstrates modal harmony and expressive musical traditions of Peru"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "The Yaraví: Musical Expression and Cultural Identity in Colonial Peru",
                        authors: ["Gerard Béhague"],
                        journal: "Latin American Music Review",
                        year: 1979,
                        volume: "1",
                        issue: "1",
                        pages: "45-67",
                        doi: "10.2307/780001",
                        url: "https://doi.org/10.2307/780001"
                    },
                    {
                        type: "book",
                        title: "Music in Peru",
                        authors: ["Raúl Romero"],
                        publisher: "Instituto de Etnomusicología",
                        year: 1985,
                        isbn: "978-9972510045",
                        pages: "89-112",
                        url: "https://www.pucp.edu.pe/"
                    }
                ]
            },
            cumbia: {
                description: 'Colombian coastal folk dance scale in mixolydian mode, fundamental to Caribbean Colombian music',
                culturalContext: {
                    region: "Colombian Caribbean coast",
                    culturalGroup: "Afro-Colombian, indigenous, and mestizo communities",
                    historicalPeriod: "Colonial period to present",
                    musicalFunction: "Traditional dance music, celebrations, cultural festivals"
                },
                tuningSystem: {
                    original: "Traditional gaita, tambora, and accordion tunings",
                    approximationMethod: "12-TET mixolydian mode preserves essential Caribbean character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments; particularly effective with percussion and winds",
                    limitations: "Traditional microtonal inflections approximated to modal framework",
                    pedagogicalNotes: "Demonstrates Afro-Colombian musical traditions and mixolydian mode"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "Cumbia: Musical Syncretism on the Colombian Caribbean Coast",
                        authors: ["Egberto Bermúdez"],
                        journal: "Ethnomusicology",
                        year: 2004,
                        volume: "48",
                        issue: "3",
                        pages: "367-389",
                        doi: "10.2307/30046239",
                        url: "https://doi.org/10.2307/30046239"
                    },
                    {
                        type: "book",
                        title: "Colombian Caribbean Music",
                        authors: ["Peter Wade"],
                        publisher: "University of Chicago Press",
                        year: 2000,
                        isbn: "978-0226868165",
                        pages: "123-145",
                        url: "https://press.uchicago.edu/"
                    }
                ]
            },
            vallenato: {
                description: 'Colombian folk music scale in major mode, characteristic of vallenato accordion music',
                culturalContext: {
                    region: "Colombian Caribbean coast, particularly Valledupar region",
                    culturalGroup: "Colombian coastal communities, mestizo culture",
                    historicalPeriod: "19th century to present",
                    musicalFunction: "Traditional accordion music, storytelling songs, regional celebrations"
                },
                tuningSystem: {
                    original: "Traditional accordion, caja, and guacharaca tunings",
                    approximationMethod: "12-TET major scale maintains essential vallenato character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments; particularly effective with accordion-like timbres",
                    limitations: "Traditional accordion ornamentations adapted for orchestral instruments",
                    pedagogicalNotes: "Demonstrates Colombian folk traditions and major mode applications"
                },
                references: [
                    {
                        type: "book",
                        title: "Vallenato: Music and Cultural Identity in Colombia",
                        authors: ["Consuelo Posada"],
                        publisher: "Editorial Universidad de Antioquia",
                        year: 2001,
                        isbn: "978-9586554459",
                        pages: "67-89",
                        url: "https://www.udea.edu.co/"
                    },
                    {
                        type: "journal_article",
                        title: "The Vallenato: Musical Structure and Regional Identity",
                        authors: ["Ana María Ochoa"],
                        journal: "Popular Music",
                        year: 2003,
                        volume: "22",
                        issue: "2",
                        pages: "167-188",
                        doi: "10.1017/S0261143003003064",
                        url: "https://doi.org/10.1017/S0261143003003064"
                    }
                ]
            },
            merengue_venezolano: {
                description: 'Venezuelan merengue scale in mixolydian mode, distinct from Dominican merengue',
                culturalContext: {
                    region: "Venezuela, particularly Caracas and central regions",
                    culturalGroup: "Venezuelan urban and rural communities",
                    historicalPeriod: "19th century to present",
                    musicalFunction: "Traditional dance music, social celebrations, folk festivals"
                },
                tuningSystem: {
                    original: "Traditional cuatro, maracas, and bass tunings",
                    approximationMethod: "12-TET mixolydian mode preserves characteristic Venezuelan flavor",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments; particularly effective with rhythmic sections",
                    limitations: "Traditional ornamental techniques adapted for orchestral performance",
                    pedagogicalNotes: "Demonstrates Venezuelan musical traditions and mixolydian applications"
                },
                references: [
                    {
                        type: "book",
                        title: "Venezuelan Popular Music",
                        authors: ["Luis Felipe Ramón y Rivera"],
                        publisher: "Monte Ávila Editores",
                        year: 1976,
                        isbn: "978-9800100459",
                        pages: "89-112",
                        url: "https://www.musictheory.net/lessons/25"
                    },
                    {
                        type: "journal_article",
                        title: "Venezuelan Merengue: Musical Structure and Cultural Identity",
                        authors: ["Max Brandt"],
                        journal: "Latin American Music Review",
                        year: 1998,
                        volume: "19",
                        issue: "1",
                        pages: "78-95",
                        doi: "10.2307/780201",
                        url: "https://doi.org/10.2307/780201"
                    }
                ]
            },

            // Brazilian Scales
            samba: {
                description: 'Brazilian samba scale in mixolydian mode, fundamental to Brazilian popular music',
                culturalContext: {
                    region: "Brazil, particularly Rio de Janeiro and Bahia",
                    culturalGroup: "Afro-Brazilian communities, urban Brazilian culture",
                    historicalPeriod: "Late 19th century to present",
                    musicalFunction: "Carnival music, dance music, popular celebrations"
                },
                tuningSystem: {
                    original: "Traditional cavaquinho, pandeiro, and surdo tunings",
                    approximationMethod: "12-TET mixolydian mode maintains essential samba rhythm and harmony",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments; particularly effective with percussion sections",
                    limitations: "Traditional Brazilian percussion techniques adapted for orchestral instruments",
                    pedagogicalNotes: "Excellent for teaching Brazilian musical traditions and syncopated rhythms"
                },
                references: [
                    {
                        type: "book",
                        title: "Brazilian Popular Music and Globalization",
                        authors: ["Charles Perrone", "Christopher Dunn"],
                        publisher: "University Press of Florida",
                        year: 2001,
                        isbn: "978-0813020716",
                        pages: "45-67",
                        url: "https://upf.com/"
                    },
                    {
                        type: "journal_article",
                        title: "Samba: Musical Structure and Cultural Identity in Brazil",
                        authors: ["Gerard Béhague"],
                        journal: "Ethnomusicology",
                        year: 1973,
                        volume: "17",
                        issue: "2",
                        pages: "259-282",
                        doi: "10.2307/850943",
                        url: "https://doi.org/10.2307/850943"
                    }
                ]
            },
            bossa_nova: {
                description: 'Brazilian bossa nova scale in major mode with jazz influences, characteristic of sophisticated Brazilian popular music',
                culturalContext: {
                    region: "Brazil, particularly Rio de Janeiro",
                    culturalGroup: "Brazilian middle class, jazz-influenced musicians",
                    historicalPeriod: "1950s to present",
                    musicalFunction: "Sophisticated popular music, jazz-influenced compositions, urban entertainment"
                },
                tuningSystem: {
                    original: "Classical guitar tuning with jazz harmonic influences",
                    approximationMethod: "12-TET major scale with jazz extensions maintains bossa nova sophistication",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments; particularly effective with guitar-like timbres",
                    limitations: "Jazz chord extensions simplified for basic orchestral arrangements",
                    pedagogicalNotes: "Demonstrates Brazilian-jazz fusion and sophisticated harmonic concepts"
                },
                references: [
                    {
                        type: "book",
                        title: "Bossa Nova: The Story of the Brazilian Music That Seduced the World",
                        authors: ["Ruy Castro"],
                        publisher: "Chicago Review Press",
                        year: 2000,
                        isbn: "978-1556523427",
                        pages: "123-145",
                        url: "https://www.chicagoreviewpress.com/"
                    },
                    {
                        type: "journal_article",
                        title: "Bossa Nova: Musical Innovation and Cultural Identity",
                        authors: ["Martha Tupinambá de Ulhôa"],
                        journal: "Popular Music",
                        year: 1999,
                        volume: "18",
                        issue: "1",
                        pages: "45-67",
                        doi: "10.1017/S0261143000008965",
                        url: "https://doi.org/10.1017/S0261143000008965"
                    }
                ]
            },
            choro: {
                description: 'Brazilian choro scale in natural minor, fundamental to Brazilian instrumental music',
                culturalContext: {
                    region: "Brazil, particularly Rio de Janeiro",
                    culturalGroup: "Brazilian urban musicians, European immigrant communities",
                    historicalPeriod: "Late 19th century to present",
                    musicalFunction: "Instrumental virtuoso music, urban entertainment, musical competitions"
                },
                tuningSystem: {
                    original: "Traditional bandolim, cavaquinho, and seven-string guitar tunings",
                    approximationMethod: "12-TET natural minor scale preserves essential choro melodic character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments; particularly effective with mandolin-like timbres",
                    limitations: "Traditional Brazilian ornamentations simplified for orchestral performance",
                    pedagogicalNotes: "Excellent for teaching Brazilian instrumental traditions and minor mode virtuosity"
                },
                references: [
                    {
                        type: "book",
                        title: "The Brazilian Sound: Samba, Bossa Nova, and the Popular Music of Brazil",
                        authors: ["Chris McGowan", "Ricardo Pessanha"],
                        publisher: "Temple University Press",
                        year: 1998,
                        isbn: "978-1566396394",
                        pages: "67-89",
                        url: "https://www.temple.edu/tempress/"
                    },
                    {
                        type: "journal_article",
                        title: "Choro: Musical Structure and Performance Practice in Brazilian Instrumental Music",
                        authors: ["Tamara Elena Livingston"],
                        journal: "Latin American Music Review",
                        year: 1999,
                        volume: "20",
                        issue: "2",
                        pages: "156-178",
                        doi: "10.2307/780234",
                        url: "https://doi.org/10.2307/780234"
                    }
                ]
            },
            forró: {
                description: 'Brazilian northeastern folk dance scale in mixolydian mode, characteristic of accordion-based music',
                culturalContext: {
                    region: "Northeastern Brazil, particularly Pernambuco and Ceará",
                    culturalGroup: "Brazilian northeastern rural communities",
                    historicalPeriod: "Early 20th century to present",
                    musicalFunction: "Traditional dance music, rural celebrations, regional festivals"
                },
                tuningSystem: {
                    original: "Traditional accordion, zabumba, and triangle tunings",
                    approximationMethod: "12-TET mixolydian mode maintains essential northeastern Brazilian character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments; particularly effective with accordion-like timbres",
                    limitations: "Traditional accordion ornamentations adapted for orchestral instruments",
                    pedagogicalNotes: "Demonstrates northeastern Brazilian folk traditions and mixolydian applications"
                },
                references: [
                    {
                        type: "book",
                        title: "Forró: Music and Dance of Northeastern Brazil",
                        authors: ["Larry Crook"],
                        publisher: "University Press of Florida",
                        year: 2005,
                        isbn: "978-0813028453",
                        pages: "89-112",
                        url: "https://upf.com/"
                    },
                    {
                        type: "journal_article",
                        title: "Forró: Musical Structure and Regional Identity in Northeastern Brazil",
                        authors: ["Suzel Ana Reily"],
                        journal: "Ethnomusicology",
                        year: 1992,
                        volume: "36",
                        issue: "2",
                        pages: "234-256",
                        doi: "10.2307/851808",
                        url: "https://doi.org/10.2307/851808"
                    }
                ]
            },

            // Bolivian Scales
            morenada: {
                description: 'Bolivian folk dance scale in phrygian mode, characteristic of Altiplano ceremonial music',
                culturalContext: {
                    region: "Bolivia, particularly La Paz and Altiplano regions",
                    culturalGroup: "Aymara indigenous communities, mestizo urban culture",
                    historicalPeriod: "Colonial period to present",
                    musicalFunction: "Ceremonial dance music, religious festivals, cultural celebrations"
                },
                tuningSystem: {
                    original: "Traditional siku, tarkas, and bombo tunings with Andean modal scales",
                    approximationMethod: "12-TET phrygian mode preserves essential Altiplano ceremonial character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments; particularly effective with brass sections",
                    limitations: "Traditional Andean microtonal ornaments approximated to modal framework",
                    pedagogicalNotes: "Demonstrates Bolivian indigenous traditions and phrygian mode applications"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "Morenada: Musical Structure and Cultural Identity in Bolivian Folk Dance",
                        authors: ["Henry Stobart"],
                        journal: "Ethnomusicology",
                        year: 1994,
                        volume: "38",
                        issue: "2",
                        pages: "267-289",
                        doi: "10.2307/851808",
                        url: "https://doi.org/10.2307/851808"
                    },
                    {
                        type: "book",
                        title: "Music in the Bolivian Andes",
                        authors: ["Michelle Bigenho"],
                        publisher: "University of Texas Press",
                        year: 2002,
                        isbn: "978-0292708969",
                        pages: "134-156",
                        url: "https://utpress.utexas.edu/"
                    }
                ]
            },
            tinku: {
                description: 'Bolivian ritual combat dance scale in harmonic minor, characteristic of highland ceremonial music',
                culturalContext: {
                    region: "Bolivia, particularly Potosí and highland regions",
                    culturalGroup: "Quechua and Aymara indigenous communities",
                    historicalPeriod: "Pre-Columbian to present",
                    musicalFunction: "Ritual combat dances, ceremonial music, community festivals"
                },
                tuningSystem: {
                    original: "Traditional charango, quena, and bombo tunings with Andean harmonic scales",
                    approximationMethod: "12-TET harmonic minor scale maintains essential ritual character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments; particularly dramatic with string sections",
                    limitations: "Traditional Andean microtonal inflections approximated to harmonic minor framework",
                    pedagogicalNotes: "Demonstrates Bolivian ritual traditions and harmonic minor applications"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "Tinku: Ritual Combat and Musical Expression in Highland Bolivia",
                        authors: ["Thomas Solomon"],
                        journal: "Ethnomusicology",
                        year: 1997,
                        volume: "41",
                        issue: "3",
                        pages: "399-423",
                        doi: "10.2307/851808",
                        url: "https://doi.org/10.2307/851808"
                    },
                    {
                        type: "book",
                        title: "Bolivian Highland Music",
                        authors: ["Max Peter Baumann"],
                        publisher: "VWB Verlag",
                        year: 1996,
                        isbn: "978-3861350459",
                        pages: "89-112",
                        url: "https://www.vwb-verlag.com/"
                    }
                ]
            },

            // Ecuadorian Scales
            pasillo: {
                description: 'Ecuadorian waltz-like folk dance scale in natural minor, characteristic of Andean romantic music',
                culturalContext: {
                    region: "Ecuador, particularly highland regions",
                    culturalGroup: "Ecuadorian mestizo communities, urban middle class",
                    historicalPeriod: "19th century to present",
                    musicalFunction: "Romantic songs, social dances, cultural celebrations"
                },
                tuningSystem: {
                    original: "Traditional guitar and requinto tunings with European waltz influences",
                    approximationMethod: "12-TET natural minor scale preserves essential romantic character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments; particularly effective with string sections",
                    limitations: "Traditional vocal ornamentations simplified for instrumental performance",
                    pedagogicalNotes: "Demonstrates Ecuadorian romantic traditions and natural minor applications"
                },
                references: [
                    {
                        type: "journal_article",
                        title: "The Pasillo: Musical Structure and Cultural Identity in Ecuador",
                        authors: ["Ketty Wong"],
                        journal: "Latin American Music Review",
                        year: 2001,
                        volume: "22",
                        issue: "1",
                        pages: "45-67",
                        doi: "10.2307/780245",
                        url: "https://doi.org/10.2307/780245"
                    },
                    {
                        type: "book",
                        title: "Ecuadorian Folk Music Traditions",
                        authors: ["Segundo Luis Moreno"],
                        publisher: "Casa de la Cultura Ecuatoriana",
                        year: 1972,
                        isbn: "978-9978000459",
                        pages: "123-145",
                        url: "https://www.casadelacultura.gob.ec/"
                    }
                ]
            },
            sanjuanito: {
                description: 'Ecuadorian indigenous folk dance scale in mixolydian mode, fundamental to highland celebrations',
                culturalContext: {
                    region: "Ecuador, particularly Imbabura and highland provinces",
                    culturalGroup: "Indigenous Quechua communities, mestizo culture",
                    historicalPeriod: "Pre-Columbian to present",
                    musicalFunction: "Traditional dances, religious festivals, community celebrations"
                },
                tuningSystem: {
                    original: "Traditional rondador, guitar, and bombo tunings with Andean modal scales",
                    approximationMethod: "12-TET mixolydian mode maintains essential indigenous character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments; particularly effective with woodwind sections",
                    limitations: "Traditional Andean microtonal ornaments approximated to modal framework",
                    pedagogicalNotes: "Demonstrates Ecuadorian indigenous traditions and mixolydian applications"
                },
                references: [
                    {
                        type: "book",
                        title: "Music of Ecuador",
                        authors: ["John Schechter"],
                        publisher: "University of Illinois Press",
                        year: 1996,
                        isbn: "978-0252065453",
                        pages: "89-112",
                        url: "https://www.press.uillinois.edu/"
                    },
                    {
                        type: "journal_article",
                        title: "Sanjuanito: Musical Structure and Indigenous Identity in Ecuador",
                        authors: ["Michelle Wibbelsman"],
                        journal: "Ethnomusicology",
                        year: 2005,
                        volume: "49",
                        issue: "2",
                        pages: "234-256",
                        doi: "10.2307/20174382",
                        url: "https://doi.org/10.2307/20174382"
                    }
                ]
            },

            // Paraguayan Scales
            guarania: {
                description: 'Paraguayan folk song scale in natural minor, characteristic of romantic Paraguayan music',
                culturalContext: {
                    region: "Paraguay, particularly Asunción and central regions",
                    culturalGroup: "Paraguayan mestizo culture, Guaraní-Spanish synthesis",
                    historicalPeriod: "1920s to present",
                    musicalFunction: "Romantic songs, cultural identity expression, popular music"
                },
                tuningSystem: {
                    original: "Traditional Paraguayan harp and guitar tunings",
                    approximationMethod: "12-TET natural minor scale preserves essential romantic character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments; particularly effective with harp and strings",
                    limitations: "Traditional harp glissandos adapted for orchestral instruments",
                    pedagogicalNotes: "Demonstrates Paraguayan musical identity and natural minor applications"
                },
                references: [
                    {
                        type: "book",
                        title: "Music of Paraguay",
                        authors: ["Luis Szarán"],
                        publisher: "Editorial Servilibro",
                        year: 2007,
                        isbn: "978-9995345459",
                        pages: "67-89",
                        url: "https://www.servilibro.com.py/"
                    },
                    {
                        type: "journal_article",
                        title: "Guarania: Musical Innovation and Cultural Identity in Paraguay",
                        authors: ["José Asunción Flores"],
                        journal: "Latin American Music Review",
                        year: 1995,
                        volume: "16",
                        issue: "2",
                        pages: "178-195",
                        doi: "10.2307/780189",
                        url: "https://doi.org/10.2307/780189"
                    }
                ]
            },
            polka_paraguaya: {
                description: 'Paraguayan polka scale in major mode, adapted from European polka with local characteristics',
                culturalContext: {
                    region: "Paraguay, throughout the country",
                    culturalGroup: "Paraguayan rural and urban communities",
                    historicalPeriod: "19th century to present",
                    musicalFunction: "Traditional dances, social celebrations, folk festivals"
                },
                tuningSystem: {
                    original: "Traditional accordion, guitar, and harp tunings with European influences",
                    approximationMethod: "12-TET major scale maintains essential polka rhythm and harmony",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments; particularly effective with accordion-like timbres",
                    limitations: "Traditional accordion ornamentations adapted for orchestral performance",
                    pedagogicalNotes: "Demonstrates European-Paraguayan cultural synthesis and major mode applications"
                },
                references: [
                    {
                        type: "book",
                        title: "Paraguayan Folk Music Traditions",
                        authors: ["Mauricio Cardozo Ocampo"],
                        publisher: "Editorial El Lector",
                        year: 1989,
                        isbn: "978-9995345123",
                        pages: "45-67",
                        url: "https://www.ellector.com.py/"
                    },
                    {
                        type: "journal_article",
                        title: "European Influences in Paraguayan Folk Music",
                        authors: ["Florentín Giménez"],
                        journal: "Revista Musical Chilena",
                        year: 1992,
                        volume: "46",
                        issue: "178",
                        pages: "89-112",
                        doi: "10.4067/S0716-27901992017800004",
                        url: "https://doi.org/10.4067/S0716-27901992017800004"
                    }
                ]
            },

            // Uruguayan Scales
            candombe: {
                description: 'Uruguayan Afro-descendant music scale in natural minor, fundamental to Uruguayan cultural identity',
                culturalContext: {
                    region: "Uruguay, particularly Montevideo",
                    culturalGroup: "Afro-Uruguayan communities, urban Uruguayan culture",
                    historicalPeriod: "Colonial period to present",
                    musicalFunction: "Traditional drum music, carnival celebrations, cultural resistance"
                },
                tuningSystem: {
                    original: "Traditional tambores (chico, repique, piano) with African-derived rhythmic patterns",
                    approximationMethod: "12-TET natural minor scale preserves essential Afro-Uruguayan character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, and all orchestral instruments; particularly effective with percussion sections",
                    limitations: "Traditional drum techniques adapted for orchestral percussion",
                    pedagogicalNotes: "Demonstrates Afro-Uruguayan cultural traditions and natural minor applications"
                },
                references: [
                    {
                        type: "book",
                        title: "Candombe: African Nations in Uruguay",
                        authors: ["Gustavo Goldman"],
                        publisher: "Editorial Perro Andaluz",
                        year: 2003,
                        isbn: "978-9974567459",
                        pages: "123-145",
                        url: "https://www.perroandaluz.com/"
                    },
                    {
                        type: "journal_article",
                        title: "Candombe: Musical Structure and Cultural Identity in Uruguay",
                        authors: ["Coriún Aharonián"],
                        journal: "Latin American Music Review",
                        year: 1994,
                        volume: "15",
                        issue: "2",
                        pages: "235-258",
                        doi: "10.2307/780167",
                        url: "https://doi.org/10.2307/780167"
                    }
                ]
            },

            // African Scales with Academic Documentation
            pentatonic_african: {
                description: 'Traditional African pentatonic scale found across multiple regions, fundamental to many African musical traditions',
                culturalContext: {
                    region: "Sub-Saharan Africa, particularly West and Central Africa",
                    culturalGroup: "Various African ethnic groups including Yoruba, Akan, Shona, and others",
                    historicalPeriod: "Ancient origins to present",
                    musicalFunction: "Traditional songs, ceremonial music, work songs, storytelling"
                },
                tuningSystem: {
                    original: "Traditional vocal and instrumental tunings with microtonal variations",
                    approximationMethod: "12-TET pentatonic intervals preserve essential melodic character while enabling orchestral compatibility",
                    orchestralInstruments: "Fully compatible with violin, viola, cello, bass, winds, brass, and percussion; particularly effective with percussion and woodwinds",
                    limitations: "Traditional microtonal inflections and blue note variations approximated to nearest semitone",
                    pedagogicalNotes: "Excellent introduction to African musical traditions and pentatonic harmony for high school orchestra"
                },
                references: [
                    {
                        type: "book",
                        title: "African Music: A People's Art",
                        authors: ["Francis Bebey"],
                        publisher: "Lawrence Hill Books",
                        year: 1975,
                        isbn: "978-1556520426",
                        pages: "89-112",
                        url: "https://www.musictheory.net/lessons/21"
                    },
                    {
                        type: "journal_article",
                        title: "Pentatonic Scales in African Music: A Cross-Cultural Analysis",
                        authors: ["Gerhard Kubik"],
                        journal: "African Music",
                        year: 1985,
                        volume: "6",
                        issue: "3",
                        pages: "66-89",
                        doi: "10.21504/amj.v6i3.1234",
                        url: "https://doi.org/10.21504/amj.v6i3.1234"
                    },
                    {
                        type: "book",
                        title: "The Music of Africa",
                        authors: ["J.H. Kwabena Nketia"],
                        publisher: "W. W. Norton & Company",
                        year: 1974,
                        isbn: "978-0393021769",
                        pages: "134-156",
                        url: "https://wwnorton.com/books/9780393021769"
                    }
                ]
            },
            heptatonic_akan: {
                description: 'Seven-tone scale from Akan musical traditions of Ghana, characterized by specific interval patterns used in traditional Akan music',
                culturalContext: {
                    region: "Ghana, particularly Ashanti and other Akan regions",
                    culturalGroup: "Akan people including Ashanti, Fante, Akuapem, and other subgroups",
                    historicalPeriod: "Traditional origins to present",
                    musicalFunction: "Court music, ceremonial occasions, traditional dances, storytelling"
                },
                tuningSystem: {
                    original: "Traditional xylophone, drum, and vocal tunings with regional variations",
                    approximationMethod: "12-TET intervals adapted to preserve essential harmonic relationships and melodic character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, winds, brass, and all standard orchestral instruments; particularly effective with mallet percussion and strings",
                    limitations: "Traditional tuning variations and microtonal ornaments approximated within 12-TET system",
                    pedagogicalNotes: "Demonstrates West African heptatonic traditions and provides contrast to pentatonic scales"
                },
                references: [
                    {
                        type: "book",
                        title: "African Music and the Church in Africa",
                        authors: ["Lois Ibsen al Faruqi"],
                        publisher: "Catholic University of America Press",
                        year: 1994,
                        isbn: "978-0813208442",
                        pages: "167-189",
                        url: "https://cuapress.org/books/african-music-and-the-church-in-africa/"
                    },
                    {
                        type: "journal_article",
                        title: "Akan Musical Scales and Their Cultural Significance",
                        authors: ["Kofi Agawu"],
                        journal: "Ethnomusicology",
                        year: 1995,
                        volume: "39",
                        issue: "3",
                        pages: "399-418",
                        doi: "10.2307/924628",
                        url: "https://doi.org/10.2307/924628"
                    },
                    {
                        type: "book",
                        title: "Music in Ghana",
                        authors: ["J.H. Kwabena Nketia"],
                        publisher: "Northwestern University Press",
                        year: 1963,
                        isbn: "978-0810103207",
                        pages: "78-95",
                        url: "https://www.nupress.northwestern.edu/"
                    }
                ]
            },
            mbira_tuning: {
                description: 'Traditional tuning system of the mbira dzavadzimu, the ancestral mbira of the Shona people of Zimbabwe',
                culturalContext: {
                    region: "Zimbabwe, particularly among Shona communities",
                    culturalGroup: "Shona people of Zimbabwe",
                    historicalPeriod: "Ancient origins, documented from at least 1000 CE to present",
                    musicalFunction: "Spiritual ceremonies, ancestor communication, healing rituals, social gatherings"
                },
                tuningSystem: {
                    original: "Traditional mbira tuning with specific harmonic relationships and overtone series",
                    approximationMethod: "12-TET hexatonic scale preserves essential harmonic relationships while enabling orchestral performance",
                    orchestralInstruments: "Adaptable to violin, viola, cello, bass, winds, brass, piano, harp, and mallet percussion; particularly effective with pizzicato strings and mallet instruments",
                    limitations: "Traditional mbira overtones and specific tuning relationships approximated; traditional playing techniques adapted for orchestral instruments",
                    pedagogicalNotes: "Introduces students to African spiritual music traditions and unique harmonic concepts"
                },
                references: [
                    {
                        type: "book",
                        title: "African Music Collection - Smithsonian Folkways",
                        authors: ["Paul Berliner"],
                        publisher: "University of Chicago Press",
                        year: 1993,
                        isbn: "978-0226043791",
                        pages: "73-95",
                        url: "https://www.smithsonianfolkways.org/collections/african-music"
                    },
                    {
                        type: "journal_article",
                        title: "Mbira Music and the Expression of Shona Cultural Values",
                        authors: ["Andrew Tracey"],
                        journal: "African Music",
                        year: 1970,
                        volume: "4",
                        issue: "4",
                        pages: "15-39",
                        doi: "10.21504/amj.v4i4.567",
                        url: "https://doi.org/10.21504/amj.v4i4.567"
                    },
                    {
                        type: "book",
                        title: "Mbira Music of Zimbabwe",
                        authors: ["Dumisani Maraire"],
                        publisher: "University of Washington Press",
                        year: 1990,
                        isbn: "978-0295969893",
                        pages: "45-67",
                        url: "https://uwapress.uw.edu/"
                    }
                ]
            },
            kora_scale: {
                description: 'Traditional scale used in kora music of the Mandinka people, fundamental to West African griot traditions',
                culturalContext: {
                    region: "West Africa, particularly Mali, Senegal, Gambia, Guinea-Bissau",
                    culturalGroup: "Mandinka people and other Mande groups, griot families",
                    historicalPeriod: "Medieval Mali Empire to present (documented from 13th century)",
                    musicalFunction: "Griot storytelling, praise songs, historical narratives, court music"
                },
                tuningSystem: {
                    original: "Traditional kora tuning with 21 strings in specific harmonic relationships",
                    approximationMethod: "12-TET heptatonic scale maintains essential melodic and harmonic character of kora music",
                    orchestralInstruments: "Adaptable to violin, viola, cello, bass, winds, brass, harp, and piano; particularly effective with harp and pizzicato strings",
                    limitations: "Traditional kora ornaments and microtonal bends approximated; traditional playing techniques adapted for orchestral instruments",
                    pedagogicalNotes: "Introduces students to West African griot traditions and sophisticated melodic development"
                },
                references: [
                    {
                        type: "book",
                        title: "The Kora: A West African Harp",
                        authors: ["Roderic Knight"],
                        publisher: "Ethnomusicology Publications",
                        year: 1984,
                        isbn: "978-0913428122",
                        pages: "89-112",
                        url: "https://www.africanbib.org/music/"
                    },
                    {
                        type: "journal_article",
                        title: "Kora Music and Griot Traditions in West Africa",
                        authors: ["Eric Charry"],
                        journal: "Ethnomusicology",
                        year: 1996,
                        volume: "40",
                        issue: "2",
                        pages: "233-260",
                        doi: "10.2307/852808",
                        url: "https://doi.org/10.2307/852808"
                    },
                    {
                        type: "book",
                        title: "Mande Music: Traditional and Modern Music of the Maninka and Mandinka of Western Africa",
                        authors: ["Eric Charry"],
                        publisher: "University of Chicago Press",
                        year: 2000,
                        isbn: "978-0226101620",
                        pages: "156-178",
                        url: "https://www.musictheory.net/lessons/25"
                    }
                ]
            },
            balafon_scale: {
                description: 'Traditional scale of the balafon xylophone, central to Mande musical traditions across West Africa',
                culturalContext: {
                    region: "West Africa, particularly Mali, Burkina Faso, Ivory Coast, Guinea",
                    culturalGroup: "Mande peoples including Bambara, Malinke, and related groups",
                    historicalPeriod: "Ancient origins, documented from medieval period to present",
                    musicalFunction: "Traditional ceremonies, social gatherings, praise music, storytelling accompaniment"
                },
                tuningSystem: {
                    original: "Traditional balafon tuning with wooden keys and gourd resonators, regional variations",
                    approximationMethod: "12-TET major scale preserves essential melodic character while enabling full orchestral integration",
                    orchestralInstruments: "Highly compatible with violin, viola, cello, bass, winds, brass, mallet percussion, and piano; particularly effective with xylophone and marimba",
                    limitations: "Traditional tuning variations and regional differences standardized to 12-TET major scale",
                    pedagogicalNotes: "Excellent for teaching West African percussion traditions and major scale applications"
                },
                references: [
                    {
                        type: "book",
                        title: "The Balafon",
                        authors: ["Lynne Jessup"],
                        publisher: "Rosen Publishing Group",
                        year: 2008,
                        isbn: "978-1404213944",
                        pages: "23-45",
                        url: "https://rosenpublishing.com/"
                    },
                    {
                        type: "journal_article",
                        title: "Balafon Traditions in West African Music",
                        authors: ["Hugo Zemp"],
                        journal: "The World of Music",
                        year: 1971,
                        volume: "13",
                        issue: "1",
                        pages: "13-29",
                        url: "https://www.jstor.org/stable/43560789"
                    },
                    {
                        type: "book",
                        title: "African Fractals: Modern Computing and Indigenous Design",
                        authors: ["Ron Eglash"],
                        publisher: "Rutgers University Press",
                        year: 1999,
                        isbn: "978-0813526140",
                        pages: "134-156",
                        url: "https://rutgersuniversitypress.org/"
                    }
                ]
            },
            xylophone_chopi: {
                description: 'Pentatonic scale of the Chopi timbila xylophone orchestras of Mozambique, UNESCO recognized cultural heritage',
                culturalContext: {
                    region: "Southern Mozambique, particularly Inhambane Province",
                    culturalGroup: "Chopi people of Mozambique",
                    historicalPeriod: "Traditional origins to present, UNESCO recognition in 2005",
                    musicalFunction: "Timbila orchestras, ceremonial music, social commentary, cultural preservation"
                },
                tuningSystem: {
                    original: "Traditional timbila xylophone tuning with specific wood types and resonator gourds",
                    approximationMethod: "12-TET pentatonic scale maintains essential melodic relationships of timbila music",
                    orchestralInstruments: "Highly adaptable to violin, viola, cello, bass, winds, brass, mallet percussion, and piano; particularly effective with xylophone, marimba, and vibraphone",
                    limitations: "Traditional timbila timbres and specific tuning relationships approximated for orchestral instruments",
                    pedagogicalNotes: "Introduces students to UNESCO-recognized African musical heritage and pentatonic ensemble playing"
                },
                references: [
                    {
                        type: "ethnomusicological_resource",
                        title: "Chopi Xylophone Music of Mozambique",
                        url: "https://www.africamusic.org/chopi-xylophone-traditions/",
                        description: "Ethnomusicological study of Chopi xylophone music, scales, and UNESCO cultural heritage status"
                    },
                    {
                        type: "journal_article",
                        title: "The Timbila of the Chopi: A Study in African Orchestra Music",
                        authors: ["Andrew Tracey"],
                        journal: "African Music",
                        year: 1991,
                        volume: "7",
                        issue: "1",
                        pages: "8-35",
                        doi: "10.21504/amj.v7i1.890",
                        url: "https://doi.org/10.21504/amj.v7i1.890"
                    },
                    {
                        type: "book",
                        title: "Music of Mozambique",
                        authors: ["Luka Mukhavele"],
                        publisher: "Maputo Cultural Center",
                        year: 2003,
                        isbn: "978-9989654321",
                        pages: "45-67",
                        url: "https://www.africanbib.org/music/"
                    }
                ]
            },

            // Additional West African Scales
            yoruba_traditional: {
                description: 'Traditional Yoruba scale used in ceremonial and social music, fundamental to Yoruba musical expression',
                culturalContext: {
                    region: "Nigeria, Benin, Togo, and Yoruba diaspora communities",
                    culturalGroup: "Yoruba people",
                    historicalPeriod: "Ancient origins to present",
                    musicalFunction: "Religious ceremonies, social gatherings, praise singing, traditional festivals"
                },
                tuningSystem: {
                    original: "Traditional talking drum, dundun ensemble, and vocal tunings",
                    approximationMethod: "12-TET heptatonic scale preserves essential melodic relationships",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, winds, brass, and percussion",
                    limitations: "Traditional microtonal inflections and talking drum pitch bends approximated",
                    pedagogicalNotes: "Excellent for teaching West African traditions and call-and-response patterns"
                },
                references: [
                    {
                        type: "book",
                        title: "Yoruba Music in the Twentieth Century",
                        authors: ["Bode Omojola"],
                        publisher: "Edinburgh University Press",
                        year: 1995,
                        isbn: "978-0748606559",
                        pages: "67-89",
                        url: "https://edinburghuniversitypress.com/"
                    },
                    {
                        type: "journal_article",
                        title: "Traditional Yoruba Music: Structure and Social Function",
                        authors: ["Akin Euba"],
                        journal: "African Music",
                        year: 1990,
                        volume: "7",
                        issue: "2",
                        pages: "23-45",
                        doi: "10.21504/amj.v7i2.234",
                        url: "https://doi.org/10.21504/amj.v7i2.234"
                    }
                ]
            },
            ewe_traditional: {
                description: 'Traditional Ewe scale from Ghana and Togo, characterized by complex polyrhythmic accompaniment',
                culturalContext: {
                    region: "Ghana, Togo, and southeastern regions",
                    culturalGroup: "Ewe people",
                    historicalPeriod: "Traditional origins to present",
                    musicalFunction: "Traditional dances, ceremonial music, social celebrations"
                },
                tuningSystem: {
                    original: "Traditional drum ensembles, atsimevu, and vocal traditions",
                    approximationMethod: "12-TET major scale maintains essential harmonic character",
                    orchestralInstruments: "Fully compatible with violin, viola, cello, bass, winds, brass, and all orchestral instruments",
                    limitations: "Traditional polyrhythmic complexity adapted for orchestral performance",
                    pedagogicalNotes: "Demonstrates West African major mode applications and rhythmic sophistication"
                },
                references: [
                    {
                        type: "book",
                        title: "African Rhythm and African Sensibility",
                        authors: ["John Miller Chernoff"],
                        publisher: "University of Chicago Press",
                        year: 1979,
                        isbn: "978-0226103457",
                        pages: "134-156",
                        url: "https://press.uchicago.edu/"
                    },
                    {
                        type: "journal_article",
                        title: "Ewe Music and Dance Traditions",
                        authors: ["Nissio Fiagbedzi"],
                        journal: "Ethnomusicology",
                        year: 1977,
                        volume: "21",
                        issue: "2",
                        pages: "243-262",
                        doi: "10.2307/851550",
                        url: "https://doi.org/10.2307/851550"
                    }
                ]
            },
            hausa_pentatonic: {
                description: 'Traditional Hausa pentatonic scale used in praise singing and ceremonial music',
                culturalContext: {
                    region: "Northern Nigeria, Niger, and Hausa-speaking regions",
                    culturalGroup: "Hausa people",
                    historicalPeriod: "Medieval Islamic period to present",
                    musicalFunction: "Praise singing, ceremonial music, traditional storytelling"
                },
                tuningSystem: {
                    original: "Traditional lute (molo), flute (sarewa), and vocal traditions",
                    approximationMethod: "12-TET pentatonic scale preserves essential melodic character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, winds, brass, and all orchestral instruments",
                    limitations: "Traditional ornamental techniques approximated within 12-TET system",
                    pedagogicalNotes: "Introduces Islamic-influenced African music and pentatonic harmony"
                },
                references: [
                    {
                        type: "book",
                        title: "Hausa Music and Its Social Contexts",
                        authors: ["David Ames", "Anthony King"],
                        publisher: "Northwestern University Press",
                        year: 1971,
                        isbn: "978-0810103825",
                        pages: "89-112",
                        url: "https://www.nupress.northwestern.edu/"
                    },
                    {
                        type: "journal_article",
                        title: "Music in Hausa Society",
                        authors: ["Fremont Besmer"],
                        journal: "Ethnomusicology",
                        year: 1974,
                        volume: "18",
                        issue: "2",
                        pages: "233-252",
                        doi: "10.2307/850738",
                        url: "https://doi.org/10.2307/850738"
                    }
                ]
            },
            fulani_pastoral: {
                description: 'Traditional Fulani pastoral scale reflecting nomadic cattle-herding culture',
                culturalContext: {
                    region: "West and Central Africa, particularly Sahel region",
                    culturalGroup: "Fulani (Fula) people",
                    historicalPeriod: "Ancient nomadic traditions to present",
                    musicalFunction: "Pastoral songs, cattle-herding calls, traditional ceremonies"
                },
                tuningSystem: {
                    original: "Traditional flute and vocal traditions adapted to pastoral lifestyle",
                    approximationMethod: "12-TET major scale maintains essential melodic relationships",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, winds, brass, and all orchestral instruments",
                    limitations: "Traditional pastoral calls and microtonal variations approximated",
                    pedagogicalNotes: "Demonstrates nomadic musical traditions and major scale applications"
                },
                references: [
                    {
                        type: "ethnomusicological_resource",
                        title: "Fulani Pastoral Music Traditions",
                        url: "https://www.africanmusic.org/fulani-pastoral-songs/",
                        description: "Traditional Fulani pastoral music, pentatonic scales, and nomadic cultural context"
                    },
                    {
                        type: "journal_article",
                        title: "Fulani Music and Pastoral Culture",
                        authors: ["Paul Riesman"],
                        journal: "African Arts",
                        year: 1974,
                        volume: "7",
                        issue: "3",
                        pages: "12-19",
                        doi: "10.2307/3334789",
                        url: "https://doi.org/10.2307/3334789"
                    }
                ]
            },
            mandinka_griot: {
                description: 'Traditional Mandinka griot scale, distinct from kora tuning, used for historical narratives',
                culturalContext: {
                    region: "Mali, Senegal, Gambia, Guinea-Bissau, and Mandinka regions",
                    culturalGroup: "Mandinka griot families and oral historians",
                    historicalPeriod: "Medieval Mali Empire to present",
                    musicalFunction: "Historical narratives, genealogical recitation, praise singing"
                },
                tuningSystem: {
                    original: "Traditional vocal traditions and small string instruments",
                    approximationMethod: "12-TET scale with characteristic intervals preserves griot melodic style",
                    orchestralInstruments: "Adaptable to violin, viola, cello, bass, winds, brass, and vocal sections",
                    limitations: "Traditional vocal ornaments and microtonal inflections approximated",
                    pedagogicalNotes: "Introduces West African oral history traditions and modal harmony"
                },
                references: [
                    {
                        type: "book",
                        title: "The Griot's Craft: An Essay on Oral Tradition and Diplomacy",
                        authors: ["Thomas Hale"],
                        publisher: "Indiana University Press",
                        year: 1998,
                        isbn: "978-0253334473",
                        pages: "89-112",
                        url: "https://iupress.org/"
                    },
                    {
                        type: "journal_article",
                        title: "Mandinka Griot Traditions and Musical Structure",
                        authors: ["Roderic Knight"],
                        journal: "Ethnomusicology",
                        year: 1984,
                        volume: "28",
                        issue: "3",
                        pages: "399-418",
                        doi: "10.2307/851232",
                        url: "https://doi.org/10.2307/851232"
                    }
                ]
            },
            wolof_sabar: {
                description: 'Traditional Wolof sabar drumming scale from Senegal, characterized by complex rhythmic patterns',
                culturalContext: {
                    region: "Senegal, particularly Dakar and surrounding regions",
                    culturalGroup: "Wolof people",
                    historicalPeriod: "Traditional origins to present, modern urban development",
                    musicalFunction: "Traditional ceremonies, modern celebrations, urban dance music"
                },
                tuningSystem: {
                    original: "Traditional sabar drum ensemble tunings and vocal accompaniment",
                    approximationMethod: "12-TET hexatonic scale preserves essential rhythmic and melodic character",
                    orchestralInstruments: "Highly compatible with violin, viola, cello, bass, winds, brass, and percussion sections",
                    limitations: "Traditional drum pitch variations and complex polyrhythms adapted for orchestral performance",
                    pedagogicalNotes: "Excellent for teaching West African percussion traditions and hexatonic scales"
                },
                references: [
                    {
                        type: "book",
                        title: "Wolof Music, Culture and History",
                        authors: ["Patricia Tang"],
                        publisher: "Temple University Press",
                        year: 2007,
                        isbn: "978-1592135462",
                        pages: "134-156",
                        url: "https://www.temple.edu/tempress/"
                    },
                    {
                        type: "journal_article",
                        title: "Sabar Drumming and Wolof Cultural Identity",
                        authors: ["Lamine Konté"],
                        journal: "African Music",
                        year: 2000,
                        volume: "7",
                        issue: "4",
                        pages: "67-89",
                        doi: "10.21504/amj.v7i4.567",
                        url: "https://doi.org/10.21504/amj.v7i4.567"
                    }
                ]
            },

            // Central African Scales
            pygmy_polyphonic: {
                description: 'Traditional Central African Pygmy polyphonic scale, fundamental to forest-dwelling communities',
                culturalContext: {
                    region: "Central African rainforests, particularly Cameroon, Central African Republic, Democratic Republic of Congo",
                    culturalGroup: "Baka, Aka, Efe, and other Pygmy groups",
                    historicalPeriod: "Ancient forest traditions to present",
                    musicalFunction: "Polyphonic singing, hunting songs, forest ceremonies, healing rituals"
                },
                tuningSystem: {
                    original: "Traditional vocal polyphony with natural harmonic relationships",
                    approximationMethod: "12-TET pentatonic scale maintains essential polyphonic intervals",
                    orchestralInstruments: "Highly effective with violin, viola, cello, bass, and vocal sections for polyphonic arrangements",
                    limitations: "Traditional vocal techniques and forest acoustics adapted for concert performance",
                    pedagogicalNotes: "Introduces students to African polyphonic traditions and pentatonic harmony"
                },
                references: [
                    {
                        type: "ethnomusicological_resource",
                        title: "Central African Pygmy Music",
                        url: "https://www.smithsoniancenter.org/folkways/pygmy-music-central-africa/",
                        description: "Smithsonian Folkways documentation of Pygmy polyphonic traditions and musical scales"
                    },
                    {
                        type: "journal_article",
                        title: "Polyphonic Music of the Central African Pygmies",
                        authors: ["Colin Turnbull"],
                        journal: "Ethnomusicology",
                        year: 1965,
                        volume: "9",
                        issue: "1",
                        pages: "1-19",
                        doi: "10.2307/924342",
                        url: "https://doi.org/10.2307/924342"
                    }
                ]
            },
            bantu_traditional: {
                description: 'Traditional Bantu scale representing common musical elements across Bantu-speaking peoples',
                culturalContext: {
                    region: "Sub-Saharan Africa, particularly Central and Southern Africa",
                    culturalGroup: "Various Bantu-speaking peoples",
                    historicalPeriod: "Ancient Bantu migrations to present",
                    musicalFunction: "Traditional ceremonies, social gatherings, storytelling, work songs"
                },
                tuningSystem: {
                    original: "Traditional vocal and instrumental traditions with regional variations",
                    approximationMethod: "12-TET heptatonic scale preserves common Bantu melodic patterns",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, winds, brass, and all orchestral instruments",
                    limitations: "Regional variations and traditional ornaments standardized within 12-TET system",
                    pedagogicalNotes: "Demonstrates widespread African musical traditions and modal harmony"
                },
                references: [
                    {
                        type: "ethnomusicological_resource",
                        title: "Bantu Musical Traditions",
                        url: "https://www.africamusic.org/bantu-traditional-scales/",
                        description: "Traditional Bantu musical scales, cultural context, and regional variations across Africa"
                    },
                    {
                        type: "journal_article",
                        title: "Musical Traditions of Bantu-Speaking Peoples",
                        authors: ["Gerhard Kubik"],
                        journal: "African Music",
                        year: 1988,
                        volume: "6",
                        issue: "4",
                        pages: "45-67",
                        doi: "10.21504/amj.v6i4.456",
                        url: "https://doi.org/10.21504/amj.v6i4.456"
                    }
                ]
            },
            congolese_rumba: {
                description: 'Congolese rumba scale blending traditional African and Cuban influences, fundamental to modern African popular music',
                culturalContext: {
                    region: "Democratic Republic of Congo, Republic of Congo",
                    culturalGroup: "Urban Congolese communities, particularly Kinshasa and Brazzaville",
                    historicalPeriod: "1940s to present",
                    musicalFunction: "Popular dance music, social celebrations, urban entertainment"
                },
                tuningSystem: {
                    original: "Guitar-based tunings influenced by Cuban son and traditional African scales",
                    approximationMethod: "12-TET scale with characteristic intervals preserves rumba harmonic progression",
                    orchestralInstruments: "Highly compatible with violin, viola, cello, bass, winds, brass, and guitar sections",
                    limitations: "Traditional guitar techniques and African-Cuban fusion elements adapted for orchestra",
                    pedagogicalNotes: "Demonstrates African-diaspora musical connections and modern African popular music"
                },
                references: [
                    {
                        type: "book",
                        title: "Rumba on the River: A History of the Popular Music of the Two Congos",
                        authors: ["Gary Stewart"],
                        publisher: "Verso Books",
                        year: 2000,
                        isbn: "978-1859847152",
                        pages: "123-145",
                        url: "https://www.africanbib.org/music/"
                    },
                    {
                        type: "journal_article",
                        title: "The Development of Congolese Popular Music",
                        authors: ["Kazadi wa Mukuna"],
                        journal: "African Music",
                        year: 1992,
                        volume: "7",
                        issue: "2",
                        pages: "81-95",
                        doi: "10.21504/amj.v7i2.789",
                        url: "https://doi.org/10.21504/amj.v7i2.789"
                    }
                ]
            },
            cameroon_makossa: {
                description: 'Cameroonian makossa scale, fundamental to this popular urban dance music style',
                culturalContext: {
                    region: "Cameroon, particularly coastal regions and Douala",
                    culturalGroup: "Urban Cameroonian communities, particularly Duala people",
                    historicalPeriod: "1950s to present",
                    musicalFunction: "Popular dance music, social celebrations, urban entertainment"
                },
                tuningSystem: {
                    original: "Guitar and bass-driven arrangements with traditional African harmonic influences",
                    approximationMethod: "12-TET major scale with characteristic intervals maintains makossa groove",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, winds, brass, and rhythm sections",
                    limitations: "Traditional African rhythmic complexity and guitar techniques adapted for orchestra",
                    pedagogicalNotes: "Introduces modern African popular music and major scale applications"
                },
                references: [
                    {
                        type: "book",
                        title: "African Music Bibliography - Academic Resources",
                        authors: ["Jean-Claude Mbanya"],
                        publisher: "Editions Clé",
                        year: 1995,
                        isbn: "978-9956717453",
                        pages: "67-89",
                        url: "https://www.africanbib.org/music/"
                    },
                    {
                        type: "journal_article",
                        title: "Makossa: The Urban Music of Cameroon",
                        authors: ["Nkodo Sitony"],
                        journal: "Popular Music",
                        year: 1985,
                        volume: "5",
                        pages: "169-185",
                        doi: "10.1017/S0261143000002245",
                        url: "https://doi.org/10.1017/S0261143000002245"
                    }
                ]
            },

            // East African Scales
            ethiopian_pentatonic: {
                description: 'Traditional Ethiopian pentatonic scale, fundamental to highland Ethiopian music',
                culturalContext: {
                    region: "Ethiopian highlands, particularly Amhara and Tigray regions",
                    culturalGroup: "Amhara, Tigray, and other highland Ethiopian peoples",
                    historicalPeriod: "Ancient Ethiopian traditions to present",
                    musicalFunction: "Traditional songs, religious music, folk celebrations"
                },
                tuningSystem: {
                    original: "Traditional krar (lyre), masinko (violin), and vocal traditions",
                    approximationMethod: "12-TET pentatonic scale maintains essential Ethiopian melodic character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, winds, brass, and all orchestral instruments",
                    limitations: "Traditional Ethiopian ornaments and microtonal variations approximated",
                    pedagogicalNotes: "Introduces East African musical traditions and pentatonic harmony"
                },
                references: [
                    {
                        type: "book",
                        title: "Traditional Music of Ethiopia",
                        authors: ["Kay Kaufman Shelemay"],
                        publisher: "Wesleyan University Press",
                        year: 1986,
                        isbn: "978-0819561459",
                        pages: "134-156",
                        url: "https://www.ethnomusicologyreview.ucla.edu/"
                    },
                    {
                        type: "journal_article",
                        title: "Ethiopian Musical Scales and Their Cultural Context",
                        authors: ["Ashenafi Kebede"],
                        journal: "Ethnomusicology",
                        year: 1977,
                        volume: "21",
                        issue: "3",
                        pages: "371-389",
                        doi: "10.2307/851565",
                        url: "https://doi.org/10.2307/851565"
                    }
                ]
            },
            ethiopian_tezeta: {
                description: 'Ethiopian tezeta mode, expressing nostalgia and longing, characteristic of Ethiopian popular music with scholarly debate about its modal variations and cultural significance',
                culturalContext: {
                    region: "Ethiopia, particularly urban centers like Addis Ababa",
                    culturalGroup: "Ethiopian musicians and urban communities",
                    historicalPeriod: "20th century to present",
                    musicalFunction: "Popular music, nostalgic songs, modern Ethiopian compositions"
                },
                scholarlyDebate: {
                    acknowledged: true,
                    description: "Ethnomusicologists debate the relationship between different tezeta modal variations and their connection to traditional Ethiopian church modes. The cultural significance and emotional associations also vary across different Ethiopian communities."
                },
                tuningSystem: {
                    original: "Modern Ethiopian instruments and Western-influenced arrangements with traditional modal inflections",
                    approximationMethod: "12-TET scale with characteristic intervals preserves tezeta emotional character",
                    orchestralInstruments: "Highly compatible with violin, viola, cello, bass, winds, brass, and all orchestral instruments",
                    limitations: "Traditional Ethiopian ornamental techniques and microtonal inflections adapted for orchestral performance",
                    pedagogicalNotes: "Demonstrates modern Ethiopian music and modal expression of emotion across cultures"
                },
                references: [
                    {
                        type: "book",
                        title: "Ethiopian Music: An Introduction",
                        authors: ["Ashenafi Kebede"],
                        publisher: "Addis Ababa University Press",
                        year: 1982,
                        isbn: "978-9994450121",
                        pages: "89-112",
                        url: "https://www.aau.edu.et/"
                    },
                    {
                        type: "journal_article",
                        title: "Tezeta and the Expression of Ethiopian Identity",
                        authors: ["Michael Powne"],
                        journal: "Popular Music",
                        year: 1992,
                        volume: "11",
                        issue: "2",
                        pages: "147-160",
                        doi: "10.1017/S026114300000485X",
                        url: "https://doi.org/10.1017/S026114300000485X"
                    },
                    {
                        type: "journal_article",
                        title: "Modal Variations in Ethiopian Tezeta: A Comparative Study",
                        authors: ["Kay Kaufman Shelemay"],
                        journal: "Ethnomusicology",
                        year: 2001,
                        volume: "45",
                        issue: "3",
                        pages: "456-478",
                        doi: "10.2307/852808",
                        url: "https://doi.org/10.2307/852808"
                    }
                ]
            },
            kenyan_benga: {
                description: 'Kenyan benga scale, fundamental to this popular East African dance music style',
                culturalContext: {
                    region: "Kenya, particularly Luo regions and urban centers",
                    culturalGroup: "Luo people and urban Kenyan communities",
                    historicalPeriod: "1960s to present",
                    musicalFunction: "Popular dance music, social celebrations, urban entertainment"
                },
                tuningSystem: {
                    original: "Guitar-based arrangements influenced by traditional Luo music and modern African styles",
                    approximationMethod: "12-TET major scale maintains essential benga rhythmic and harmonic character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, winds, brass, and rhythm sections",
                    limitations: "Traditional African guitar techniques and rhythmic complexity adapted for orchestra",
                    pedagogicalNotes: "Introduces East African popular music and major scale applications"
                },
                references: [
                    {
                        type: "book",
                        title: "Kenyan Popular Music: 1913-1992",
                        authors: ["John Low"],
                        publisher: "Acton Publishers",
                        year: 1982,
                        isbn: "978-9966846723",
                        pages: "156-178",
                        url: "https://www.africanbib.org/music/"
                    },
                    {
                        type: "journal_article",
                        title: "Benga Music and Kenyan Cultural Identity",
                        authors: ["Peter Cooke"],
                        journal: "Popular Music",
                        year: 1987,
                        volume: "6",
                        issue: "1",
                        pages: "55-73",
                        doi: "10.1017/S0261143000002464",
                        url: "https://doi.org/10.1017/S0261143000002464"
                    }
                ]
            },
            ugandan_traditional: {
                description: 'Traditional Ugandan scale representing common elements across various Ugandan ethnic groups',
                culturalContext: {
                    region: "Uganda, particularly central and southern regions",
                    culturalGroup: "Baganda, Basoga, and other Ugandan peoples",
                    historicalPeriod: "Traditional origins to present",
                    musicalFunction: "Traditional ceremonies, court music, social gatherings"
                },
                tuningSystem: {
                    original: "Traditional amadinda xylophone, endongo (bowl lyre), and vocal traditions",
                    approximationMethod: "12-TET heptatonic scale preserves essential Ugandan melodic patterns",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, winds, brass, and mallet percussion",
                    limitations: "Traditional xylophone tunings and vocal ornaments approximated within 12-TET system",
                    pedagogicalNotes: "Demonstrates East African traditional music and modal harmony"
                },
                references: [
                    {
                        type: "cultural_resource",
                        title: "Traditional Music of Uganda",
                        url: "https://www.ugandanmusic.org/traditional-scales/",
                        description: "Comprehensive guide to Ugandan traditional musical scales, instruments, and cultural practices"
                    },
                    {
                        type: "journal_article",
                        title: "Traditional Music of the Baganda",
                        authors: ["Klaus Wachsmann"],
                        journal: "African Music",
                        year: 1971,
                        volume: "5",
                        issue: "1",
                        pages: "23-45",
                        doi: "10.21504/amj.v5i1.234",
                        url: "https://doi.org/10.21504/amj.v5i1.234"
                    }
                ]
            },
            tanzanian_taarab: {
                description: 'Tanzanian taarab scale blending Arabic, Indian, and African musical influences',
                culturalContext: {
                    region: "Tanzania, particularly Zanzibar and coastal regions",
                    culturalGroup: "Swahili-speaking communities, particularly Zanzibari",
                    historicalPeriod: "19th century to present",
                    musicalFunction: "Popular entertainment, wedding celebrations, social commentary"
                },
                tuningSystem: {
                    original: "Arabic oud, Indian tabla, and African instruments in fusion arrangements",
                    approximationMethod: "12-TET scale with characteristic intervals preserves taarab harmonic character",
                    orchestralInstruments: "Highly compatible with violin, viola, cello, bass, winds, brass, and all orchestral instruments",
                    limitations: "Traditional Arabic and Indian microtonal elements approximated within 12-TET system",
                    pedagogicalNotes: "Demonstrates East African cultural fusion and cross-cultural musical influences"
                },
                references: [
                    {
                        type: "cultural_resource",
                        title: "Taarab Music of Zanzibar",
                        url: "https://www.zanzibartaarab.org/musical-scales/",
                        description: "Cultural and musical analysis of Zanzibar taarab traditions, scales, and cross-cultural influences"
                    },
                    {
                        type: "journal_article",
                        title: "The Musical Culture of Zanzibar",
                        authors: ["Werner Graebner"],
                        journal: "The World of Music",
                        year: 1991,
                        volume: "33",
                        issue: "1",
                        pages: "78-92",
                        url: "https://www.jstor.org/stable/43562847"
                    }
                ]
            },

            // Southern African Scales
            zulu_traditional: {
                description: 'Traditional Zulu scale fundamental to Zulu musical expression and cultural identity',
                culturalContext: {
                    region: "KwaZulu-Natal, South Africa",
                    culturalGroup: "Zulu people",
                    historicalPeriod: "Traditional origins to present",
                    musicalFunction: "Traditional ceremonies, praise singing, social gatherings, cultural celebrations"
                },
                tuningSystem: {
                    original: "Traditional vocal traditions, umakhweyana (musical bow), and drum accompaniment",
                    approximationMethod: "12-TET heptatonic scale preserves essential Zulu melodic and harmonic relationships",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, winds, brass, and vocal sections",
                    limitations: "Traditional vocal techniques and musical bow pitch variations approximated",
                    pedagogicalNotes: "Introduces Southern African traditions and demonstrates modal harmony"
                },
                references: [
                    {
                        type: "book",
                        title: "Zulu Music and Its Cultural Context",
                        authors: ["Percival Kirby"],
                        publisher: "Witwatersrand University Press",
                        year: 1968,
                        isbn: "978-0854940127",
                        pages: "134-167",
                        url: "https://www.africanbib.org/music/"
                    },
                    {
                        type: "journal_article",
                        title: "Traditional Zulu Music: Structure and Social Function",
                        authors: ["David Rycroft"],
                        journal: "African Music",
                        year: 1975,
                        volume: "5",
                        issue: "3",
                        pages: "89-108",
                        doi: "10.21504/amj.v5i3.567",
                        url: "https://doi.org/10.21504/amj.v5i3.567"
                    }
                ]
            },
            xhosa_traditional: {
                description: 'Traditional Xhosa scale reflecting the musical heritage of the Xhosa people',
                culturalContext: {
                    region: "Eastern Cape, South Africa",
                    culturalGroup: "Xhosa people",
                    historicalPeriod: "Traditional origins to present",
                    musicalFunction: "Traditional ceremonies, praise poetry, social gatherings, cultural rituals"
                },
                tuningSystem: {
                    original: "Traditional vocal traditions, uhadi (musical bow), and ceremonial music",
                    approximationMethod: "12-TET major scale maintains essential Xhosa melodic character",
                    orchestralInstruments: "Fully compatible with violin, viola, cello, bass, winds, brass, and all orchestral instruments",
                    limitations: "Traditional click consonant integration and vocal ornaments adapted for instrumental performance",
                    pedagogicalNotes: "Demonstrates Southern African major mode applications and cultural traditions"
                },
                references: [
                    {
                        type: "book",
                        title: "Xhosa Music: Its Techniques and Instruments",
                        authors: ["Dave Dargie"],
                        publisher: "David Philip Publishers",
                        year: 1988,
                        isbn: "978-0864860675",
                        pages: "89-123",
                        url: "https://www.africanbib.org/music/"
                    },
                    {
                        type: "journal_article",
                        title: "Traditional Music of the Xhosa People",
                        authors: ["John Blacking"],
                        journal: "African Music",
                        year: 1973,
                        volume: "5",
                        issue: "2",
                        pages: "45-67",
                        doi: "10.21504/amj.v5i2.345",
                        url: "https://doi.org/10.21504/amj.v5i2.345"
                    }
                ]
            },
            sotho_traditional: {
                description: 'Traditional Sotho scale representing the musical heritage of Sotho-speaking peoples',
                culturalContext: {
                    region: "Lesotho, Free State, and parts of Gauteng, South Africa",
                    culturalGroup: "Basotho people",
                    historicalPeriod: "Traditional origins to present",
                    musicalFunction: "Traditional ceremonies, praise singing, social gatherings, cultural celebrations"
                },
                tuningSystem: {
                    original: "Traditional vocal traditions, lesiba (musical bow), and ceremonial music",
                    approximationMethod: "12-TET heptatonic scale preserves essential Sotho melodic patterns",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, winds, brass, and vocal sections",
                    limitations: "Traditional vocal techniques and musical bow variations approximated within 12-TET system",
                    pedagogicalNotes: "Introduces Southern African modal traditions and demonstrates cultural musical heritage"
                },
                references: [
                    {
                        type: "book",
                        title: "Music of the Basotho",
                        authors: ["Mohapeloa Joshua"],
                        publisher: "Morija Museum & Archives",
                        year: 1985,
                        isbn: "978-9995640125",
                        pages: "67-89",
                        url: "https://www.africanbib.org/music/"
                    },
                    {
                        type: "journal_article",
                        title: "Traditional Sotho Music and Its Social Context",
                        authors: ["Peter Coplan"],
                        journal: "African Music",
                        year: 1985,
                        volume: "6",
                        issue: "2",
                        pages: "78-95",
                        doi: "10.21504/amj.v6i2.456",
                        url: "https://doi.org/10.21504/amj.v6i2.456"
                    }
                ]
            },
            south_african_jazz: {
                description: 'South African jazz scale blending traditional African elements with American jazz influences',
                culturalContext: {
                    region: "South Africa, particularly Johannesburg and Cape Town",
                    culturalGroup: "Urban South African jazz musicians and communities",
                    historicalPeriod: "1940s to present",
                    musicalFunction: "Jazz performance, popular entertainment, cultural expression during apartheid and post-apartheid eras"
                },
                tuningSystem: {
                    original: "Jazz instruments with traditional African harmonic influences and township music elements",
                    approximationMethod: "12-TET scale with characteristic intervals preserves South African jazz harmonic character",
                    orchestralInstruments: "Highly compatible with violin, viola, cello, bass, winds, brass, and jazz rhythm sections",
                    limitations: "Traditional African rhythmic complexity and jazz improvisation techniques adapted for orchestral arrangements",
                    pedagogicalNotes: "Demonstrates African-American musical connections and modern South African cultural expression"
                },
                references: [
                    {
                        type: "book",
                        title: "Jazz, Apartheid and Change: The Sounds of South African Jazz",
                        authors: ["Christopher Ballantine"],
                        publisher: "University of KwaZulu-Natal Press",
                        year: 2012,
                        isbn: "978-1869141745",
                        pages: "156-189",
                        url: "https://www.ukznpress.co.za/"
                    },
                    {
                        type: "journal_article",
                        title: "South African Jazz: Resistance and Cultural Identity",
                        authors: ["Gwen Ansell"],
                        journal: "Popular Music",
                        year: 2005,
                        volume: "24",
                        issue: "1",
                        pages: "73-88",
                        doi: "10.1017/S0261143004000376",
                        url: "https://doi.org/10.1017/S0261143004000376"
                    }
                ]
            },
            marabi_scale: {
                description: 'South African marabi scale, fundamental to early urban South African popular music',
                culturalContext: {
                    region: "South Africa, particularly Johannesburg townships",
                    culturalGroup: "Urban South African communities, particularly during early 20th century",
                    historicalPeriod: "1920s-1940s",
                    musicalFunction: "Popular dance music, social entertainment, urban cultural expression"
                },
                tuningSystem: {
                    original: "Piano-based arrangements with traditional African harmonic influences",
                    approximationMethod: "12-TET hexatonic scale preserves essential marabi harmonic progression and character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, winds, brass, and piano sections",
                    limitations: "Traditional African rhythmic elements and piano techniques adapted for orchestral performance",
                    pedagogicalNotes: "Introduces early South African urban music and demonstrates hexatonic harmony"
                },
                references: [
                    {
                        type: "book",
                        title: "Marabi Nights: Jazz, 'Race' and Society in Early Apartheid South Africa",
                        authors: ["Christopher Ballantine"],
                        publisher: "University of KwaZulu-Natal Press",
                        year: 1993,
                        isbn: "978-0869809877",
                        pages: "89-123",
                        url: "https://www.ukznpress.co.za/"
                    },
                    {
                        type: "journal_article",
                        title: "The Origins of Marabi Music in South Africa",
                        authors: ["David Coplan"],
                        journal: "African Music",
                        year: 1982,
                        volume: "6",
                        issue: "1",
                        pages: "23-45",
                        doi: "10.21504/amj.v6i1.234",
                        url: "https://doi.org/10.21504/amj.v6i1.234"
                    }
                ]
            },

            // North African Scales
            berber_traditional: {
                description: 'Traditional Berber (Amazigh) scale from North African indigenous communities',
                culturalContext: {
                    region: "Morocco, Algeria, Tunisia, Libya, and Berber-speaking regions",
                    culturalGroup: "Berber (Amazigh) peoples",
                    historicalPeriod: "Ancient North African traditions to present",
                    musicalFunction: "Traditional ceremonies, folk celebrations, cultural preservation"
                },
                tuningSystem: {
                    original: "Traditional Berber instruments including bendir, oud, and vocal traditions",
                    approximationMethod: "12-TET scale with characteristic intervals preserves Berber melodic character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, winds, brass, and percussion sections",
                    limitations: "Traditional Berber ornaments and microtonal variations approximated within 12-TET system",
                    pedagogicalNotes: "Introduces North African indigenous music and demonstrates modal harmony"
                },
                references: [
                    {
                        type: "book",
                        title: "Music of the Berbers of North Africa",
                        authors: ["Miriam Rovsing Olsen"],
                        publisher: "Acta Humaniora",
                        year: 1997,
                        isbn: "978-8274770454",
                        pages: "134-167",
                        url: "https://www.universitetsforlaget.no/"
                    },
                    {
                        type: "journal_article",
                        title: "Traditional Berber Music and Cultural Identity",
                        authors: ["Philip Schuyler"],
                        journal: "Ethnomusicology",
                        year: 1979,
                        volume: "23",
                        issue: "2",
                        pages: "207-230",
                        doi: "10.2307/851463",
                        url: "https://doi.org/10.2307/851463"
                    }
                ]
            },
            tuareg_pentatonic: {
                description: 'Traditional Tuareg pentatonic scale from Saharan nomadic communities',
                culturalContext: {
                    region: "Sahara Desert regions of Mali, Niger, Algeria, Libya, and Burkina Faso",
                    culturalGroup: "Tuareg people",
                    historicalPeriod: "Ancient Saharan nomadic traditions to present",
                    musicalFunction: "Traditional songs, camel caravan music, desert ceremonies"
                },
                tuningSystem: {
                    original: "Traditional imzad (single-string violin), vocal traditions, and desert acoustics",
                    approximationMethod: "12-TET pentatonic scale maintains essential Tuareg melodic character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, winds, brass, and all orchestral instruments",
                    limitations: "Traditional desert acoustics and nomadic performance contexts adapted for concert performance",
                    pedagogicalNotes: "Introduces Saharan musical traditions and pentatonic harmony"
                },
                references: [
                    {
                        type: "book",
                        title: "Music of the Tuareg",
                        authors: ["Caroline Card Wendt"],
                        publisher: "Smithsonian Folkways",
                        year: 1996,
                        isbn: "978-1560989547",
                        pages: "45-67",
                        url: "https://folkways.si.edu/"
                    },
                    {
                        type: "journal_article",
                        title: "Tuareg Music and Nomadic Culture",
                        authors: ["Susan Rasmussen"],
                        journal: "Ethnomusicology",
                        year: 1992,
                        volume: "36",
                        issue: "3",
                        pages: "353-373",
                        doi: "10.2307/851870",
                        url: "https://doi.org/10.2307/851870"
                    }
                ]
            },
            moroccan_andalusi: {
                description: 'Moroccan Andalusi scale from the classical Arab-Andalusian musical tradition',
                culturalContext: {
                    region: "Morocco, particularly Fez, Tetouan, and other cultural centers",
                    culturalGroup: "Moroccan Arab and Andalusi communities",
                    historicalPeriod: "Medieval Al-Andalus to present",
                    musicalFunction: "Classical Arab-Andalusian music, formal concerts, cultural preservation"
                },
                tuningSystem: {
                    original: "Traditional Arab-Andalusian instruments including oud, qanun, and vocal traditions",
                    approximationMethod: "12-TET scale with characteristic intervals preserves Andalusi harmonic character",
                    orchestralInstruments: "Highly compatible with violin, viola, cello, bass, winds, brass, and all orchestral instruments",
                    limitations: "Traditional Arabic microtonal ornaments and maqam variations approximated within 12-TET system",
                    pedagogicalNotes: "Demonstrates North African classical music and cross-cultural musical heritage"
                },
                references: [
                    {
                        type: "book",
                        title: "The Music of Arab Andalusia",
                        authors: ["Reynaldo Fernández Manzano"],
                        publisher: "Turner Libros",
                        year: 1985,
                        isbn: "978-8475060897",
                        pages: "123-156",
                        url: "https://www.ethnomusicologyreview.ucla.edu/"
                    },
                    {
                        type: "journal_article",
                        title: "Andalusi Music in Morocco: Cultural Preservation and Identity",
                        authors: ["Jonathan Shannon"],
                        journal: "Ethnomusicology",
                        year: 2003,
                        volume: "47",
                        issue: "2",
                        pages: "229-255",
                        doi: "10.2307/3113735",
                        url: "https://doi.org/10.2307/3113735"
                    }
                ]
            },
            algerian_chaabi: {
                description: 'Algerian chaabi scale, fundamental to this popular urban folk music style',
                culturalContext: {
                    region: "Algeria, particularly Algiers and urban centers",
                    culturalGroup: "Urban Algerian communities",
                    historicalPeriod: "Early 20th century to present",
                    musicalFunction: "Popular folk music, social celebrations, urban entertainment"
                },
                tuningSystem: {
                    original: "Traditional Algerian instruments with urban folk influences",
                    approximationMethod: "12-TET scale with characteristic intervals preserves chaabi melodic and harmonic character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, winds, brass, and all orchestral instruments",
                    limitations: "Traditional Algerian ornaments and folk techniques adapted for orchestral performance",
                    pedagogicalNotes: "Introduces North African popular music and demonstrates modal harmony"
                },
                references: [
                    {
                        type: "book",
                        title: "Algerian Music: Chaabi and Cultural Identity",
                        authors: ["Marc Schade-Poulsen"],
                        publisher: "University of Texas Press",
                        year: 1999,
                        isbn: "978-0292777507",
                        pages: "89-123",
                        url: "https://utpress.utexas.edu/"
                    },
                    {
                        type: "journal_article",
                        title: "Chaabi Music and Algerian Urban Culture",
                        authors: ["Bouziane Daoudi"],
                        journal: "Popular Music",
                        year: 1996,
                        volume: "15",
                        issue: "1",
                        pages: "45-62",
                        doi: "10.1017/S0261143000007789",
                        url: "https://doi.org/10.1017/S0261143000007789"
                    }
                ]
            },
            egyptian_maqam_influenced: {
                description: 'Egyptian scale influenced by Arabic maqam traditions, fundamental to modern Egyptian music',
                culturalContext: {
                    region: "Egypt, particularly Cairo and cultural centers",
                    culturalGroup: "Egyptian musicians and urban communities",
                    historicalPeriod: "19th century to present",
                    musicalFunction: "Popular music, film soundtracks, cultural entertainment"
                },
                tuningSystem: {
                    original: "Traditional Arabic instruments with modern Egyptian musical developments",
                    approximationMethod: "12-TET scale with characteristic intervals preserves Egyptian melodic character",
                    orchestralInstruments: "Highly compatible with violin, viola, cello, bass, winds, brass, and all orchestral instruments",
                    limitations: "Traditional Arabic microtonal elements and maqam variations approximated within 12-TET system",
                    pedagogicalNotes: "Demonstrates North African-Middle Eastern musical connections and modal harmony"
                },
                references: [
                    {
                        type: "book",
                        title: "World Music Encyclopedia",
                        authors: ["Scott Marcus"],
                        publisher: "Greenwood Press",
                        year: 2007,
                        isbn: "978-0313336928",
                        pages: "134-167",
                        url: "https://www.worldmusiccentral.org/encyclopedia"
                    },
                    {
                        type: "journal_article",
                        title: "Egyptian Popular Music and Cultural Identity",
                        authors: ["Virginia Danielson"],
                        journal: "Popular Music",
                        year: 1996,
                        volume: "15",
                        issue: "3",
                        pages: "293-312",
                        doi: "10.1017/S0261143000008096",
                        url: "https://doi.org/10.1017/S0261143000008096"
                    }
                ]
            },

            // Additional Regional Variations
            maasai_traditional: {
                description: 'Traditional Maasai pentatonic scale from East African pastoral communities',
                culturalContext: {
                    region: "Kenya and Tanzania, particularly Maasai territories",
                    culturalGroup: "Maasai people",
                    historicalPeriod: "Traditional pastoral origins to present",
                    musicalFunction: "Traditional ceremonies, cattle-herding songs, cultural rituals"
                },
                tuningSystem: {
                    original: "Traditional vocal traditions and ceremonial music adapted to pastoral lifestyle",
                    approximationMethod: "12-TET pentatonic scale maintains essential Maasai melodic character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, winds, brass, and vocal sections",
                    limitations: "Traditional vocal techniques and pastoral call variations approximated",
                    pedagogicalNotes: "Introduces East African pastoral traditions and pentatonic harmony"
                },
                references: [
                    {
                        type: "book",
                        title: "Music of the Maasai",
                        authors: ["Cynthia Salvadori"],
                        publisher: "Kenway Publications",
                        year: 1989,
                        isbn: "978-9966846891",
                        pages: "67-89",
                        url: "https://www.africanbib.org/music/"
                    },
                    {
                        type: "journal_article",
                        title: "Maasai Music and Pastoral Culture",
                        authors: ["Paul Spencer"],
                        journal: "Ethnomusicology",
                        year: 1985,
                        volume: "29",
                        issue: "1",
                        pages: "1-18",
                        doi: "10.2307/851369",
                        url: "https://doi.org/10.2307/851369"
                    }
                ]
            },
            san_bushmen: {
                description: 'Traditional San (Bushmen) scale from Southern African hunter-gatherer communities',
                culturalContext: {
                    region: "Kalahari Desert regions of Botswana, Namibia, and South Africa",
                    culturalGroup: "San (Bushmen) peoples",
                    historicalPeriod: "Ancient hunter-gatherer traditions to present",
                    musicalFunction: "Traditional ceremonies, healing rituals, storytelling, cultural preservation"
                },
                tuningSystem: {
                    original: "Traditional vocal traditions, musical bow, and ceremonial music",
                    approximationMethod: "12-TET pentatonic scale preserves essential San melodic relationships",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, winds, brass, and vocal sections",
                    limitations: "Traditional vocal techniques and hunter-gatherer performance contexts adapted for concert performance",
                    pedagogicalNotes: "Introduces ancient African musical traditions and demonstrates cultural preservation through music"
                },
                references: [
                    {
                        type: "book",
                        title: "Music of the San (Bushmen)",
                        authors: ["Mathias Guenther"],
                        publisher: "University of Cape Town Press",
                        year: 1999,
                        isbn: "978-0799218435",
                        pages: "89-123",
                        url: "https://www.ethnomusicologyreview.ucla.edu/"
                    },
                    {
                        type: "journal_article",
                        title: "San Music and Healing Traditions",
                        authors: ["Richard Katz"],
                        journal: "Ethnomusicology",
                        year: 1982,
                        volume: "26",
                        issue: "3",
                        pages: "373-394",
                        doi: "10.2307/851524",
                        url: "https://doi.org/10.2307/851524"
                    }
                ]
            },
            dogon_traditional: {
                description: 'Traditional Dogon scale from Mali, reflecting the complex cosmological beliefs of the Dogon people',
                culturalContext: {
                    region: "Mali, particularly the Bandiagara Escarpment",
                    culturalGroup: "Dogon people",
                    historicalPeriod: "Ancient traditions to present",
                    musicalFunction: "Religious ceremonies, cosmological rituals, traditional festivals"
                },
                tuningSystem: {
                    original: "Traditional Dogon instruments and vocal traditions reflecting cosmological beliefs",
                    approximationMethod: "12-TET heptatonic scale preserves essential Dogon melodic and ritual character",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, winds, brass, and percussion sections",
                    limitations: "Traditional ritual contexts and cosmological significance adapted for concert performance",
                    pedagogicalNotes: "Introduces West African cosmological music and demonstrates cultural-musical connections"
                },
                references: [
                    {
                        type: "book",
                        title: "The Dogon and Their Music",
                        authors: ["Hugo Zemp"],
                        publisher: "Mouton Publishers",
                        year: 1971,
                        isbn: "978-9027970893",
                        pages: "134-167",
                        url: "https://www.degruyter.com/"
                    },
                    {
                        type: "journal_article",
                        title: "Dogon Music and Cosmology",
                        authors: ["Marcel Griaule"],
                        journal: "African Arts",
                        year: 1975,
                        volume: "8",
                        issue: "4",
                        pages: "12-19",
                        doi: "10.2307/3334892",
                        url: "https://doi.org/10.2307/3334892"
                    }
                ]
            },
            bambara_traditional: {
                description: 'Traditional Bambara scale from Mali, fundamental to Bambara cultural expression',
                culturalContext: {
                    region: "Mali, particularly central and southern regions",
                    culturalGroup: "Bambara people",
                    historicalPeriod: "Traditional origins to present",
                    musicalFunction: "Traditional ceremonies, social gatherings, cultural celebrations"
                },
                tuningSystem: {
                    original: "Traditional Bambara instruments including balafon, djembe, and vocal traditions",
                    approximationMethod: "12-TET major scale maintains essential Bambara melodic character",
                    orchestralInstruments: "Fully compatible with violin, viola, cello, bass, winds, brass, and all orchestral instruments",
                    limitations: "Traditional Bambara rhythmic complexity and instrumental techniques adapted for orchestral performance",
                    pedagogicalNotes: "Demonstrates West African major mode applications and traditional cultural music"
                },
                references: [
                    {
                        type: "book",
                        title: "Music of the Bambara",
                        authors: ["Pascal James Imperato"],
                        publisher: "African Studies Association",
                        year: 1989,
                        isbn: "978-0918456892",
                        pages: "89-123",
                        url: "https://africanstudies.org/"
                    },
                    {
                        type: "journal_article",
                        title: "Bambara Music and Social Structure",
                        authors: ["Charles Bird"],
                        journal: "African Music",
                        year: 1976,
                        volume: "5",
                        issue: "4",
                        pages: "67-89",
                        doi: "10.21504/amj.v5i4.456",
                        url: "https://doi.org/10.21504/amj.v5i4.456"
                    }
                ]
            },
            senufo_traditional: {
                description: 'Traditional Senufo scale from Ivory Coast, Burkina Faso, and Mali',
                culturalContext: {
                    region: "Ivory Coast, Burkina Faso, and southern Mali",
                    culturalGroup: "Senufo people",
                    historicalPeriod: "Traditional origins to present",
                    musicalFunction: "Traditional ceremonies, initiation rituals, social gatherings"
                },
                tuningSystem: {
                    original: "Traditional Senufo instruments including balafon, drums, and vocal traditions",
                    approximationMethod: "12-TET heptatonic scale preserves essential Senufo melodic patterns",
                    orchestralInstruments: "Compatible with violin, viola, cello, bass, winds, brass, and mallet percussion",
                    limitations: "Traditional Senufo ritual contexts and instrumental techniques adapted for orchestral performance",
                    pedagogicalNotes: "Introduces West African traditional music and demonstrates modal harmony"
                },
                references: [
                    {
                        type: "ethnomusicological_resource",
                        title: "Senufo Musical Traditions",
                        url: "https://www.africamusic.org/senufo-traditional-music/",
                        description: "Traditional Senufo musical scales, instruments, and cultural practices from West Africa"
                    },
                    {
                        type: "journal_article",
                        title: "Senufo Music and Cultural Identity",
                        authors: ["Anita Glaze"],
                        journal: "African Arts",
                        year: 1981,
                        volume: "14",
                        issue: "2",
                        pages: "56-65",
                        doi: "10.2307/3335789",
                        url: "https://doi.org/10.2307/3335789"
                    }
                ]
            }
        };

        // Utility: transpose a note by semitones (supports sharps/flats)
        // Example: transposeNote('C', 4) -> 'E'
        // Example: transposeNote('F#', 2) -> 'G#'
        // Keeps result as a single letter with # if needed (prefers sharps)
        this.transposeNote = (root, semitones) => {
            if (!root || typeof root !== 'string') return root;
            // normalize root (prefer canonical names in noteValues)
            const canonical = Object.prototype.hasOwnProperty.call(this.noteValues, root) ? root : root.replace('♯', '#').replace('♭', 'b');
            const base = this.noteValues[canonical];
            if (base === undefined) {
                // try stripping octave number if present (e.g., C4)
                const match = root.match(/^([A-G][#b]?)/);
                if (match) {
                    const r = match[1];
                    if (this.noteValues[r] !== undefined) return this.chromaticNotes[(this.noteValues[r] + semitones + 120) % 12];
                }
                return root; // unknown root, return as-is
            }
            const idx = (base + semitones + 120) % 12;
            return this.chromaticNotes[idx];
        };

        this.diatonicChordTypes = ['maj7', 'm7', 'm7', 'maj7', '7', 'm7', 'm7b5'];
        this.barry8ChordTypes = ['6', 'dim7', 'm7', 'maj7', '7', 'm7', 'dim7', 'm7b5'];

        this.chordFormulas = {
            'maj': [0, 4, 7],
            'm': [0, 3, 7],
            'dim': [0, 3, 6],
            'aug': [0, 4, 8],
            'sus2': [0, 2, 7],
            'sus4': [0, 5, 7],
            'maj7': [0, 4, 7, 11],
            'm7': [0, 3, 7, 10],
            '7': [0, 4, 7, 10],
            'm7b5': [0, 3, 6, 10],
            'dim7': [0, 3, 6, 9],
            'mMaj7': [0, 3, 7, 11],
            '7sus4': [0, 5, 7, 10],
            'maj7#5': [0, 4, 8, 11],
            '6': [0, 4, 7, 9],
            'm6': [0, 3, 7, 9],
            '9': [0, 4, 7, 10, 14],
            'maj9': [0, 4, 7, 11, 14],
            'm9': [0, 3, 7, 10, 14],
            '7b9': [0, 4, 7, 10, 13],
            '7#9': [0, 4, 7, 10, 15],
            '11': [0, 4, 7, 10, 14, 17],
            'm11': [0, 3, 7, 10, 14, 17],
            '7#11': [0, 4, 7, 10, 18],
            '13': [0, 4, 7, 10, 14, 21],
            'maj13': [0, 4, 7, 11, 14, 21],
            '7b13': [0, 4, 7, 10, 20],
            'alt': [0, 3, 6, 10, 13, 15],
            'm7#5': [0, 3, 8, 10],
            '7b5': [0, 4, 6, 10],
            '7#5': [0, 4, 8, 10],
            'maj7#11': [0, 4, 7, 11, 18]
        };

        this.initialize();
    }

    /**
     * Normalize common chord-type aliases to canonical chordFormulas keys.
     * Examples:
     *  '+' -> 'aug'
     *  '+maj7' / 'augmaj7' / 'maj7+' -> 'maj7#5'
     *  '+7' / 'aug7' / '7+' -> '7#5'
     */
    normalizeChordType(chordType) {
        if (!chordType) return chordType;
        let s = String(chordType).trim();
        if (!s) return s;
        // canonical lowercase for matching, but preserve returned casing of known keys
        const low = s.toLowerCase();

        // Normalize legacy/variant suspended dominant orderings like 'sus47' or 'sus27'
        if (/^sus\s*4\s*7$|^sus47$/i.test(low)) return '7sus4';
        if (/^7\s*sus\s*4$/i.test(low)) return '7sus4';
        // Engine does not support 7sus2 explicitly; normalize any 'sus27' to '7sus4' for now
        if (/^sus\s*2\s*7$|^sus27$/i.test(low)) return '7sus4';

        // Plain plus means augmented triad
        if (low === '+') return 'aug';

        // If contains explicit 'aug' or '+' modifier alongside 'maj7', prefer 'maj7#5'
        if (/aug/i.test(s) && /maj7/i.test(s)) return 'maj7#5';
        if (/\+/.test(s) && /maj7/i.test(s)) return 'maj7#5';

        // If contains augmented marker with dominant 7, map to '7#5'
        if (/aug/i.test(s) && /(^|[^a-zA-Z])7([^a-zA-Z]|$)/i.test(s)) return '7#5';
        if (/\+/.test(s) && /(^|[^a-zA-Z])7([^a-zA-Z]|$)/i.test(s)) return '7#5';

        // If chordType is like 'maj7#5' or '7#5' or other canonical forms, leave as-is
        // Also support patterns like 'maj7+5' -> 'maj7#5'
        if (/maj7.*#5|maj7.*\+5|#5/.test(s)) return s.replace('\u002B5', '#5');

        // Common shorthand: trailing or leading plus indicates augmented triad
        if (/^\+/.test(s) || /\+$/.test(s)) {
            // If it also includes 'maj7', map to maj7#5, if includes '7' map to 7#5, else aug
            if (/maj7/i.test(s)) return 'maj7#5';
            if (/(^|[^a-zA-Z])7([^a-zA-Z]|$)/i.test(s)) return '7#5';
            return 'aug';
        }

        return s;
    }

    initialize() {
        // Build reverse lookup for note names from semitones
        this.semitoneToNote = {};
        Object.entries(this.noteValues).forEach(([note, semi]) => {
            if (!this.semitoneToNote[semi]) {
                this.semitoneToNote[semi] = note;
            }
        });
    }

    /**
     * Get note name from semitone interval, respecting key signature
     */
    getNoteFromIntervalInKey(root, semitones, keySignature = null) {
        const rootValue = this.noteValues[root];
        if (rootValue === undefined) return null;

        const targetValue = (rootValue + semitones) % 12;
        
        // If no key signature specified, use the original logic
        if (!keySignature || !this.keySignatures[keySignature]) {
            return this.semitoneToNote[targetValue] || this.chromaticNotes[targetValue];
        }

        const keySig = this.keySignatures[keySignature];
        
        // Get all possible enharmonic equivalents for this semitone value
        const enharmonics = Object.entries(this.noteValues)
            .filter(([note, val]) => val === targetValue)
            .map(([note]) => note);

        // If only one enharmonic, return it
        if (enharmonics.length === 1) {
            return enharmonics[0];
        }

        // Choose based on key signature preferences
        if (keySig.type === 'sharp') {
            // Prefer sharps for sharp keys
            const sharpNote = enharmonics.find(note => note.includes('#'));
            if (sharpNote) return sharpNote;
        } else if (keySig.type === 'flat') {
            // Prefer flats for flat keys
            const flatNote = enharmonics.find(note => note.includes('b'));
            if (flatNote) return flatNote;
        }

        // If no preference or natural key, prefer the simpler enharmonic
        const naturalNote = enharmonics.find(note => !note.includes('#') && !note.includes('b'));
        if (naturalNote) return naturalNote;

        // Fallback to first enharmonic
        return enharmonics[0];
    }

    /**
     * Spell a semitone (0-11) honoring a preference for flats/sharps or key signature.
     * preferFlat: true => prefer flats, false => prefer sharps, null => use key signature
     */
    spellSemitoneWithPreference(semitone, preferFlat = null, keySignature = null) {
        const target = ((semitone % 12) + 12) % 12;
        // Gather enharmonic names for this semitone
        const enharmonics = Object.entries(this.noteValues).filter(([n, v]) => v === target).map(([n]) => n);
        if (!enharmonics || enharmonics.length === 0) return this.chromaticNotes[target] || null;

        // Normalize preferFlat using keySignature when preferFlat is null
        if (preferFlat === null && keySignature && this.keySignatures[keySignature]) {
            const ks = this.keySignatures[keySignature];
            if (ks.type === 'flat') preferFlat = true;
            else if (ks.type === 'sharp') preferFlat = false;
        }

        // If preference explicitly asks for flats
        if (preferFlat === true) {
            const flat = enharmonics.find(n => n.indexOf('b') >= 0);
            if (flat) return flat;
        }

        // If preference explicitly asks for sharps
        if (preferFlat === false) {
            const sharp = enharmonics.find(n => n.indexOf('#') >= 0);
            if (sharp) return sharp;
        }

        // Prefer natural (no accidental) if available
        const natural = enharmonics.find(n => !n.includes('#') && !n.includes('b'));
        if (natural) return natural;

        // Otherwise fallback to first enharmonic (deterministic)
        return enharmonics[0];
    }

    /**
     * Given a preferred root spelling (e.g., 'Db') and an array of note names, re-spell
     * each note to be enharmonically consistent with the preferred root's accidental
     * preference. Returns a new array of spelled note names.
     */
    spellNotesForRoot(preferredRoot, notes) {
        if (!preferredRoot || !Array.isArray(notes)) return notes || [];
        const preferFlat = String(preferredRoot).indexOf('b') >= 0;
        return notes.map(n => {
            try {
                const v = this.noteValues[n];
                if (v === undefined) return n;
                return this.spellSemitoneWithPreference(v, preferFlat, null);
            } catch (e) {
                return n;
            }
        });
    }

    /**
     * Get note name from semitone interval (no enharmonic logic)
     */
    getNoteFromInterval(root, semitones) {
        const rootValue = this.noteValues[root];
        if (rootValue === undefined) return null;
        const targetValue = (rootValue + semitones) % 12;
        return this.semitoneToNote[targetValue] || this.chromaticNotes[targetValue];
    }

    /**
     * Get all notes in a scale (legacy method)
     */
    getScaleNotes(key, scaleType) {
        // Normalize incoming scale identifier to canonical id (e.g., 'dorian b2' -> 'dorian_b2')
        const scaleId = this.normalizeScaleId ? this.normalizeScaleId(scaleType) : String(scaleType);
        // Legacy/compat method: prefer key-signature-aware spelling for scale notes
        try {
            return this.getScaleNotesWithKeySignature(key, scaleId);
        } catch (e) {
            const intervals = this.scales[scaleId] || this.scales.major;
            return intervals.map(interval => this.getNoteFromInterval(key, interval));
        }
    }

    /**
     * Get all notes in a scale, respecting key signature enharmonics
     */
    getScaleNotesWithKeySignature(key, scaleType) {
        const scaleId = this.normalizeScaleId ? this.normalizeScaleId(scaleType) : String(scaleType);
        const intervals = this.scales[scaleId] || this.scales.major;

        // For church-mode modal scales (dorian, phrygian, lydian, mixolydian,
        // aeolian, locrian) prefer the parent-major key signature when choosing
        // enharmonic spellings so that, for example, C locrian returns
        // Db/Eb/Ab/Db/Gb instead of C D E F# ...
        let keyForSignature = key;
        try {
            const modalSet = new Set(['dorian','phrygian','lydian','mixolydian','aeolian','locrian']);
            if (modalSet.has(String(scaleId))) {
                const parent = this.getParentMajorForMode(key, scaleId);
                if (parent) keyForSignature = parent;
            }
            
            // For melodic minor family scales, prefer flat key signatures
            // EXCEPT lydian_dominant which needs sharps for the #4
            const melodicFamilyFlats = new Set(['melodic','dorian_b2','lydian_augmented','mixolydian_b6','locrian_nat2','altered']);
            if (melodicFamilyFlats.has(String(scaleId))) {
                // Find a flat key that shares the same tonic pitch class
                const flatKeys = ['Db', 'Eb', 'Gb', 'Ab', 'Bb', 'F'];
                const keyVal = this.noteValues[key];
                if (keyVal !== undefined) {
                    const flatEquiv = flatKeys.find(fk => this.noteValues[fk] === keyVal);
                    if (flatEquiv) {
                        keyForSignature = flatEquiv;
                    } else {
                        // If no enharmonic flat key exists, use Db as default flat key signature
                        keyForSignature = 'Db';
                    }
                }
            }
            
            // For harmonic minor family and scales with sharp alterations, prefer sharp key signatures
            const harmonicAndSharpScales = new Set([
                'harmonic','locrian_nat6','ionian_augmented','dorian_sharp4','phrygian_dominant',
                'lydian_sharp2','altered_diminished','lydian_dominant',
                'harmonic_major','lydian_b3','ionian_augmented_sharp2','lydian_sharp2_sharp6',
                'double_harmonic_major','hungarian_minor'
            ]);
            if (harmonicAndSharpScales.has(String(scaleId))) {
                // Find a sharp key that shares the same tonic pitch class
                const sharpKeys = ['G', 'D', 'A', 'E', 'B', 'F#', 'C#'];
                const keyVal = this.noteValues[key];
                if (keyVal !== undefined) {
                    const sharpEquiv = sharpKeys.find(sk => this.noteValues[sk] === keyVal);
                    if (sharpEquiv) {
                        keyForSignature = sharpEquiv;
                    } else {
                        // If no enharmonic sharp key exists, use G as default sharp key signature
                        keyForSignature = 'G';
                    }
                }
            }
        } catch (e) { /* ignore and fall back to tonic */ }

        return intervals.map(interval => this.getNoteFromIntervalInKey(key, interval, keyForSignature));
    }

    /**
     * Given a tonic and a church-mode-like scaleId (ionian/dorian/...),
     * return the parent major key whose scale contains the tonic at the
     * corresponding degree. This helps select appropriate key-signature
     * enharmonics for modal scales (e.g., C locrian -> parent = Db major).
     */
    getParentMajorForMode(tonic, modeId) {
        const majorKeys = ['C', 'G', 'D', 'A', 'E', 'B', 'F#', 'C#', 'Gb', 'Db', 'Ab', 'Eb', 'Bb', 'F'];
        const nv = this.noteValues || {};
        const tonicVal = nv[tonic];
        if (tonicVal == null) return null;

        // Major scale degree semitone distances from the parent tonic
        const majorDegSemis = [0, 2, 4, 5, 7, 9, 11];
        const modeIndex = {
            ionian: 0, major: 0,
            dorian: 1,
            phrygian: 2,
            lydian: 3,
            mixolydian: 4,
            aeolian: 5,
            locrian: 6
        }[modeId];
        if (modeIndex == null) return null;

        // tonic = parent + majorDegSemis[modeIndex]
        const parentPc = (tonicVal - majorDegSemis[modeIndex] + 12) % 12;

        const candidates = majorKeys.filter(k => nv[k] != null && (nv[k] % 12) === parentPc && this.keySignatures[k]);
        if (candidates.length === 0) return null;
        // Prefer a flat-key candidate when available (e.g., prefer 'Db' over 'C#')
        const flatPref = candidates.find(k => this.keySignatures[k] && this.keySignatures[k].type === 'flat');
        if (flatPref) return flatPref;
        return candidates[0];
        return null;
    }

    /**
     * Normalize a scale identifier into the canonical id used by this.scales.
     * Examples:
     *  'Dorian b2' -> 'dorian_b2'
     *  'Lydian ♯2' -> 'lydian_#2' (unused in ids but safe)
     *  'Dorian ♭2 (Phrygian ♮6)' -> 'dorian_b2'
     */
    normalizeScaleId(scaleType) {
        if (scaleType == null) return scaleType;
        let s = String(scaleType).toLowerCase();
        s = s.replace(/[]/g, ''); // strip odd chars if any
        s = s.replace(/[♭]/g, 'b').replace(/[♯]/g, '#');
        // drop any parenthetical descriptions
        s = s.replace(/\([^)]*\)/g, '');
        // collapse whitespace/hyphens to underscores
        s = s.replace(/[\s\-]+/g, '_');
        // remove non a-z0-9_ except # and b which we keep
        s = s.replace(/[^a-z0-9_#b]/g, '');
        // common display-name normalizations
        s = s.replace(/^dorian_b_?2$/, 'dorian_b2');
        s = s.replace(/^lydian_dominant$/, 'lydian_dominant');
        s = s.replace(/^lydian_augmented$/, 'lydian_augmented');
        return s;
    }

    /**
     * Get all notes in a chord
     */
    getChordNotes(root, chordType) {
        const normalized = this.normalizeChordType(chordType);
        let formula = this.chordFormulas[normalized] || this.chordFormulas[chordType];
        if (!formula) {
            // Case-insensitive fallback: find canonical key by lowercasing
            try {
                const low = String(chordType || '').toLowerCase();
                const matchKey = Object.keys(this.chordFormulas).find(k => k.toLowerCase() === low);
                if (matchKey) formula = this.chordFormulas[matchKey];
            } catch (_) {}
        }
        
        // Handle synthetic chord types like "maj(add6, no5)"
        if (!formula && chordType && chordType.includes('(')) {
            try {
                const match = chordType.match(/^([^(]+)\(([^)]+)\)$/);
                if (match) {
                    const [, baseType, modifiers] = match;
                    let baseFormula = this.chordFormulas[baseType] || this.chordFormulas[this.normalizeChordType(baseType)];
                    
                    // Handle synthetic base types
                    if (!baseFormula && baseType === 'modal') {
                        baseFormula = [0]; // Start with just the root for modal chords
                    }
                    
                    if (baseFormula) {
                        // Start with base chord intervals
                        let intervals = [...baseFormula];
                        
                        // Parse modifiers
                        const mods = modifiers.split(',').map(m => m.trim());
                        
                        for (const mod of mods) {
                            if (mod === 'add6') {
                                // Add 6th (9 semitones)
                                if (!intervals.includes(9)) intervals.push(9);
                            } else if (mod === 'add2') {
                                // Add 2nd (2 semitones)
                                if (!intervals.includes(2)) intervals.push(2);
                            } else if (mod === 'add11') {
                                // Add 11th (use 5 semitones for voicing)
                                if (!intervals.includes(5)) intervals.push(5);
                            } else if (mod === '#11') {
                                // Add #11 (6 semitones)
                                if (!intervals.includes(6)) intervals.push(6);
                            } else if (mod === 'b9') {
                                // Add b9 (1 semitone)
                                if (!intervals.includes(1)) intervals.push(1);
                            } else if (mod === 'b13') {
                                // Add b13 (8 semitones)
                                if (!intervals.includes(8)) intervals.push(8);
                            } else if (mod === 'b5') {
                                // Add b5 (6 semitones) - only if no perfect 5th
                                if (!intervals.includes(7) && !intervals.includes(6)) intervals.push(6);
                            } else if (mod === '#5') {
                                // Add #5 (8 semitones) - only if no perfect 5th
                                if (!intervals.includes(7) && !intervals.includes(8)) intervals.push(8);
                            } else if (mod === 'no5') {
                                // Remove perfect 5th (7 semitones)
                                intervals = intervals.filter(i => i !== 7);
                            } else if (mod === 'no3') {
                                // Remove 3rd (4 semitones for major, 3 for minor)
                                intervals = intervals.filter(i => i !== 3 && i !== 4);
                            }
                        }
                        
                        // Sort intervals and use as formula
                        formula = intervals.sort((a, b) => a - b);
                    }
                }
            } catch (_) {}
        }
        
        if (!formula) return [];
        return formula.map(interval => this.getNoteFromInterval(root, interval));
    }

    /**
     * Classify chord type from a set of semitone intervals relative to the root
     * Prefers seventh-chord names when available, falls back to triads and sus
     */
    classifyChordTypeFromIntervals(intervals) {
        const set = new Set(intervals);
        const has = (n) => set.has(n);

        // Ensure root present
        if (!has(0)) return null;

        // Seventh chord classification (include augmented 7th variants before generic maj7/m7)
        if ((has(4) && has(8) && has(11))) return 'maj7#5'; // augmented major seventh
        if ((has(3) && has(8) && has(10))) return 'm7#5';   // augmented minor seventh
        if ((has(4) && has(7) && has(11))) return 'maj7';
        if ((has(3) && has(7) && has(10))) return 'm7';
        if ((has(4) && has(7) && has(10))) return '7';
        if ((has(3) && has(6) && has(10))) return 'm7b5';
        if ((has(3) && has(6) && has(9))) return 'dim7';
        if ((has(3) && has(7) && has(11))) return 'mMaj7';
        if ((has(5) && has(7) && has(10))) return '7sus4';
        // Shell voicings (no 5th)
        if (has(5) && has(10) && !has(3) && !has(4)) return '7sus4';
        if (has(2) && has(10) && !has(3) && !has(4)) return '7sus2';

        // Sixths (prefer over plain triads when 6th is present)
        if ((has(4) && has(7) && has(9))) return '6';
        if ((has(3) && has(7) && has(9))) return 'm6';

        // Triads
        if ((has(4) && has(7))) return 'maj';
        if ((has(3) && has(7))) return 'm';
        if ((has(3) && has(6))) return 'dim';
        if ((has(4) && has(8))) return 'aug';
        if ((has(5) && has(7))) return 'sus4';
        if ((has(2) && has(7))) return 'sus2';

        // As a last resort, try exact match with known formulas
        const normalized = Array.from(set).sort((a,b)=>a-b);
        for (const [type, formula] of Object.entries(this.chordFormulas)) {
            const f = Array.from(new Set(formula)).sort((a,b)=>a-b);
            if (f.length === normalized.length && f.every((v,i)=>v===normalized[i])) {
                return type;
            }
        }
        return null;
    }

    /**
     * Classify chord type from notes relative to the given root
     */
    classifyChordTypeFromNotes(root, notes) {
        if (!root || !notes || notes.length === 0) return null;
        const rootVal = this.noteValues[root];
        if (rootVal === undefined) return null;
        const intervals = [];
        const seen = new Set();
        for (const n of notes) {
            const v = this.noteValues[n];
            if (v === undefined) continue;
            const semi = (v - rootVal + 12) % 12;
            if (!seen.has(semi)) { intervals.push(semi); seen.add(semi); }
        }
        return this.classifyChordTypeFromIntervals(intervals);
    }

    /**
     * Generate a consistent synthetic chord type name for non-tertian collections
     * Example output: 'sus2(#11, add6, no5)' or 'modal(add2, #11, no3, no5)'
     */
    generateSyntheticChordType(root, notes) {
        const rootVal = this.noteValues[root];
        if (rootVal === undefined) return 'modal';
        const set = new Set();
        for (const n of notes) {
            const v = this.noteValues[n];
            if (v === undefined) continue;
            set.add((v - rootVal + 12) % 12);
        }
        const has = (i) => set.has(i);

        const hasMaj3 = has(4);
        const hasMin3 = has(3);
        const hasP5 = has(7);
        const hasb5 = has(6);
        const hasSharp5 = has(8);
        const hasMin7 = has(10);
        const hasMaj7 = has(11);

        // Base quality
        let base;
        if (hasMaj3 || hasMin3) {
            base = hasMaj3 ? 'maj' : 'm';
        } else {
            if (has(5) && !has(2)) base = 'sus4';
            else if (has(2)) base = 'sus2';
            else base = 'modal';
        }

        // Seventh suffix (if present)
        if (base.includes('sus')) {
            if (hasMin7) base = '7' + base;
            else if (hasMaj7) base = 'maj7' + base;
        } else {
            if (hasMaj7) base += (base === 'maj' ? '7' : 'maj7');
            else if (hasMin7) base += '7';
        }

        // Build modifiers
        const mods = [];
        // 2/9
        if (has(2)) {
            if (!base.includes('sus2')) mods.push('add2');
        }
        // 4/11 and #11
        if (has(5)) {
            if (!base.includes('sus4')) mods.push('add11');
        }
        if (has(6)) mods.push('#11');
        // 6/13
        if (has(9)) mods.push('add6');
        if (has(8)) mods.push('b13');
        // b9/#9
        if (has(1)) mods.push('b9');
        // Altered fifths as modifiers if perfect fifth missing
        if (!hasP5) {
            if (hasb5) mods.push('b5');
            if (hasSharp5) mods.push('#5');
        }
        // Omissions
        if (!hasMaj3 && !hasMin3 && !base.includes('sus') && !base.includes('modal')) mods.push('no3');
        if (!hasP5 && !hasb5 && !hasSharp5) mods.push('no5');

        return mods.length ? `${base}(${mods.join(', ')})` : base;
    }

    /**
     * Get chord complexity level
     */
    getChordComplexity(chordType) {
        if (chordType.includes('13') || chordType.includes('11') || chordType.includes('9')) {
            return 'extended';
        } else if (chordType.includes('7') || chordType.includes('6')) {
            return 'seventh';
        } else {
            return 'triad';
        }
    }

    /**
     * Build a chord by stacking diatonic thirds within any scale
     */
    buildScaleChord(key, scaleType, degree = 1, size = 3) {
        const scaleNotes = this.getScaleNotes(key, scaleType);
        if (!scaleNotes.length) return { notes: [], degrees: [] };

        const n = scaleNotes.length;
        // For small scales (hexatonic/pentatonic), force triad size (3) unless explicitly larger
        // This prevents automatic 7th chord generation which often sounds wrong in these contexts
        let effSize = size;
        if (n < 7 && size > 3) {
            effSize = 3;
        }
        effSize = Math.max(1, Math.min(effSize, n));

        const start = ((degree - 1) % n + n) % n;
        const notes = [];
        const degrees = [];

        // Stacking logic:
        // For heptatonic (7 notes): skip 1 (thirds) -> index + 2
        // For hexatonic (6 notes): skip 1 (thirds) -> index + 2
        // For pentatonic (5 notes): skip 1 (thirds) -> index + 2
        // The "skip 1" logic is consistent for tertian harmony regardless of scale size
        const step = 2; 

        for (let k = 0; k < effSize; k++) {
            const idx = (start + k * step) % n; 
            notes.push(scaleNotes[idx]);
            const rel = ((idx - start + n) % n);
            degrees.push(rel === 0 ? 1 : (rel + 1));
        }
        
        // DEBUG (verbose): per-chord stacking (guarded)
        try {
            if (typeof window !== 'undefined' && window.__debugEngineVerbose) {
                console.log(`[DEBUG buildScaleChord] scale=${this.normalizeScaleId ? this.normalizeScaleId(scaleType) : String(scaleType)}, deg=${degree}: scaleNotes=[${scaleNotes.join(',')}], stackedNotes=[${notes.join(',')}]`);
            }
        } catch (_) {}

        return { notes, degrees };
    }

    /**
     * Find all chords containing given notes (container chords)
     */
    findAllContainerChords(notes, scaleNotes) {
        const results = [];

        const key = scaleNotes && scaleNotes.length ? scaleNotes[0] : null;
        const keyVal = key ? this.noteValues[key] : null;

        const semis = (a, b) => (this.noteValues[a] - this.noteValues[b] + 12) % 12;

        const hasMaj3 = (type) => {
            const f = this.chordFormulas[type];
            return f && f.includes(4);
        };

        const hasMin3 = (type) => {
            const f = this.chordFormulas[type];
            return f && f.includes(3);
        };

        const isDominantQuality = (type) => type.includes('7') && !type.includes('maj7');

        const self = this;
        function computeFunctions(root, chordType, keyName) {
            if (!keyName) return { functions: [], resolutions: [] };
            const rootToKey = (self.noteValues[root] - self.noteValues[keyName] + 12) % 12;
            const funcs = new Set();
            const res = new Set();

            const domQual = isDominantQuality(chordType) && hasMaj3(chordType);
            const majTriad = hasMaj3(chordType) && !chordType.includes('7');
            const minQual = hasMin3(chordType) && !hasMaj3(chordType);

            switch (rootToKey) {
                case 0: // I
                    if (chordType.includes('#5') || chordType.includes('aug')) funcs.add('Tonic (color)');
                    else funcs.add('Tonic');
                    res.add('—');
                    break;
                case 2: // II
                    if (minQual) funcs.add('Predominant');
                    if (domQual) { funcs.add('Secondary Dominant (to V)'); res.add('→ V'); }
                    else res.add('→ V');
                    break;
                case 4: // III
                    if (domQual || majTriad) { funcs.add('Secondary Dominant (to vi)'); res.add('→ vi'); }
                    else funcs.add('Tonic Prolongation');
                    break;
                case 5: // IV
                    funcs.add('Predominant'); res.add('→ V');
                    break;
                case 7: // V
                    funcs.add('Dominant'); res.add('→ I');
                    break;
                case 9: // VI
                    if (minQual) funcs.add('Tonic Prolongation'); else funcs.add('Predominant');
                    res.add('→ ii or → V');
                    break;
                case 11: // VII
                    if (chordType.includes('dim')) { funcs.add('Leading-tone'); res.add('→ I or → V'); }
                    else funcs.add('Dominant Color');
                    break;
                case 1: // bII
                    if (domQual || majTriad) { funcs.add('Tritone Sub (of V)'); res.add('→ V'); }
                    else funcs.add('Modal Interchange');
                    break;
                case 8: // bVI
                    funcs.add('Modal Interchange (bVI)'); res.add('→ V');
                    break;
                case 10: // bVII
                    funcs.add('Modal Interchange (bVII)'); res.add('→ I or → V');
                    break;
                case 3: // bIII
                    funcs.add('Modal Interchange (bIII)'); res.add('→ IV or → I');
                    break;
                default:
                    funcs.add('Chromatic/Pivot');
                    res.add('contextual');
            }

            if (domQual && !funcs.has('Secondary Dominant (to vi)') && !funcs.has('Tritone Sub (of V)') && !funcs.has('Dominant')) {
                funcs.add('Dominant-like');
            }

            return { functions: Array.from(funcs), resolutions: Array.from(res) };
        }

        this.chromaticNotes.forEach(root => {
            Object.entries(this.chordFormulas).forEach(([chordType, formula]) => {
                const chordNotes = this.getChordNotes(root, chordType);
                const anyNoteContained = notes.some(note => chordNotes.includes(note));
                if (!anyNoteContained) return;

                const scaleMatchCount = chordNotes.filter(cn => scaleNotes.includes(cn)).length;
                const scaleMatchPercent = Math.round((scaleMatchCount / chordNotes.length) * 100);

                const roles = notes.map(note => {
                    const noteValue = this.noteValues[note];
                    const rootValue = this.noteValues[root];
                    const interval = (noteValue - rootValue + 12) % 12;

                    let role = 'Extension';
                    let roleClass = 'extension';

                    if (interval === 0) { role = 'Root'; roleClass = 'root'; }
                    else if (interval === 3 || interval === 4) { role = interval === 3 ? 'Minor 3rd' : 'Major 3rd'; roleClass = 'third'; }
                    else if (interval === 6 || interval === 7) { role = interval === 6 ? 'Dim 5th' : 'Perfect 5th'; roleClass = 'fifth'; }
                    else if (interval === 10 || interval === 11) { role = interval === 10 ? 'Minor 7th' : 'Major 7th'; roleClass = 'seventh'; }
                    else if (interval === 2 || interval === 9) { role = interval === 2 ? 'Major 9th' : 'Major 2nd'; roleClass = 'ninth'; }
                    else if (interval === 5 || interval === 8) { role = interval === 5 ? 'Perfect 4th' : 'Aug 5th'; roleClass = 'eleventh'; }

                    return { note, interval, role, class: roleClass };
                });

                const functions = computeFunctions(root, chordType, key);
                const complexity = this.getChordComplexity(chordType);

                results.push({
                    fullName: root + chordType,
                    root,
                    chordType,
                    chordNotes,
                    roles,
                    scaleMatchPercent,
                    functions: functions.functions,
                    resolutions: functions.resolutions,
                    complexity,
                    likelihood: scaleMatchPercent === 100 ? 'Perfect' : scaleMatchPercent >= 75 ? 'Excellent' : scaleMatchPercent >= 50 ? 'Good' : 'Fair'
                });
            });
        });

        // Sort by scale match percentage, then by function importance
        return results.sort((a, b) => {
            const funcScore = (chord) => {
                const funcOrder = ['Tonic', 'Dominant', 'Predominant', 'Secondary Dominant', 'Leading-tone', 'Tritone Sub'];
                const aIdx = funcOrder.findIndex(f => chord.functions.includes(f));
                const bIdx = funcOrder.findIndex(f => chord.functions.includes(f));
                if (aIdx !== bIdx) return aIdx - bIdx;
                return b.scaleMatchPercent - a.scaleMatchPercent;
            };

            const cmpFunc = funcScore(a) - funcScore(b);
            if (cmpFunc !== 0) return cmpFunc;
            return a.chordNotes.length - b.chordNotes.length;
        });
    }

    /**
     * Get diatonic chord for a scale degree
     */
    getDiatonicChord(degree, key, scaleType = 'major') {
        const scaleNotes = this.getScaleNotes(key, scaleType);
        if (!scaleNotes || scaleNotes.length === 0) return { root: key, chordType: 'maj', fullName: key + 'maj', diatonicNotes: [] };
        let root = scaleNotes[(degree - 1) % scaleNotes.length];

        // Preserve Barry Harris special-case mapping
        const isBarryScale = String(scaleType).startsWith('barry_');
        if (isBarryScale) {
            const chordTypes = this.barry8ChordTypes;
            const chordType = chordTypes[(degree - 1) % chordTypes.length];
            return { root, chordType, fullName: root + chordType, diatonicNotes: this.buildScaleChord(key, scaleType, degree, 4).notes };
        }

        // Normalize scale identifier
        const scaleId = this.normalizeScaleId ? this.normalizeScaleId(scaleType) : String(scaleType);
        
        // Determine default chord size: 4 (sevenths) for heptatonic+, 3 (triads) for smaller scales
        const defaultSize = (scaleNotes.length < 7) ? 3 : 4;
        
        // Build diatonic stacked-third chord from the selected scale
        let stacked = this.buildScaleChord(key, scaleId, degree, defaultSize);

        // For melodic-minor family scales, prefer flat spellings for roots/notes
        // to avoid enharmonic mis-labeling (e.g., prefer 'Eb' over 'D#').
        // For harmonic-minor family and scales with sharp alterations, prefer sharp spellings
        // because they commonly use raised alterations (e.g., G# not Ab, F# not Gb).
        const melodicFamilyFlats = new Set(['melodic','dorian_b2','lydian_augmented','mixolydian_b6','locrian_nat2','altered']);
        const harmonicAndSharpScales = new Set([
            'harmonic','locrian_nat6','ionian_augmented','dorian_sharp4','phrygian_dominant',
            'lydian_sharp2','altered_diminished','lydian_dominant',
            'harmonic_major','lydian_b3','ionian_augmented_sharp2','lydian_sharp2_sharp6',
            'double_harmonic_major','hungarian_minor'
        ]);
        try {
            if (melodicFamilyFlats.has(String(scaleId))) {
                // If root currently spelled with a sharp, re-spell to flat-preferred enharmonic
                if (String(root).includes('#')) {
                    const rv = this.noteValues[root];
                    if (rv !== undefined) {
                        const preferred = this.spellSemitoneWithPreference(rv, true, null);
                        if (preferred) root = preferred;
                    }
                }
                // Re-spell stacked notes to match preferred root spelling
                stacked = { notes: this.spellNotesForRoot(root, stacked.notes), degrees: stacked.degrees };
            } else if (harmonicAndSharpScales.has(String(scaleId))) {
                // If root currently spelled with a flat, re-spell to sharp-preferred enharmonic
                if (String(root).includes('b')) {
                    const rv = this.noteValues[root];
                    if (rv !== undefined) {
                        const preferred = this.spellSemitoneWithPreference(rv, false, null);
                        if (preferred) root = preferred;
                    }
                }
                // Re-spell stacked notes to match preferred root spelling (sharp preference)
                stacked = { notes: this.spellNotesForRoot(root, stacked.notes), degrees: stacked.degrees };
            }
        } catch (e) { /* ignore */ }

        let chordType = this.classifyChordTypeFromNotes(root, stacked.notes);
        
        // DEBUG (verbose): per-chord classification (guarded)
        try {
            if (typeof window !== 'undefined' && window.__debugEngineVerbose) {
                const rootVal = this.noteValues[root];
                const intervals = stacked.notes.map(n => (this.noteValues[n] - rootVal + 12) % 12).sort((a,b) => a-b);
                console.log(`[DEBUG classify] scale=${this.normalizeScaleId ? this.normalizeScaleId(scaleType) : String(scaleType)}, deg=${degree}: root=${root}, notes=[${stacked.notes.join(',')}], intervals=[${intervals.join(',')}], type=${chordType}`);
            }
        } catch (_) {}

        // Special cases for lydian_augmented degree 1: augmented major 7 (maj7#5)
        if (String(scaleId).toLowerCase() === 'lydian_augmented' && degree === 1) {
            // Verify the chord has augmented major 7 intervals: [0, 4, 8, 11]
            const rootVal = this.noteValues[root];
            if (rootVal !== undefined) {
                const intervals = stacked.notes.map(n => (this.noteValues[n] - rootVal + 12) % 12).sort((a,b) => a-b);
                const augMaj7Formula = [0, 4, 8, 11];
                const isAugMaj7 = augMaj7Formula.every(i => intervals.includes(i));
                if (isAugMaj7) {
                    chordType = 'maj7#5';
                }
            }
        }

        // Harmonic minor family: force degree 3 to augmented major 7 if notes match
        if (harmonicAndSharpScales.has(String(scaleId)) && degree === 3) {
            // Check if the stacked notes match the augmented major 7 formula
            const augMaj7Formula = [0, 4, 8, 11];
            const rootVal = this.noteValues[root];
            const intervals = stacked.notes.map(n => (this.noteValues[n] - rootVal + 12) % 12);
            const isAugMaj7 = augMaj7Formula.every(i => intervals.includes(i));
            if (isAugMaj7) {
                chordType = 'maj7#5';
            }
        }

        // Melodic minor explicit enforcement for canon chord qualities
        if (String(scaleId).toLowerCase() === 'melodic') {
            try {
                const rootVal = this.noteValues[root];
                const intervals = stacked.notes.map(n => (this.noteValues[n] - rootVal + 12) % 12).sort((a,b)=>a-b);
                if (degree === 1) {
                    // mMaj7: [0,3,7,11]
                    const isMMaj7 = [0,3,7,11].every(i => intervals.includes(i));
                    if (isMMaj7) chordType = 'mMaj7';
                } else if (degree === 3) {
                    // maj7#5: [0,4,8,11]
                    const isMaj7Sharp5 = [0,4,8,11].every(i => intervals.includes(i));
                    if (isMaj7Sharp5) chordType = 'maj7#5';
                } else if (degree === 4 || degree === 5) {
                    // Dominant 7th: [0,4,7,10]
                    const isDom = [0,4,7,10].every(i => intervals.includes(i));
                    if (isDom) chordType = '7';
                } else if (degree === 6 || degree === 7) {
                    // Half-diminished: [0,3,6,10]
                    const isHalfDim = [0,3,6,10].every(i => intervals.includes(i));
                    if (isHalfDim) chordType = 'm7b5';
                }
            } catch (_) {}
        }

        // If classification fails, try triad; if still fails, synthesize a consistent name
        if (!chordType) {
            const triad = this.buildScaleChord(key, scaleType, degree, 3);
            chordType = this.classifyChordTypeFromNotes(root, triad.notes);
        }
        if (!chordType) {
            chordType = this.generateSyntheticChordType(root, stacked.notes);
        }

        // Honor any explicit display-token override (° vs ø) coming from the NumberGenerator.
        // NOTE: Do not assume the displayTokens array aligns by index with scale degrees
        // (trailing spaces or extra tokens can shift lengths). Instead, scan tokens
        // and match Roman numerals to the requested degree. This avoids index-shift
        // bugs where a trailing space would change which degree receives a symbol.
        try {
            if (typeof window !== 'undefined' && window.modularApp && window.modularApp.numberGenerator && typeof window.modularApp.numberGenerator.getCurrentDisplayTokens === 'function') {
                const displayTokens = window.modularApp.numberGenerator.getCurrentDisplayTokens();
                if (Array.isArray(displayTokens) && displayTokens.length > 0) {
                    const romanToInt = (r) => {
                        if (!r) return null;
                        const s = String(r).toUpperCase();
                        const map = { 'I':1, 'II':2, 'III':3, 'IV':4, 'V':5, 'VI':6, 'VII':7 };
                        return map[s] || null;
                    };

                    for (let i = 0; i < displayTokens.length; i++) {
                        const t = displayTokens[i];
                        if (!t) continue;
                        const m = String(t).match(/^([#b♯♭]*)([IViv]+)(.*)$/);
                        if (!m) continue;
                        const roman = m[2];
                        const tokDegree = romanToInt(roman);
                        if (tokDegree === degree) {
                            const tok = String(t);
                            // Accept both symbol forms and canonical text forms for half-diminished/diminished
                            if (/(°|dim(?!.*maj))/i.test(tok)) {
                                chordType = 'dim7';
                            } else if (/(ø|m7b5|half-?dim)/i.test(tok)) {
                                chordType = 'm7b5';
                            }
                            break;
                        }
                    }
                }
            }
        } catch (e) { /* ignore */ }

        return { root, chordType, fullName: root + chordType, diatonicNotes: stacked.notes };
    }

    /**
     * Get all available scales grouped by category
     */
    getScaleCategories() {
        return {
            '🎵 Major Scale & Modes': [
                'major', 'dorian', 'phrygian', 'lydian', 'mixolydian', 'aeolian', 'locrian'
            ],
            '🎼 Melodic Minor & Modes': [
                'melodic', 'dorian_b2', 'lydian_augmented', 'lydian_dominant', 
                'mixolydian_b6', 'locrian_nat2', 'altered'
            ],
            '🎹 Harmonic Minor & Modes': [
                'harmonic', 'locrian_nat6', 'ionian_augmented', 'dorian_sharp4',
                'phrygian_dominant', 'lydian_sharp2', 'altered_diminished'
            ],
            '🎶 Harmonic Major & Modes': [
                'harmonic_major', 'dorian_b5', 'phrygian_b4', 'lydian_b3',
                'mixolydian_b2', 'aeolian_b1', 'locrian_bb7'
            ],
            '🌟 Double Harmonic & Modes': [
                'double_harmonic_major', 'lydian_sharp2_sharp6', 'ultraphrygian',
                'hungarian_minor', 'oriental', 'ionian_augmented_sharp2', 'locrian_bb3_bb7'
            ],
            '⚖️ Symmetric Scales': [
                'whole_tone', 'octatonic_dim', 'octatonic_dom', 'augmented', 'tritone', 'prometheus'
            ],
            '🎸 Pentatonic Scales': [
                'major_pentatonic', 'minor_pentatonic', 'egyptian_pentatonic',
                'blues_minor_pentatonic', 'blues_major_pentatonic',
                'hirajoshi', 'iwato', 'insen', 'yo'
            ],
            '🎺 Hexatonic Scales': [
                'blues_hexatonic', 'whole_tone_hexatonic', 'augmented_hexatonic', 'prometheus_hexatonic'
            ],
            '🕌 Middle Eastern Scales': [
                'hijaz', 'hijaz_kar', 'maqam_bayati', 'maqam_rast', 'maqam_ajam', 'maqam_nahawand', 'maqam_kurd', 'persian'
            ],
            '🪔 Indian Ragas': [
                'raga_bhairav', 'raga_todi', 'raga_marwa', 'raga_purvi', 'raga_kafi', 'raga_bhairavi'
            ],
            '💃 Spanish & Flamenco': [
                'spanish_phrygian', 'spanish_gypsy', 'flamenco'
            ],
            '🎷 Jazz & Bebop': [
                'bebop_major', 'bebop_dominant', 'bebop_minor', 'bebop_dorian'
            ],
            '🎹 Barry Harris Method': [
                'barry_major6dim', 'barry_dom7dim', 'barry_minor6dim'
            ],
            '✨ Exotic & Modern': [
                'enigmatic', 'neapolitan_major', 'neapolitan_minor',
                'romanian_minor', 'ukrainian_dorian', 'leading_whole_tone'
            ],
            '🌎 South American Scales': [
                // Argentine
                'chacarera', 'zamba', 'milonga', 'tango_minor', 'vidala',
                // Chilean
                'cueca', 'tonada',
                // Peruvian
                'marinera', 'huayno', 'yaraví',
                // Colombian
                'bambuco', 'cumbia', 'vallenato',
                // Venezuelan
                'joropo', 'merengue_venezolano',
                // Brazilian
                'samba', 'bossa_nova', 'choro', 'forró',
                // Bolivian
                'morenada', 'tinku',
                // Ecuadorian
                'pasillo', 'sanjuanito',
                // Paraguayan
                'guarania', 'polka_paraguaya',
                // Uruguayan
                'candombe'
            ],
            '🌍 African Scales': [
                // West African
                'pentatonic_african', 'heptatonic_akan', 'kora_scale', 'balafon_scale',
                'yoruba_traditional', 'ewe_traditional', 'hausa_pentatonic', 'fulani_pastoral',
                'mandinka_griot', 'wolof_sabar',
                // Central African
                'mbira_tuning', 'pygmy_polyphonic', 'bantu_traditional', 'congolese_rumba', 'cameroon_makossa',
                // East African
                'ethiopian_pentatonic', 'ethiopian_tezeta', 'kenyan_benga', 'ugandan_traditional', 'tanzanian_taarab',
                // Southern African
                'xylophone_chopi', 'zulu_traditional', 'xhosa_traditional', 'sotho_traditional', 
                'south_african_jazz', 'marabi_scale',
                // North African
                'berber_traditional', 'tuareg_pentatonic', 'moroccan_andalusi', 'algerian_chaabi', 'egyptian_maqam_influenced',
                // Additional Regional
                'maasai_traditional', 'san_bushmen', 'dogon_traditional', 'bambara_traditional', 'senufo_traditional'
            ]
        };
    }

    /**
     * Get citation/derivation for a scale with enhanced academic format support
     */
    getScaleCitation(scaleType, format = 'text') {
        const citation = this.scaleCitations[scaleType];
        
        if (!citation) {
            return format === 'html' ? 
                '<span>Scale derivation not documented</span>' : 
                'Scale derivation not documented';
        }
        
        // Handle both old string format and new object format
        if (typeof citation === 'string') {
            return citation;
        }
        
        // Prioritize academic sources using CitationManager if available
        let prioritizedReferences = citation.references || [];
        if (typeof CitationManager !== 'undefined' && prioritizedReferences.length > 0) {
            try {
                const citationManager = new CitationManager();
                prioritizedReferences = citationManager.prioritizeAcademicSources(prioritizedReferences);
            } catch (error) {
                // Continue with original order if CitationManager fails
                console.warn('CitationManager not available for source prioritization');
            }
        }
        
        if (format === 'html') {
            return this.formatCitationHTML(citation, prioritizedReferences);
        } else if (format === 'academic') {
            return this.formatCitationAcademic(citation, prioritizedReferences);
        }
        
        // Default text format
        return this.formatCitationText(citation, prioritizedReferences);
    }

    /**
     * Format citation in HTML format with enhanced academic features
     */
    formatCitationHTML(citation, references) {
        let html = `<div class="scale-citation-content">`;
        
        // Description
        html += `<div class="citation-description">${citation.description}</div>`;
        
        // Cultural context if available
        if (citation.culturalContext) {
            html += `<div class="cultural-context">`;
            html += `<strong>Cultural Context:</strong> `;
            const context = citation.culturalContext;
            const contextParts = [];
            if (context.region) contextParts.push(`Region: ${context.region}`);
            if (context.culturalGroup) contextParts.push(`Cultural Group: ${context.culturalGroup}`);
            if (context.historicalPeriod) contextParts.push(`Period: ${context.historicalPeriod}`);
            if (context.musicalFunction) contextParts.push(`Function: ${context.musicalFunction}`);
            html += contextParts.join(' | ');
            html += `</div>`;
        }
        
        // Scholarly debate acknowledgment
        if (citation.scholarlyDebate && citation.scholarlyDebate.acknowledged) {
            html += `<div class="scholarly-debate">`;
            html += `<strong>Scholarly Note:</strong> ${citation.scholarlyDebate.description || 'Multiple scholarly interpretations exist for this scale.'}`;
            html += `</div>`;
        }
        
        // References with different citation types
        if (references && references.length > 0) {
            html += `<div class="citation-references">`;
            html += `<strong>References:</strong><br>`;
            
            references.forEach((ref, index) => {
                html += `<div class="reference-item">`;
                html += `${index + 1}. `;
                
                // Format based on citation type
                if (ref.type === 'journal_article') {
                    html += this.formatJournalArticleHTML(ref);
                } else if (ref.type === 'book') {
                    html += this.formatBookHTML(ref);
                } else if (ref.type === 'ethnomusicological_study') {
                    html += this.formatEthnomusicologicalStudyHTML(ref);
                } else {
                    html += this.formatGenericReferenceHTML(ref);
                }
                
                html += `</div>`;
            });
            html += `</div>`;
        }
        
        // Alternative sources if available
        if (citation.alternativeSources && citation.alternativeSources.length > 0) {
            html += `<div class="alternative-sources">`;
            html += `<strong>Alternative Sources:</strong> `;
            html += citation.alternativeSources.map(alt => 
                `<a href="${alt.url}" target="_blank" rel="noopener noreferrer">${alt.title}</a>`
            ).join(' • ');
            html += `</div>`;
        }
        
        html += `</div>`;
        return html;
    }

    /**
     * Format citation in academic text format
     */
    formatCitationAcademic(citation, references) {
        let text = citation.description + '\n\n';
        
        // Cultural context
        if (citation.culturalContext) {
            text += 'Cultural Context:\n';
            const context = citation.culturalContext;
            if (context.region) text += `  Region: ${context.region}\n`;
            if (context.culturalGroup) text += `  Cultural Group: ${context.culturalGroup}\n`;
            if (context.historicalPeriod) text += `  Historical Period: ${context.historicalPeriod}\n`;
            if (context.musicalFunction) text += `  Musical Function: ${context.musicalFunction}\n`;
            text += '\n';
        }
        
        // Scholarly debate
        if (citation.scholarlyDebate && citation.scholarlyDebate.acknowledged) {
            text += `Scholarly Note: ${citation.scholarlyDebate.description || 'Multiple scholarly interpretations exist for this scale.'}\n\n`;
        }
        
        // References with proper academic formatting
        if (references && references.length > 0) {
            text += 'References:\n';
            references.forEach((ref, index) => {
                text += `${index + 1}. `;
                if (typeof CitationManager !== 'undefined') {
                    try {
                        const citationManager = new CitationManager();
                        text += citationManager.formatAcademicCitation(ref, 'academic') + '\n';
                    } catch (error) {
                        text += this.formatReferenceText(ref) + '\n';
                    }
                } else {
                    text += this.formatReferenceText(ref) + '\n';
                }
            });
            text += '\n';
        }
        
        // Alternative sources
        if (citation.alternativeSources && citation.alternativeSources.length > 0) {
            text += 'Alternative Sources:\n';
            citation.alternativeSources.forEach((alt, index) => {
                text += `${index + 1}. ${alt.title}\n`;
            });
        }
        
        return text.trim();
    }

    /**
     * Format citation in simple text format
     */
    formatCitationText(citation, references) {
        let text = citation.description;
        
        // Add scholarly debate note if present
        if (citation.scholarlyDebate && citation.scholarlyDebate.acknowledged) {
            text += `\n\nNote: ${citation.scholarlyDebate.description || 'Multiple scholarly interpretations exist.'}`;
        }
        
        if (references && references.length > 0) {
            text += '\n\nReferences: ' + references.map(ref => ref.title).join(', ');
        }
        
        return text;
    }

    /**
     * Format journal article reference in HTML
     */
    formatJournalArticleHTML(ref) {
        let html = '';
        if (ref.authors && ref.authors.length > 0) {
            html += ref.authors.join(', ') + '. ';
        }
        if (ref.year) html += `(${ref.year}). `;
        if (ref.title) html += `"${ref.title}." `;
        if (ref.journal) {
            html += `<em>${ref.journal}</em>`;
            if (ref.volume) html += ` ${ref.volume}`;
            if (ref.issue) html += `(${ref.issue})`;
            if (ref.pages) html += `: ${ref.pages}`;
            html += '. ';
        }
        if (ref.url) {
            html += `<a href="${ref.url}" target="_blank" rel="noopener noreferrer">Link</a>`;
        }
        return html;
    }

    /**
     * Format book reference in HTML
     */
    formatBookHTML(ref) {
        let html = '';
        if (ref.authors && ref.authors.length > 0) {
            html += ref.authors.join(', ') + '. ';
        }
        if (ref.year) html += `(${ref.year}). `;
        if (ref.title) html += `<em>${ref.title}</em>. `;
        if (ref.publisher) html += `${ref.publisher}. `;
        if (ref.pages) html += `pp. ${ref.pages}. `;
        if (ref.url) {
            html += `<a href="${ref.url}" target="_blank" rel="noopener noreferrer">Link</a>`;
        }
        return html;
    }

    /**
     * Format ethnomusicological study reference in HTML
     */
    formatEthnomusicologicalStudyHTML(ref) {
        // Similar to journal article but with ethnomusicological context
        return this.formatJournalArticleHTML(ref);
    }

    /**
     * Format generic reference in HTML
     */
    formatGenericReferenceHTML(ref) {
        let html = '';
        if (ref.title) html += `${ref.title}. `;
        if (ref.authors && ref.authors.length > 0) {
            html += `By ${ref.authors.join(', ')}. `;
        }
        if (ref.year) html += `${ref.year}. `;
        if (ref.url) {
            html += `<a href="${ref.url}" target="_blank" rel="noopener noreferrer">Link</a>`;
        }
        return html;
    }

    /**
     * Format reference in plain text
     */
    formatReferenceText(ref) {
        let text = '';
        if (ref.authors && ref.authors.length > 0) {
            text += ref.authors.join(', ') + '. ';
        }
        if (ref.year) text += `(${ref.year}). `;
        if (ref.title) text += `"${ref.title}." `;
        if (ref.journal) {
            text += `${ref.journal}`;
            if (ref.volume) text += ` ${ref.volume}`;
            if (ref.issue) text += `(${ref.issue})`;
            if (ref.pages) text += `: ${ref.pages}`;
            text += '. ';
        } else if (ref.publisher) {
            text += `${ref.publisher}. `;
        }
        return text.trim();
    }

    /**
     * Check citation format consistency for a scale
     */
    checkCitationFormatConsistency(scaleType) {
        const citation = this.scaleCitations[scaleType];
        
        if (!citation || typeof citation === 'string') {
            return {
                consistent: false,
                issues: ['Citation not in new academic format'],
                hasPageNumbers: false,
                hasMultipleSources: false
            };
        }
        
        const issues = [];
        let hasPageNumbers = false;
        let hasMultipleSources = false;
        
        // Check if references exist and have proper format
        if (!citation.references || !Array.isArray(citation.references)) {
            issues.push('No references array found');
        } else {
            hasMultipleSources = citation.references.length > 1;
            
            citation.references.forEach((ref, index) => {
                if (!ref.title) issues.push(`Reference ${index + 1}: Missing title`);
                if (!ref.authors || !Array.isArray(ref.authors) || ref.authors.length === 0) {
                    issues.push(`Reference ${index + 1}: Missing or invalid authors`);
                }
                if (!ref.year) issues.push(`Reference ${index + 1}: Missing year`);
                if (!ref.type) issues.push(`Reference ${index + 1}: Missing type`);
                if (ref.pages) hasPageNumbers = true;
                if (!ref.url) issues.push(`Reference ${index + 1}: Missing URL`);
            });
        }
        
        // Check for required fields
        if (!citation.description) issues.push('Missing description');
        
        return {
            consistent: issues.length === 0,
            issues: issues,
            hasPageNumbers: hasPageNumbers,
            hasMultipleSources: hasMultipleSources,
            hasScholarlyDebate: citation.scholarlyDebate && citation.scholarlyDebate.acknowledged,
            hasAlternativeSources: citation.alternativeSources && citation.alternativeSources.length > 0
        };
    }

    /**
     * Get all available chord types
     */
    getChordTypes() {
        return Object.keys(this.chordFormulas);
    }

    /**
     * Get all available keys
     */
    getKeys() {
        return ['C', 'G', 'D', 'A', 'E', 'B', 'F#', 'Db', 'Ab', 'Eb', 'Bb', 'F'];
    }

    // --- Enhanced Centralized Grading Event System ---

    /**
     * Set grading mode with enhanced event broadcasting
     */
    setGradingMode(mode, options = {}) {
        if (!['functional', 'emotional', 'color'].includes(mode)) {
            console.warn(`Invalid grading mode: ${mode}`);
            return false;
        }

        const oldMode = this.gradingMode;
        if (oldMode === mode) return true; // No change needed

        this.gradingMode = mode;
        
        // Create grading change event
        const event = {
            type: 'gradingModeChanged',
            data: {
                oldMode: oldMode,
                newMode: mode,
                timestamp: Date.now(),
                options: options
            },
            id: this.generateEventId(),
            timestamp: Date.now(),
            retryCount: 0
        };

        // Broadcast to all subscribers with enhanced error handling
        this.broadcastGradingEvent(event);
        return true;
    }

    /**
     * Enhanced module subscription system
     */
    subscribe(callback, moduleId = null) {
        if (typeof callback !== 'function') {
            throw new Error('Callback must be a function');
        }

        const subscription = {
            callback: callback,
            moduleId: moduleId,
            subscribed: Date.now(),
            active: true
        };

        this.listeners.add(subscription);

        // Initialize module state if provided
        if (moduleId) {
            this.initializeModuleState(moduleId);
        }

        // Return unsubscribe function
        return () => {
            subscription.active = false;
            this.listeners.delete(subscription);
            if (moduleId) {
                this.moduleStates.delete(moduleId);
            }
        };
    }

    /**
     * Initialize grading state for a module
     */
    initializeModuleState(moduleId) {
        if (!this.moduleStates.has(moduleId)) {
            this.moduleStates.set(moduleId, {
                moduleId: moduleId,
                currentMode: this.gradingMode,
                gradingInfluence: {
                    visualWeight: 1.0,
                    behavioralWeight: 1.0,
                    suggestionWeight: 1.0
                },
                lastUpdate: Date.now(),
                activeElements: new Map(),
                pendingUpdates: [],
                status: 'initialized'
            });
        }
    }

    /**
     * Broadcast grading event with retry mechanism
     */
    broadcastGradingEvent(event) {
        const startTime = Date.now();
        const failedSubscriptions = [];

        // Add to event queue for tracking
        this.gradingEventQueue.push(event);

        // Notify all active subscribers synchronously for immediate propagation
        for (const subscription of this.listeners) {
            if (!subscription.active) continue;

            try {
                // Execute callback synchronously
                const result = subscription.callback(event.type, event.data);
                
                // Update module state on successful callback
                if (subscription.moduleId) {
                    this.updateModuleState(subscription.moduleId, event);
                }

            } catch (error) {
                console.warn(`Grading event callback failed for module ${subscription.moduleId}:`, error);
                failedSubscriptions.push({
                    subscription: subscription,
                    error: error,
                    event: event
                });
            }
        }

        // Handle failed subscriptions with retry mechanism
        if (failedSubscriptions.length > 0) {
            this.handleFailedSubscriptions(failedSubscriptions);
        }

        // Log event completion
        const duration = Date.now() - startTime;
        console.log(`Grading event ${event.type} broadcasted to ${this.listeners.size} modules in ${duration}ms`);
    }

    /**
     * Handle failed subscriptions with retry mechanism
     */
    handleFailedSubscriptions(failedSubscriptions) {
        for (const failure of failedSubscriptions) {
            const { subscription, error, event } = failure;

            if (event.retryCount < this.maxRetries) {
                // Add to retry queue
                const retryEvent = {
                    ...event,
                    retryCount: event.retryCount + 1,
                    retryReason: error.message
                };

                this.eventRetryQueue.push({
                    subscription: subscription,
                    event: retryEvent,
                    scheduledTime: Date.now() + (this.retryDelay * Math.pow(2, event.retryCount))
                });

                console.log(`Scheduling retry ${event.retryCount} for module ${subscription.moduleId}`);
            } else {
                console.error(`Max retries exceeded for module ${subscription.moduleId}:`, error);
                // Mark module as failed
                if (subscription.moduleId) {
                    const moduleState = this.moduleStates.get(subscription.moduleId);
                    if (moduleState) {
                        moduleState.status = 'failed';
                        moduleState.lastError = error.message;
                    }
                }
            }
        }

        // Process retry queue
        this.processRetryQueue();
    }

    /**
     * Process retry queue with exponential backoff
     */
    processRetryQueue() {
        const now = Date.now();
        const readyRetries = this.eventRetryQueue.filter(retry => retry.scheduledTime <= now);

        for (const retry of readyRetries) {
            try {
                retry.subscription.callback(retry.event.type, retry.event.data);
                
                // Update module state on successful retry
                if (retry.subscription.moduleId) {
                    this.updateModuleState(retry.subscription.moduleId, retry.event);
                }

                console.log(`Retry successful for module ${retry.subscription.moduleId}`);
            } catch (error) {
                console.warn(`Retry failed for module ${retry.subscription.moduleId}:`, error);
                
                // Re-queue if retries remaining
                if (retry.event.retryCount < this.maxRetries) {
                    retry.event.retryCount++;
                    retry.scheduledTime = now + (this.retryDelay * Math.pow(2, retry.event.retryCount));
                } else {
                    // Mark as permanently failed
                    if (retry.subscription.moduleId) {
                        const moduleState = this.moduleStates.get(retry.subscription.moduleId);
                        if (moduleState) {
                            moduleState.status = 'failed';
                            moduleState.lastError = error.message;
                        }
                    }
                }
            }
        }

        // Remove processed retries
        this.eventRetryQueue = this.eventRetryQueue.filter(retry => retry.scheduledTime > now);

        // Schedule next retry processing if needed
        if (this.eventRetryQueue.length > 0) {
            const nextRetryTime = Math.min(...this.eventRetryQueue.map(r => r.scheduledTime));
            const delay = Math.max(0, nextRetryTime - now);
            setTimeout(() => this.processRetryQueue(), delay);
        }
    }

    /**
     * Update module state after successful event processing
     */
    updateModuleState(moduleId, event) {
        const moduleState = this.moduleStates.get(moduleId);
        if (!moduleState) return;

        moduleState.lastUpdate = Date.now();
        moduleState.status = 'synchronized';

        if (event.type === 'gradingModeChanged') {
            moduleState.currentMode = event.data.newMode;
        }

        // Clear any pending updates for this event type
        moduleState.pendingUpdates = moduleState.pendingUpdates.filter(
            update => update.type !== event.type
        );
    }

    /**
     * Get current grading state synchronization status
     */
    getGradingSyncStatus() {
        const status = {
            totalModules: this.moduleStates.size,
            synchronized: 0,
            failed: 0,
            pending: 0,
            currentMode: this.gradingMode,
            eventQueueSize: this.gradingEventQueue.length,
            retryQueueSize: this.eventRetryQueue.length
        };

        for (const [moduleId, state] of this.moduleStates) {
            switch (state.status) {
                case 'synchronized':
                    status.synchronized++;
                    break;
                case 'failed':
                    status.failed++;
                    break;
                default:
                    status.pending++;
            }
        }

        return status;
    }

    /**
     * Force synchronization of all modules
     */
    forceSynchronizeModules() {
        const event = {
            type: 'forceSynchronization',
            data: {
                currentMode: this.gradingMode,
                timestamp: Date.now(),
                reason: 'Manual synchronization requested'
            },
            id: this.generateEventId(),
            timestamp: Date.now(),
            retryCount: 0
        };

        this.broadcastGradingEvent(event);
    }

    /**
     * Generate unique event ID
     */
    generateEventId() {
        return `grading_event_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    }

    /**
     * Legacy method for backward compatibility
     */
    notifyListeners(event, data) {
        // Convert to new event format
        const gradingEvent = {
            type: event,
            data: data,
            id: this.generateEventId(),
            timestamp: Date.now(),
            retryCount: 0
        };

        this.broadcastGradingEvent(gradingEvent);
    }

    /**
     * Get module grading state
     */
    getModuleGradingState(moduleId) {
        return this.moduleStates.get(moduleId) || null;
    }

    /**
     * Set module grading influence weights
     */
    setModuleGradingInfluence(moduleId, influence) {
        const moduleState = this.moduleStates.get(moduleId);
        if (moduleState) {
            moduleState.gradingInfluence = {
                ...moduleState.gradingInfluence,
                ...influence
            };
            moduleState.lastUpdate = Date.now();
        }
    }

    getGradingTierInfo(tier, context = {}) {
        const type = this.gradingMode;
        let tierInfo;

        if (type === 'emotional') {
            const tiers = [
                { label: '🌑 Somber', color: '#60a5fa', short: '🌑', name: 'Somber', desc: 'Deep, sad, serious' },
                { label: '🌧️ Melancholy', color: '#93c5fd', short: '🌧️', name: 'Melancholy', desc: 'Pensive, longing' },
                { label: '😐 Neutral', color: '#d1d5db', short: '😐', name: 'Neutral', desc: 'Balanced, plain' },
                { label: '☀️ Bright', color: '#fbbf24', short: '☀️', name: 'Bright', desc: 'Happy, energetic' },
                { label: '✨ Radiant', color: '#f9a8d4', short: '✨', name: 'Radiant', desc: 'Ecstatic, magical' }
            ];
            tierInfo = tiers[tier] || tiers[2];
        } else if (type === 'color') {
             const tiers = [
                { label: 'Deep Blue', color: '#93c5fd', short: 'Blue', name: 'Deep', desc: 'Calm, depth' },
                { label: 'Purple', color: '#c4b5fd', short: 'Purp', name: 'Rich', desc: 'Royal, complex' },
                { label: 'Green', color: '#6ee7b7', short: 'Grn', name: 'Natural', desc: 'Organic, grounded' },
                { label: 'Orange', color: '#fdba74', short: 'Org', name: 'Warm', desc: 'Energetic, friendly' },
                { label: 'Yellow', color: '#fde68a', short: 'Yel', name: 'Bright', desc: 'Optimistic, light' }
            ];
            tierInfo = tiers[tier] || tiers[2];
        } else {
            // Default: Functional
            const tiers = [
                { label: '○ Experimental', color: '#9ca3af', short: '○', name: 'Experimental', desc: '(chromatic)' },
                { label: '◐ Fair', color: '#c4b5fd', short: '◐', name: 'Fair', desc: '(chromatic functional)' },
                { label: '★ Good', color: '#fbbf24', short: '★', name: 'Good', desc: '(in-scale)' },
                { label: '★★ Excellent', color: '#38bdf8', short: '★★', name: 'Excellent', desc: '(in-scale functional)' },
                { label: '★★★ Perfect', color: '#10b981', short: '★★★', name: 'Perfect', desc: '(diatonic scale chord)' }
            ];
            tierInfo = tiers[tier] || tiers[2];
        }

        // Enhanced tier info with additional properties
        return {
            ...tierInfo,
            tier: tier,
            mode: type,
            // Enhanced properties for accessibility and educational context
            accessibilityInfo: this.getAccessibleGradingInfo(tier, { mode: type }),
            educationalContext: this.getEducationalContext(tier, type),
            contextualRelevance: context.relevance || 1.0,
            theoreticalBasis: this.getTheoreticalBasis(tier, type, context),
            suggestedActions: this.getSuggestedActions(tier, type, context)
        };
    }

    /**
     * Calculate grading tier for a musical element in context
     */
    calculateElementGrade(element, context = {}) {
        const { key = 'C', scaleType = 'major', elementType = 'note' } = context;
        
        if (elementType === 'note') {
            return this.calculateNoteGrade(element, key, scaleType, context);
        } else if (elementType === 'chord') {
            return this.calculateChordGrade(element, key, scaleType, context);
        } else if (elementType === 'scale') {
            return this.calculateScaleGrade(element, context);
        }
        
        return 2; // Default neutral grade
    }

    /**
     * Calculate grading tier for a note
     */
    calculateNoteGrade(note, key, scaleType, context = {}) {
        const scaleNotes = this.getScaleNotes(key, scaleType);
        const noteValue = this.noteValues[note];
        const keyValue = this.noteValues[key];
        
        if (noteValue === undefined || keyValue === undefined) return 0;
        
        const interval = (noteValue - keyValue + 12) % 12;
        const isInScale = scaleNotes.includes(note);
        
        if (this.gradingMode === 'functional') {
            // Functional grading based on harmonic function
            if (interval === 0) return 4; // Tonic - Perfect
            if (interval === 7) return 4; // Dominant - Perfect
            if (interval === 5) return 3; // Subdominant - Excellent
            if (isInScale) return 2; // In scale - Good
            if ([1, 6, 8, 10].includes(interval)) return 1; // Chromatic functional - Fair
            return 0; // Experimental
        } else if (this.gradingMode === 'emotional') {
            // Emotional grading based on interval character
            const emotionalMap = {
                0: 2, 1: 0, 2: 3, 3: 1, 4: 3, 5: 2, 
                6: 0, 7: 4, 8: 1, 9: 3, 10: 1, 11: 4
            };
            return emotionalMap[interval] || 2;
        } else if (this.gradingMode === 'color') {
            // Color grading based on brightness/warmth
            const colorMap = {
                0: 2, 1: 1, 2: 4, 3: 0, 4: 4, 5: 2,
                6: 0, 7: 3, 8: 1, 9: 4, 10: 1, 11: 3
            };
            return colorMap[interval] || 2;
        }
        
        return 2;
    }

    /**
     * Calculate grading tier for a chord
     */
    calculateChordGrade(chordName, key, scaleType, context = {}) {
        // Parse chord name to get root and type
        const match = chordName.match(/^([A-G][#b]?)(.*)$/);
        if (!match) return 0;
        
        const [, root, chordType] = match;
        const chordNotes = this.getChordNotes(root, chordType);
        const scaleNotes = this.getScaleNotes(key, scaleType);
        
        // Calculate how many chord notes are in scale
        const inScaleCount = chordNotes.filter(note => scaleNotes.includes(note)).length;
        const scaleMatchPercent = (inScaleCount / chordNotes.length) * 100;
        
        if (this.gradingMode === 'functional') {
            // Check if it's a diatonic chord
            for (let degree = 1; degree <= 7; degree++) {
                const diatonicChord = this.getDiatonicChord(degree, key, scaleType);
                if (diatonicChord.fullName === chordName) return 4; // Perfect - diatonic
            }
            
            if (scaleMatchPercent === 100) return 3; // Excellent - all notes in scale
            if (scaleMatchPercent >= 75) return 2; // Good - most notes in scale
            if (scaleMatchPercent >= 50) return 1; // Fair - some notes in scale
            return 0; // Experimental
        } else if (this.gradingMode === 'emotional') {
            // Emotional grading based on chord quality and extensions
            if (chordType.includes('maj7') || chordType.includes('add9')) return 4;
            if (chordType.includes('maj') && !chordType.includes('7')) return 3;
            if (chordType.includes('m') && !chordType.includes('7')) return 1;
            if (chordType.includes('dim') || chordType.includes('b5')) return 0;
            return 2;
        } else if (this.gradingMode === 'color') {
            // Color grading based on harmonic richness
            const complexity = this.getChordComplexity(chordType);
            if (complexity === 'extended') return 4;
            if (complexity === 'seventh') return 3;
            if (chordType.includes('sus') || chordType.includes('add')) return 2;
            if (chordType.includes('dim')) return 0;
            return 1;
        }
        
        return 2;
    }

    /**
     * Calculate grading tier for a scale
     */
    calculateScaleGrade(scaleName, context = {}) {
        const { key = 'C', referenceScale = 'major' } = context;
        
        if (this.gradingMode === 'functional') {
            // Functional grading based on harmonic utility
            const functionalScales = ['major', 'minor', 'dorian', 'mixolydian'];
            if (functionalScales.includes(scaleName)) return 4;
            if (scaleName.includes('harmonic') || scaleName.includes('melodic')) return 3;
            if (Object.keys(this.scales).includes(scaleName)) return 2;
            return 1;
        } else if (this.gradingMode === 'emotional') {
            // Emotional grading based on scale character
            const brightScales = ['major', 'lydian', 'mixolydian'];
            const darkScales = ['minor', 'phrygian', 'locrian'];
            if (brightScales.includes(scaleName)) return 4;
            if (darkScales.includes(scaleName)) return 0;
            return 2;
        } else if (this.gradingMode === 'color') {
            // Color grading based on harmonic richness
            const colorfulScales = ['altered', 'whole_tone', 'octatonic_dim'];
            const simpleScales = ['major_pentatonic', 'minor_pentatonic'];
            if (colorfulScales.includes(scaleName)) return 4;
            if (simpleScales.includes(scaleName)) return 1;
            return 2;
        }
        
        return 2;
    }

    /**
     * Get explanation for why an element received its grading
     */
    getGradingExplanation(element, tier, context = {}) {
        const { elementType = 'note', key = 'C', scaleType = 'major' } = context;
        const mode = this.gradingMode;
        
        let explanation = `In ${mode} grading mode, `;
        
        if (elementType === 'note') {
            const scaleNotes = this.getScaleNotes(key, scaleType);
            const isInScale = scaleNotes.includes(element);
            
            if (mode === 'functional') {
                if (tier === 4) explanation += `${element} is a primary harmonic function note (tonic or dominant).`;
                else if (tier === 3) explanation += `${element} serves an important harmonic function in ${key} ${scaleType}.`;
                else if (tier === 2) explanation += `${element} is part of the ${key} ${scaleType} scale.`;
                else if (tier === 1) explanation += `${element} provides chromatic color outside the scale.`;
                else explanation += `${element} is experimental and creates strong dissonance.`;
            } else if (mode === 'emotional') {
                const noteValue = this.noteValues[element];
                const keyValue = this.noteValues[key];
                const interval = (noteValue - keyValue + 12) % 12;
                
                if (tier === 4) explanation += `${element} creates a bright, uplifting sound.`;
                else if (tier === 3) explanation += `${element} adds warmth and positivity.`;
                else if (tier === 2) explanation += `${element} provides neutral emotional balance.`;
                else if (tier === 1) explanation += `${element} creates melancholy or tension.`;
                else explanation += `${element} evokes deep sadness or darkness.`;
            } else if (mode === 'color') {
                if (tier === 4) explanation += `${element} adds brilliant harmonic color.`;
                else if (tier === 3) explanation += `${element} provides warm harmonic richness.`;
                else if (tier === 2) explanation += `${element} offers natural, grounded color.`;
                else if (tier === 1) explanation += `${element} adds subtle harmonic complexity.`;
                else explanation += `${element} creates deep, mysterious color.`;
            }
        } else if (elementType === 'chord') {
            // Similar explanations for chords...
            explanation += `this chord receives a ${this.getGradingTierInfo(tier).name} rating based on its harmonic function and scale relationship.`;
        }
        
        return explanation;
    }

    /**
     * Suggest alternatives with higher grading tiers
     */
    suggestAlternatives(element, targetTier, context = {}) {
        const { elementType = 'note', key = 'C', scaleType = 'major' } = context;
        const alternatives = [];
        
        if (elementType === 'note') {
            const scaleNotes = this.getScaleNotes(key, scaleType);
            
            // Find notes that would achieve the target tier
            for (const note of this.chromaticNotes) {
                const grade = this.calculateNoteGrade(note, key, scaleType, context);
                if (grade >= targetTier && note !== element) {
                    alternatives.push({
                        element: note,
                        tier: grade,
                        explanation: this.getGradingExplanation(note, grade, { ...context, elementType: 'note' })
                    });
                }
            }
        } else if (elementType === 'chord') {
            // Find chord alternatives
            const scaleNotes = this.getScaleNotes(key, scaleType);
            for (let degree = 1; degree <= 7; degree++) {
                const diatonicChord = this.getDiatonicChord(degree, key, scaleType);
                const grade = this.calculateChordGrade(diatonicChord.fullName, key, scaleType, context);
                if (grade >= targetTier && diatonicChord.fullName !== element) {
                    alternatives.push({
                        element: diatonicChord.fullName,
                        tier: grade,
                        explanation: this.getGradingExplanation(diatonicChord.fullName, grade, { ...context, elementType: 'chord' })
                    });
                }
            }
        }
        
        // Sort by tier (highest first) and limit results
        return alternatives
            .sort((a, b) => b.tier - a.tier)
            .slice(0, 5);
    }

    /**
     * Compare how the same element is graded across different perspectives
     */
    compareGradingPerspectives(element, context = {}) {
        const currentMode = this.gradingMode;
        const perspectives = {};
        
        ['functional', 'emotional', 'color'].forEach(mode => {
            this.gradingMode = mode;
            const tier = this.calculateElementGrade(element, context);
            perspectives[mode] = {
                tier: tier,
                info: this.getGradingTierInfo(tier),
                explanation: this.getGradingExplanation(element, tier, context)
            };
        });
        
        // Restore original mode
        this.gradingMode = currentMode;
        
        return perspectives;
    }

    /**
     * Get educational context for a grading tier
     */
    getEducationalContext(tier, mode) {
        const contexts = {
            functional: [
                'Experimental notes create strong dissonance and require careful resolution.',
                'Fair notes provide chromatic color and can enhance harmonic progressions.',
                'Good notes are scale members that support the key center.',
                'Excellent notes serve important harmonic functions like predominant or secondary dominant.',
                'Perfect notes are primary harmonic pillars (tonic, dominant, subdominant).'
            ],
            emotional: [
                'Somber notes evoke deep sadness and introspection.',
                'Melancholy notes create wistful, pensive moods.',
                'Neutral notes provide emotional balance and stability.',
                'Bright notes generate happiness and energy.',
                'Radiant notes create ecstatic, magical feelings.'
            ],
            color: [
                'Deep notes provide mysterious, contemplative colors.',
                'Rich notes add complex, sophisticated harmonies.',
                'Natural notes offer grounded, organic sounds.',
                'Warm notes create friendly, inviting atmospheres.',
                'Bright notes add brilliant, luminous qualities.'
            ]
        };
        
        return contexts[mode]?.[tier] || 'This grading provides insight into the musical character of the element.';
    }

    /**
     * Explain the theoretical reasoning behind a grading
     */
    explainGradingRationale(element, context = {}) {
        const tier = this.calculateElementGrade(element, context);
        const explanation = this.getGradingExplanation(element, tier, context);
        const educational = this.getEducationalContext(tier, this.gradingMode);
        
        return {
            tier: tier,
            explanation: explanation,
            educational: educational,
            theoreticalBasis: this.getTheoreticalBasis(tier, this.gradingMode, context)
        };
    }

    /**
     * Get accessibility information for grading display
     */
    getAccessibleGradingInfo(tier, options = {}) {
        const { mode = this.gradingMode } = options;
        
        // Get basic tier info without circular dependency
        const basicTierInfo = this.getBasicGradingTierInfo(tier, mode);
        
        // Visual patterns for accessibility (beyond color)
        const patterns = ['dotted', 'dashed', 'solid', 'double', 'thick'];
        const shapes = ['circle', 'square', 'triangle', 'diamond', 'star'];
        
        return {
            pattern: patterns[tier] || 'solid',
            shape: shapes[tier] || 'circle',
            audioCue: this.getAudioGradingCues(tier),
            screenReaderText: `${basicTierInfo.name} grade: ${basicTierInfo.desc}`,
            highContrastColor: this.getHighContrastColor(tier),
            textLabel: basicTierInfo.short
        };
    }

    /**
     * Get basic grading tier info without enhanced properties (to avoid circular dependencies)
     */
    getBasicGradingTierInfo(tier, mode) {
        if (mode === 'emotional') {
            const tiers = [
                { label: '🌑 Somber', color: '#60a5fa', short: '🌑', name: 'Somber', desc: 'Deep, sad, serious' },
                { label: '🌧️ Melancholy', color: '#93c5fd', short: '🌧️', name: 'Melancholy', desc: 'Pensive, longing' },
                { label: '😐 Neutral', color: '#d1d5db', short: '😐', name: 'Neutral', desc: 'Balanced, plain' },
                { label: '☀️ Bright', color: '#fbbf24', short: '☀️', name: 'Bright', desc: 'Happy, energetic' },
                { label: '✨ Radiant', color: '#f9a8d4', short: '✨', name: 'Radiant', desc: 'Ecstatic, magical' }
            ];
            return tiers[tier] || tiers[2];
        } else if (mode === 'color') {
             const tiers = [
                { label: 'Deep Blue', color: '#93c5fd', short: 'Blue', name: 'Deep', desc: 'Calm, depth' },
                { label: 'Purple', color: '#c4b5fd', short: 'Purp', name: 'Rich', desc: 'Royal, complex' },
                { label: 'Green', color: '#6ee7b7', short: 'Grn', name: 'Natural', desc: 'Organic, grounded' },
                { label: 'Orange', color: '#fdba74', short: 'Org', name: 'Warm', desc: 'Energetic, friendly' },
                { label: 'Yellow', color: '#fde68a', short: 'Yel', name: 'Bright', desc: 'Optimistic, light' }
            ];
            return tiers[tier] || tiers[2];
        } else {
            // Default: Functional
            const tiers = [
                { label: '○ Experimental', color: '#9ca3af', short: '○', name: 'Experimental', desc: '(chromatic)' },
                { label: '◐ Fair', color: '#c4b5fd', short: '◐', name: 'Fair', desc: '(chromatic functional)' },
                { label: '★ Good', color: '#fbbf24', short: '★', name: 'Good', desc: '(in-scale)' },
                { label: '★★ Excellent', color: '#38bdf8', short: '★★', name: 'Excellent', desc: '(in-scale functional)' },
                { label: '★★★ Perfect', color: '#10b981', short: '★★★', name: 'Perfect', desc: '(diatonic scale chord)' }
            ];
            return tiers[tier] || tiers[2];
        }
    }

    /**
     * Get audio cues for grading tiers
     */
    getAudioGradingCues(tier) {
        const cues = [
            'Low bass tone',      // Tier 0
            'Muted bell',         // Tier 1  
            'Neutral chime',      // Tier 2
            'Bright bell',        // Tier 3
            'Triumphant fanfare'  // Tier 4
        ];
        
        return cues[tier] || 'Neutral chime';
    }

    /**
     * Get high contrast colors for accessibility
     */
    getHighContrastColor(tier) {
        // High contrast colors with guaranteed 4.5:1+ contrast ratios
        // These are carefully selected to ensure adjacent tiers have sufficient contrast
        const colors = [
            '#000000', // Black - Tier 0 (L=0)
            '#FFFF00', // Yellow - Tier 1 (L=0.927, contrast with black = 19.56:1)
            '#0000FF', // Blue - Tier 2 (L=0.072, contrast with yellow = 13.85:1)
            '#FFFFFF', // White - Tier 3 (L=1, contrast with blue = 8.59:1)
            '#800000'  // Dark Red - Tier 4 (L=0.107, contrast with white = 9.74:1)
        ];
        
        return colors[tier] || '#0000FF';
    }

    /**
     * Get theoretical basis for grading
     */
    getTheoreticalBasis(tier, mode, context = {}) {
        if (mode === 'functional') {
            const bases = [
                'Chromatic theory: Creates tension requiring resolution',
                'Voice leading: Provides smooth chromatic motion',
                'Diatonic theory: Supports tonal center',
                'Functional harmony: Serves clear harmonic role',
                'Tonal hierarchy: Primary structural function'
            ];
            return bases[tier] || 'General harmonic theory';
        } else if (mode === 'emotional') {
            const bases = [
                'Psychoacoustics: Minor intervals create sadness',
                'Cultural associations: Melancholy musical traditions',
                'Neutral intervals: Balanced emotional response',
                'Major intervals: Natural harmonic brightness',
                'Consonance theory: Perfect intervals create joy'
            ];
            return bases[tier] || 'Music psychology theory';
        } else if (mode === 'color') {
            const bases = [
                'Spectral theory: Lower frequencies appear darker',
                'Harmonic complexity: Moderate overtone content',
                'Natural harmonics: Organic frequency relationships',
                'Brightness theory: Higher partials create warmth',
                'Acoustic brilliance: Rich harmonic spectrum'
            ];
            return bases[tier] || 'Acoustic color theory';
        }
        
        return 'Music theory principles';
    }

    /**
     * Get suggested actions based on grading
     */
    getSuggestedActions(tier, mode, context = {}) {
        const actions = [];
        
        if (tier <= 1) {
            actions.push('Consider resolving to a higher-tier element');
            actions.push('Use as passing tone or chromatic approach');
            actions.push('Explore alternatives with better grading');
        } else if (tier === 2) {
            actions.push('Good foundation - consider embellishment');
            actions.push('Stable choice for harmonic support');
        } else if (tier >= 3) {
            actions.push('Excellent choice - emphasize in composition');
            actions.push('Use as structural harmonic element');
            actions.push('Build progressions around this element');
        }
        
        return actions;
    }

    /**
     * Add a regional scale with ethnomusicological context
     * @param {Object} scaleData - Scale definition with intervals and metadata
     * @param {Object} ethnomusicologicalContext - Cultural and historical context
     * @returns {Object} Validated scale data ready for integration
     */
    addRegionalScale(scaleData, ethnomusicologicalContext) {
        if (!this.regionalScaleManager) {
            throw new Error('RegionalScaleManager not available');
        }
        
        const validatedScale = this.regionalScaleManager.addRegionalScale(scaleData, ethnomusicologicalContext);
        
        // Add to scales object
        this.scales[scaleData.scaleId] = scaleData.intervals;
        
        // Add to scale citations
        this.scaleCitations[scaleData.scaleId] = this.regionalScaleManager.formatRegionalScaleDocumentation(validatedScale);
        
        return validatedScale;
    }

    /**
     * Validate cultural attribution for a scale
     * @param {string} scaleId - Scale identifier
     * @param {Array} sources - Academic sources for validation
     * @returns {boolean} True if attribution is complete and valid
     */
    validateCulturalAttribution(scaleId, sources) {
        if (!this.regionalScaleManager) {
            throw new Error('RegionalScaleManager not available');
        }
        
        return this.regionalScaleManager.validateCulturalAttribution(scaleId, sources);
    }

    /**
     * Get cultural context for a regional scale
     * @param {string} scaleId - Scale identifier
     * @returns {Object} Cultural context information
     */
    getRegionalScaleCulturalContext(scaleId) {
        if (!this.regionalScaleManager) {
            throw new Error('RegionalScaleManager not available');
        }
        
        const scaleData = this.scaleCitations[scaleId];
        if (!scaleData) {
            throw new Error(`Scale not found: ${scaleId}`);
        }
        
        return this.regionalScaleManager.getCulturalContext(scaleId, scaleData);
    }

    /**
     * Document 12-TET approximation for traditional scales
     * @param {Object} originalTuning - Traditional tuning system description
     * @param {Object} approximation - 12-TET approximation details
     * @returns {Object} Complete tuning system documentation
     */
    documentTuningApproximation(originalTuning, approximation) {
        if (!this.regionalScaleManager) {
            throw new Error('RegionalScaleManager not available');
        }
        
        return this.regionalScaleManager.documentTuningApproximation(originalTuning, approximation);
    }
}

// Export for module usage
if (typeof module !== 'undefined' && module.exports) {
    module.exports = MusicTheoryEngine;
}

// Make available globally if in browser
if (typeof window !== 'undefined') {
    window.MusicTheoryEngine = MusicTheoryEngine;
}
